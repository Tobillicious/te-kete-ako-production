<!DOCTYPE html>
<html lang="en">
<head>
    <title>Biodiversity Tagger Game (Y9 Ecology)</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ⭐ PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ⭐ THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ⭐ COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ⭐ PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ⭐ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ⭐ CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">
<body>
  <div class="game">
    <header class="header">
      <h1 style="margin:0 0 .5rem">🌿 Biodiversity Tagger Challenge</h1>
      <p style="margin:0;opacity:.9">How fast can you correctly classify NZ native species?</p>
    </header>

    <div class="game-area">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
        <div><strong>Score:</strong> <span class="score" id="score">0</span></div>
        <div><strong>Time:</strong> <span id="timer">60</span>s</div>
        <div><strong>Streak:</strong> <span id="streak">0</span> 🔥</div>
      </div>

      <div id="question-panel" style="background:#f0fdf4;border-left:4px solid #16a34a;padding:1rem;border-radius:8px;margin-bottom:1rem">
        <h3 style="margin-top:0" id="question">Loading...</h3>
        <p style="font-size:.9rem;color:#6b7280" id="hint"></p>
      </div>

      <div class="species-grid" id="options"></div>

      <div style="text-align:center;margin-top:1.5rem">
        <button class="btn" onclick="game.start()" id="start-btn">Start Game</button>
        <button class="btn" onclick="game.restart()" id="restart-btn" style="display:none;background:#6b7280">Play Again</button>
      </div>
    </div>

    <div id="results" class="game-area" style="display:none">
      <h2 style="text-align:center">Game Over!</h2>
      <p style="text-align:center;font-size:1.2rem">Final Score: <span class="score" id="final-score">0</span></p>
      <p style="text-align:center" id="rank"></p>
    </div>
  </div>

  <script>
    const game={
      score:0,streak:0,timer:60,interval:null,
      questions:[
        {q:'Which is a PRODUCER?',hint:'Makes its own food via photosynthesis',answer:'Rimu',options:['Rimu','Kererū','Tuatara','Wētā']},
        {q:'Which is a PRIMARY CONSUMER?',hint:'Eats plants',answer:'Kererū',options:['Kererū','Falcon','Rimu','Eel']},
        {q:'Which is a PREDATOR (secondary consumer)?',hint:'Eats other animals',answer:'Falcon',options:['Falcon','Harakeke','Kererū','Cabbage tree']},
        {q:'Which is NATIVE to NZ?',hint:'Evolved here over millions of years',answer:'Tuatara',options:['Tuatara','Possum','Rat','Cat']},
        {q:'Which is ENDEMIC to NZ?',hint:'Found ONLY in NZ, nowhere else',answer:'Kiwi',options:['Kiwi','Sparrow','Salmon','Gull']},
        {q:'Which is INTRODUCED/INVASIVE?',hint:'Brought by humans, harms natives',answer:'Possum',options:['Possum','Kākāpō','Weka','Morepork']},
        {q:'Which species is CRITICALLY ENDANGERED?',hint:'Fewer than 250 left in wild',answer:'Kākāpō',options:['Kākāpō','Tūī','Fantail','Kingfisher']},
        {q:'Which plant is a WETLAND species?',hint:'Thrives in swampy, water-logged soil',answer:'Harakeke',options:['Harakeke','Kauri','Mānuka','Beech']},
        {q:'Which is a DECOMPOSER?',hint:'Breaks down dead material',answer:'Wētā',options:['Wētā','Kiwi','Trout','Heron']},
        {q:'Which bird is a SEED DISPERSER?',hint:'Eats fruit, spreads seeds via droppings',answer:'Kererū',options:['Kererū','Hawk','Shag','Duck']}
      ],
      current:null,
      
      start(){
        this.score=0;this.streak=0;this.timer=60;
        document.getElementById('score').textContent=this.score;
        document.getElementById('streak').textContent=this.streak;
        document.getElementById('start-btn').style.display='none';
        document.getElementById('results').style.display='none';
        this.nextQuestion();
        this.interval=setInterval(()=>{
          this.timer--;
          document.getElementById('timer').textContent=this.timer;
          if(this.timer<=0){clearInterval(this.interval);this.end()}
        },1000);
      },
      
      nextQuestion(){
        this.current=this.questions[Math.floor(Math.random()*this.questions.length)];
        document.getElementById('question').textContent=this.current.q;
        document.getElementById('hint').textContent='💡 '+this.current.hint;
        const opts=document.getElementById('options');
        opts.innerHTML=this.current.options.map(o=>`<div class="species-card" onclick="game.check('${o}')">${o}</div>`).join('');
      },
      
      check(selected){
        const correct=selected===this.current.answer;
        const cards=document.querySelectorAll('.species-card');
        cards.forEach(c=>{
          c.style.pointerEvents='none';
          if(c.textContent===this.current.answer)c.classList.add('correct');
          if(c.textContent===selected&&!correct)c.classList.add('wrong');
        });
        if(correct){
          this.score+=10+this.streak*2;
          this.streak++;
          document.getElementById('score').textContent=this.score;
          document.getElementById('streak').textContent=this.streak;
        }else{
          this.streak=0;
          document.getElementById('streak').textContent=this.streak;
        }
        setTimeout(()=>this.nextQuestion(),1200);
      },
      
      end(){
        clearInterval(this.interval);
        document.getElementById('final-score').textContent=this.score;
        let rank='Emerging Ecologist';
        if(this.score>=150)rank='🏆 Kaitiaki Champion!';
        else if(this.score>=100)rank='🌟 Biodiversity Expert';
        else if(this.score>=50)rank='🌿 Growing Ecologist';
        document.getElementById('rank').textContent=rank;
        document.getElementById('results').style.display='block';
        document.getElementById('restart-btn').style.display='inline-block';
      },
      
      restart(){
        document.getElementById('restart-btn').style.display='none';
        document.getElementById('start-btn').style.display='inline-block';
      }
    };
  </script>

  <script src="/js/te-kete-professional.js" defer></script>
  <script src="/js/posthog-analytics.js" defer></script>
</body>
</html>
