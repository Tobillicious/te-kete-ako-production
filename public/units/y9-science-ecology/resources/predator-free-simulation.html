<!DOCTYPE html>
<html lang="en">
<head>
    <title>Predator Free NZ Simulation (Y9 Ecology)</title>

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ⭐ PROFESSIONAL SYSTEM FIRST - Core design tokens -->


<!-- ⭐ THEME SYSTEM (Tailwind + Ultimate Beauty) -->



<!-- ⭐ COMPONENT STYLES -->





<!-- ⭐ PRINT STYLES (media="print" = only for printing) -->



<!-- ⭐ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->


<!-- ⭐ CASCADE FIX (Loads LAST - overrides conflicting variables) -->


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Wait for Supabase CDN to load before initializing singleton
    window.addEventListener('DOMContentLoaded', () => {
        if (!window.supabase) {
            // Log to monitoring instead of console
            if (window.posthog) {
                posthog.capture('supabase_cdn_error', {
                    message: 'Supabase CDN failed to load',
                    url: window.location.pathname
                });
            }
        }
    });
</script>
<script src="/js/supabase-singleton.js"></script>
<!-- My Kete Database Integration - loads after singleton -->
<script src="/js/my-kete-database.js"></script>
<!-- Navigation Loader Singleton - loads after supabase setup -->
<script src="/js/navigation-loader.js"></script>
<!-- Component Loader - centralized async component management -->
<script src="/js/component-loader.js"></script>
<meta name="mobile-web-app-capable" content="yes"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="Te Kete Ako" name="apple-mobile-web-app-title"/>
<link href="/icons/icon-192x192.png" rel="apple-touch-icon"/>
<!-- ENHANCED SEARCH -->
<script src="/js/enhanced-search.js" defer></script>
<!-- MOBILE PERFORMANCE OPTIMIZER -->
<script src="/js/mobile-performance-optimizer.js" defer></script>
<!-- TOUCH TARGET AUDITOR -->
<script src="/js/touch-target-auditor.js" defer></script>
<!-- 🎨 ULTIMATE CULTURAL GESTURES - Framer Motion System -->
<script src="/js/framer-cultural-gestures-ultimate.js" defer></script>
<!-- Service Worker Registration -->
<script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('✅ PWA: Service Worker registered!', registration);
                    })
                    .catch(error => {
                        // Log to monitoring instead of console
                        if (window.posthog) {
                            posthog.capture('pwa_service_worker_error', {
                                message: 'Service Worker registration failed',
                                error: error.message,
                                url: window.location.pathname
                            });
                        }
                    });
            });
        }
</script>

<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>



<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>


    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ⭐ PROFESSIONAL SYSTEM FIRST - Core design tokens -->


<!-- ⭐ THEME SYSTEM (Tailwind + Ultimate Beauty) -->



<!-- ⭐ COMPONENT STYLES -->
    
    
    
    

<!-- ⭐ PRINT STYLES (media="print" = only for printing) -->
    


<!-- ⭐ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->


<!-- ⭐ CASCADE FIX (Loads LAST - overrides conflicting variables) -->

<body>
  <div class="sim">
    <header class="header">
      <h1 style="margin:0 0 .5rem">🪤 Predator Free 2050: The Challenge</h1>
      <p class="m-0" >Can you eliminate introduced predators before native species go extinct?</p>
    </header>

    <div class="grid">
      <aside class="panel">
        <h3 style="margin-top:0">Island Stats</h3>
        <div class="stat"><span>🦜 Native Birds</span><span id="birds">50</span></div>
        <div class="stat"><span>🐀 Rats</span><span id="rats">100</span></div>
        <div class="stat"><span>🦡 Stoats</span><span id="stoats">20</span></div>
        <div class="stat"><span>💰 Budget</span><span id="budget">$100K</span></div>
        <div class="stat"><span>📅 Year</span><span id="year">2025</span></div>
        <hr style="margin:1rem 0">
        <h4>Actions (per year)</h4>
        <button class="btn" onclick="sim.trapRats()">🪤 Trap Rats ($10K)</button>
        <button class="btn" onclick="sim.trapStoats()">🪤 Trap Stoats ($15K)</button>
        <button class="btn" onclick="sim.fence()">🚧 Build Fence ($50K)</button>
        <button class="btn" onclick="sim.reintroduce()">🦜 Reintroduce Birds ($20K)</button>
        <button class="btn" onclick="sim.nextYear()" style="background:#16a34a">▶️ Next Year</button>
      </aside>

      <main class="panel">
        <h3 style="margin-top:0">Population Dynamics</h3>
        <div id="ecosystem" class="rounded-lg p-4" ></div>
        <div id="log" style="margin-top:1rem;font-size:.85rem;color:#6b7280;max-height:150px;overflow-y:auto"></div>
      </main>
    </div>

    <div id="result" class="panel text-center" >
      <h2 id="result-title"></h2>
      <p id="result-msg"></p>
      <button class="btn" onclick="sim.restart()">Try Again</button>
    </div>
  </div>

  <script>
    const sim={
      birds:50,rats:100,stoats:20,budget:100000,year:2025,hasFence:false,
      
      render(){
        document.getElementById('birds').textContent=this.birds;
        document.getElementById('rats').textContent=this.rats;
        document.getElementById('stoats').textContent=this.stoats;
        document.getElementById('budget').textContent='$'+(this.budget/1000)+'K';
        document.getElementById('year').textContent=this.year;
        
        const eco=document.getElementById('ecosystem');
        eco.innerHTML='<div class="flex" >'+
          Array(Math.min(this.birds,50)).fill(0).map(()=>'<span class="pop native">🦜</span>').join('')+
          Array(Math.min(this.rats,50)).fill(0).map(()=>'<span class="pop predator">🐀</span>').join('')+
          Array(Math.min(this.stoats,20)).fill(0).map(()=>'<span class="pop predator">🦡</span>').join('')+
          '</div>';
        
        if(this.birds<=0)this.lose();
        if(this.rats<=0&&this.stoats<=0&&this.birds>=30)this.win();
      },
      
      log(msg){
        const log=document.getElementById('log');
        log.innerHTML=`<div>${this.year}: ${msg}</div>`+log.innerHTML;
      },
      
      trapRats(){
        if(this.budget<10000)return this.log('❌ Not enough budget!');
        this.budget-=10000;
        const removed=Math.min(20,this.rats);
        this.rats-=removed;
        this.log(`🪤 Trapped ${removed} rats`);
        this.render();
      },
      
      trapStoats(){
        if(this.budget<15000)return this.log('❌ Not enough budget!');
        this.budget-=15000;
        const removed=Math.min(5,this.stoats);
        this.stoats-=removed;
        this.log(`🪤 Trapped ${removed} stoats`);
        this.render();
      },
      
      fence(){
        if(this.hasFence)return this.log('❌ Fence already built!');
        if(this.budget<50000)return this.log('❌ Not enough budget!');
        this.budget-=50000;
        this.hasFence=true;
        this.log('🚧 Predator-proof fence complete!');
        this.render();
      },
      
      reintroduce(){
        if(this.budget<20000)return this.log('❌ Not enough budget!');
        if(this.rats>10||this.stoats>2)return this.log('❌ Too many predators—birds won\'t survive!');
        this.budget-=20000;
        this.birds+=10;
        this.log('🦜 Reintroduced 10 birds');
        this.render();
      },
      
      nextYear(){
        this.year++;
        this.budget+=30000; // annual grant
        
        // Predators breed if not fenced
        if(!this.hasFence){
          this.rats=Math.min(200,Math.floor(this.rats*1.5));
          this.stoats=Math.min(50,Math.floor(this.stoats*1.3));
        }
        
        // Predators eat birds
        const eaten=Math.floor(this.rats*0.1+this.stoats*0.8);
        this.birds=Math.max(0,this.birds-eaten);
        if(eaten>0)this.log(`💀 Predators killed ${eaten} birds`);
        
        // Birds breed if safe
        if(this.rats<20&&this.stoats<5){
          const chicks=Math.floor(this.birds*0.2);
          this.birds+=chicks;
          if(chicks>0)this.log(`🐣 ${chicks} chicks hatched!`);
        }
        
        this.log(`💵 +$30K annual funding`);
        if(this.year>=2050)this.timeout();
        this.render();
      },
      
      win(){
        document.getElementById('result-title').textContent='🎉 Victory!';
        document.getElementById('result-msg').textContent=`Predator Free achieved in ${this.year}! Bird population thriving at ${this.birds}. Kaitiakitanga successful!`;
        document.getElementById('result').style.display='block';
      },
      
      lose(){
        document.getElementById('result-title').textContent='💔 Extinction';
        document.getElementById('result-msg').textContent=`Native birds went extinct in ${this.year}. Predators won. Consider: earlier intervention, better funding, community engagement.`;
        document.getElementById('result').style.display='block';
      },
      
      timeout(){
        document.getElementById('result-title').textContent='⏰ Time Up';
        document.getElementById('result-msg').textContent=`2050 reached. Birds: ${this.birds} | Rats: ${this.rats} | Stoats: ${this.stoats}. Did you achieve Predator Free 2050?`;
        document.getElementById('result').style.display='block';
      },
      
      restart(){
        this.birds=50;this.rats=100;this.stoats=20;this.budget=100000;this.year=2025;this.hasFence=false;
        document.getElementById('log').innerHTML='';
        document.getElementById('result').style.display='none';
        this.render();
      }
    };
    
    window.addEventListener('DOMContentLoaded',()=>sim.render());
  </script>

  <script src="../../../vendor/supabase.min.js" defer></script>
  <script src="../../../js/env-config.js" defer></script>
  <script src="../../../js/supabase-client.js" defer></script>
  <script src="../../../js/auth-ui.js" defer></script>
</body>
</html>
