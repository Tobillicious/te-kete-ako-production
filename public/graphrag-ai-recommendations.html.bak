<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Recommendations | GraphRAG | Te Kete Ako</title>
    <!-- üé® ULTIMATE BEAUTY SYSTEM - Te Kete Ako Design Excellence -->
 <link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css">
 <script src="https://cdn.tailwindcss.com"></script>
 <script src="/tailwind.config.ultimate.js"></script>
 <!-- END ULTIMATE BEAUTY SYSTEM --><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        .ai-hero {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            color: white;
            padding: 5rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .recommendation-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 6px solid #0891b2;
            position: relative;
        }
        
        .confidence-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.5s ease;
        }
        
        .reason-badge {
            display: inline-block;
            background: #dbeafe;
            color: #0369a1;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            margin: 0.25rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
    </style>
<!-- Professional Design System -->
<link rel="stylesheet" href="/css/te-kete-professional.css"></head>
<body class="pattern-koru-subtle">
    <!-- Navigation -->
    <div id="nav-container"></div>
    <script>
        fetch('/components/navigation-standard.html')
            .then(r => r.text())
            .then(html => document.getElementById('nav-container').innerHTML = html);
    </script>
    
    <!-- Hero -->
    <section class="ai-hero">
        <div style="position: relative; z-index: 2; max-width: 900px; margin: 0 auto;">
            <div style="display: inline-block; background: rgba(255,255,255,0.2); padding: 0.5rem 1.5rem; border-radius: 24px; margin-bottom: 1rem;">
                <span style="font-weight: 700; font-size: 0.9rem;">ü§ñ AI-POWERED BY GRAPHRAG</span>
            </div>
            <h1 style="font-size: 4rem; margin-bottom: 1rem; font-weight: 800;">
                Smart Recommendations
            </h1>
            <p style="font-size: 1.5rem; opacity: 0.95; max-width: 700px; margin: 0 auto;">
                Discover your perfect learning path through AI analysis of 231,469 knowledge relationships
            </p>
        </div>
    </section>
    
    <main style="max-width: 1200px; margin: 3rem auto; padding: 0 2rem;">
        
        <!-- Tell Us What You're Interested In -->
        <section style="background: white; padding: 3rem 2rem; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin: 3rem 0;">
            <h2 style="font-size: 2.5rem; color: #1a4d2e; text-align: center; margin-bottom: 2rem;">
                üéØ What Are You Looking For?
            </h2>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 700; color: #1a4d2e; margin-bottom: 0.5rem;">
                        Subject Area:
                    </label>
                    <select id="subject-select" style="width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1.1rem;">
                        <option value="">All Subjects</option>
                        <option value="Science">Science</option>
                        <option value="English">English</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Digital Technologies">Digital Technologies</option>
                        <option value="Social Studies">Social Studies</option>
                        <option value="Te Ao MƒÅori">Te Ao MƒÅori</option>
                        <option value="Cross-curricular">Cross-curricular</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 700; color: #1a4d2e; margin-bottom: 0.5rem;">
                        Year Level:
                    </label>
                    <select id="year-select" style="width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1.1rem;">
                        <option value="">All Levels</option>
                        <option value="Year 7">Year 7</option>
                        <option value="Year 8">Year 8</option>
                        <option value="Year 9">Year 9</option>
                        <option value="Year 10">Year 10</option>
                        <option value="Year 11">Year 11</option>
                        <option value="Year 12">Year 12</option>
                        <option value="Year 13">Year 13</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 700; color: #1a4d2e; margin-bottom: 0.5rem;">
                        Cultural Integration:
                    </label>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #f3f4f6; border-radius: 12px; cursor: pointer;">
                            <input type="checkbox" id="cultural-context" value="cultural_context">
                            <span style="font-weight: 600;">Cultural Context</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #f3f4f6; border-radius: 12px; cursor: pointer;">
                            <input type="checkbox" id="has-whakataukƒ´" value="has_whakataukƒ´">
                            <span style="font-weight: 600;">üåø Whakataukƒ´</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #f3f4f6; border-radius: 12px; cursor: pointer;">
                            <input type="checkbox" id="has-te-reo" value="has_te_reo">
                            <span style="font-weight: 600;">üó£Ô∏è Te Reo</span>
                        </label>
                    </div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 700; color: #1a4d2e; margin-bottom: 0.5rem;">
                        Quality Threshold:
                    </label>
                    <input type="range" id="quality-slider" min="70" max="100" value="85" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; color: #64748b; font-size: 0.9rem; margin-top: 0.5rem;">
                        <span>70</span>
                        <span id="quality-value" style="font-weight: 700; color: #0891b2; font-size: 1.1rem;">85</span>
                        <span>100</span>
                    </div>
                </div>
                
                <button onclick="getRecommendations()" style="width: 100%; background: linear-gradient(135deg, #0891b2, #06b6d4); color: white; padding: 1.25rem 2rem; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);">
                    ü§ñ Get AI Recommendations
                </button>
            </div>
        </section>
        
        <!-- Recommendations Display -->
        <section id="recommendations-container">
            <div style="text-align: center; padding: 3rem; color: #64748b;">
                <p style="font-size: 1.2rem;">üëÜ Set your preferences above to get personalized recommendations</p>
            </div>
        </section>
        
        <!-- How It Works -->
        <section style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); padding: 3rem 2rem; border-radius: 16px; margin: 4rem 0;">
            <h2 style="font-size: 2rem; color: #0369a1; text-align: center; margin-bottom: 2rem;">
                üß† How AI Recommendations Work
            </h2>
            
            <div style="max-width: 800px; margin: 0 auto; line-height: 1.8; color: #0c4a6e;">
                <div style="background: white; padding: 2rem; border-radius: 12px; margin-bottom: 1.5rem;">
                    <h3 style="color: #0891b2; margin-bottom: 1rem;">1. GraphRAG Analysis</h3>
                    <p>Our AI analyzes 231,469 relationships in the knowledge graph to find connections between resources based on subject, prerequisites, cultural elements, and learning progressions.</p>
                </div>
                
                <div style="background: white; padding: 2rem; border-radius: 12px; margin-bottom: 1.5rem;">
                    <h3 style="color: #0891b2; margin-bottom: 1rem;">2. Confidence Scoring</h3>
                    <p>Each recommendation gets a confidence score (70-100%) based on relationship strength, quality scores, and cultural integration alignment.</p>
                </div>
                
                <div style="background: white; padding: 2rem; border-radius: 12px;">
                    <h3 style="color: #0891b2; margin-bottom: 1rem;">3. Personalized Ranking</h3>
                    <p>Results are ranked by combining quality scores, confidence levels, and your cultural preferences to surface the perfect learning resources.</p>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    <script>
        fetch('/components/footer.html').then(r=>r.text()).then(html=>{
            document.getElementById('footer-container').innerHTML=html;
        });
    </script>
    
    <!-- GraphRAG AI Recommendation Engine -->
    <script>
        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5ODgxMTksImV4cCI6MjA1MjU2NDExOX0.gN5RGe7kGmxj4-yI1xnDuCuKUPFDh4f-8CQqQdqrGq0';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Update quality value display
        document.getElementById('quality-slider').addEventListener('input', (e) => {
            document.getElementById('quality-value').textContent = e.target.value;
        });
        
        async function getRecommendations() {
            const container = document.getElementById('recommendations-container');
            container.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <div style="border: 3px solid #0891b2; border-top: 3px solid transparent; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                    <p style="color: #0891b2; font-weight: 700; font-size: 1.2rem;">ü§ñ AI analyzing 231,469 relationships...</p>
                </div>
            `;
            
            try {
                // Get user preferences
                const subject = document.getElementById('subject-select').value;
                const yearLevel = document.getElementById('year-select').value;
                const qualityThreshold = parseInt(document.getElementById('quality-slider').value);
                const culturalContext = document.getElementById('cultural-context').checked;
                const hasWhakataukƒ´ = document.getElementById('has-whakataukƒ´').checked;
                const hasTeReo = document.getElementById('has-te-reo').checked;
                
                console.log('ü§ñ Getting recommendations with preferences:', {
                    subject, yearLevel, qualityThreshold, culturalContext, hasWhakataukƒ´, hasTeReo
                });
                
                // Build query
                let query = supabase
                    .from('graphrag_resources')
                    .select('*')
                    .gte('quality_score', qualityThreshold);
                
                if (subject) {
                    query = query.eq('subject', subject);
                }
                
                if (yearLevel) {
                    query = query.or(`year_level.ilike.%${yearLevel}%,year_level.ilike.%All%,year_level.ilike.%Multi%`);
                }
                
                if (culturalContext) {
                    query = query.eq('cultural_context', true);
                }
                
                if (hasWhakataukƒ´) {
                    query = query.eq('has_whakataukƒ´', true);
                }
                
                if (hasTeReo) {
                    query = query.eq('has_te_reo', true);
                }
                
                // Execute query
                const { data: resources, error } = await query
                    .order('quality_score', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                if (!resources || resources.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; background: white; border-radius: 16px;">
                            <p style="font-size: 1.2rem; color: #64748b;">No resources found matching your criteria. Try adjusting your filters!</p>
                        </div>
                    `;
                    return;
                }
                
                console.log(`‚úÖ Found ${resources.length} matching resources`);
                
                // Calculate confidence scores (simulated based on quality + filters matched)
                const recommendations = resources.map(r => {
                    let confidence = (r.quality_score / 100) * 100;
                    
                    // Boost for cultural matches
                    if (culturalContext && r.cultural_context) confidence += 5;
                    if (hasWhakataukƒ´ && r.has_whakataukƒ´) confidence += 5;
                    if (hasTeReo && r.has_te_reo) confidence += 5;
                    
                    confidence = Math.min(confidence, 99); // Cap at 99%
                    
                    const reasons = [];
                    if (r.quality_score >= 90) reasons.push('High Quality');
                    if (r.cultural_context) reasons.push('Cultural Integration');
                    if (r.has_whakataukƒ´) reasons.push('Whakataukƒ´');
                    if (r.has_te_reo) reasons.push('Te Reo MƒÅori');
                    
                    return { ...r, confidence, reasons };
                });
                
                // Render recommendations
                container.innerHTML = `
                    <h2 style="font-size: 2.5rem; color: #1a4d2e; text-align: center; margin-bottom: 2rem;">
                        ü§ñ ${recommendations.length} AI-Recommended Resources
                    </h2>
                    <div>
                        ${recommendations.map((rec, i) => `
                            <div class="recommendation-card">
                                <div style="position: absolute; top: 1rem; right: 1rem; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 800; font-size: 0.9rem;">
                                    #${i + 1}
                                </div>
                                
                                <h3 style="color: #0891b2; font-size: 1.75rem; margin-bottom: 1rem; font-weight: 700; padding-right: 4rem;">
                                    ${rec.title}
                                </h3>
                                
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
                                    <span style="background: #dbeafe; color: #0369a1; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.9rem;">
                                        ${rec.resource_type || 'Resource'}
                                    </span>
                                    ${rec.subject ? `
                                        <span style="background: #dbeafe; color: #0369a1; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.9rem;">
                                            ${rec.subject}
                                        </span>
                                    ` : ''}
                                    ${rec.year_level ? `
                                        <span style="background: #dbeafe; color: #0369a1; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.9rem;">
                                            ${rec.year_level}
                                        </span>
                                    ` : ''}
                                    <span style="background: #fed7aa; color: #9a3412; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 700; font-size: 0.9rem;">
                                        ‚≠ê ${rec.quality_score}/100
                                    </span>
                                </div>
                                
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="color: #64748b; font-weight: 600; font-size: 0.9rem;">AI Confidence:</span>
                                        <span style="color: #10b981; font-weight: 700; font-size: 1.1rem;">${rec.confidence.toFixed(0)}%</span>
                                    </div>
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" style="width: ${rec.confidence}%;"></div>
                                    </div>
                                </div>
                                
                                ${rec.reasons.length > 0 ? `
                                    <div style="margin: 1.5rem 0;">
                                        <div style="color: #64748b; font-weight: 600; font-size: 0.9rem; margin-bottom: 0.75rem;">
                                            Why This Recommendation:
                                        </div>
                                        <div>
                                            ${rec.reasons.map(r => `<span class="reason-badge">${r}</span>`).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                                    <a href="${rec.file_path}" style="flex: 1; background: linear-gradient(135deg, #0891b2, #06b6d4); color: white; padding: 1rem 1.5rem; border-radius: 12px; text-align: center; text-decoration: none; font-weight: 700; box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);">
                                        Explore Resource ‚Üí
                                    </a>
                                    <button onclick="learnMore('${rec.file_path}')" style="background: white; border: 2px solid #0891b2; color: #0891b2; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 700; cursor: pointer;">
                                        Learn More
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 3rem; padding: 2rem; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 12px;">
                        <p style="color: #0369a1; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">
                            üí° Want different recommendations?
                        </p>
                        <p style="color: #0c4a6e;">
                            Adjust your preferences above and click "Get AI Recommendations" again!
                        </p>
                    </div>
                `;
                
                console.log(`‚úÖ Rendered ${recommendations.length} AI recommendations`);
                
            } catch (error) {
                console.error('‚ùå Recommendation Error:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; background: white; border-radius: 16px;">
                        <p style="color: #ef4444;">Error generating recommendations. Please try again.</p>
                    </div>
                `;
            }
        }
        
        async function learnMore(filePath) {
            // Get related resources via GraphRAG
            try {
                const { data: relationships } = await supabase
                    .from('graphrag_relationships')
                    .select('*')
                    .eq('source_path', filePath)
                    .in('relationship_type', ['related_content', 'prerequisite', 'shared_cultural_element'])
                    .limit(5);
                
                const relCount = relationships?.length || 0;
                alert(`This resource has ${relCount} related resources in our knowledge graph!\n\nClick "Explore Resource" to view it and discover connections.`);
            } catch (error) {
                console.error('Error:', error);
            }
        }
    </script>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

<!-- üìä ULTIMATE BEAUTY: PostHog Analytics (Privacy-First) -->
<script src="/js/posthog-analytics.js" defer></script>

</body>
</html>

