<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Agent Dashboard - GraphRAG Intelligence</title>
    <link rel="stylesheet" href="/css/te-kete-professional.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .agent-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .agent-header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .agent-header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .agent-header p {
            font-size: 1.2rem;
            opacity: 0.95;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #f3f4f6;
        }

        .card-icon {
            font-size: 2.5rem;
            margin-right: 1rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .card-count {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-left: auto;
        }

        .rules-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rule-item {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, #f9fafb, #f3f4f6);
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .rule-item:hover {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            border-left-color: #764ba2;
            transform: translateX(4px);
        }

        .rule-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .rule-path {
            font-size: 0.75rem;
            color: #6b7280;
            font-family: 'Courier New', monospace;
        }

        .query-interface {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
        }

        .query-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s ease;
        }

        .query-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .query-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .query-btn:hover {
            transform: scale(1.05);
        }

        .query-results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
            display: none;
        }

        .query-results.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        .stat-box {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #0284c7;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #475569;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .sql-example {
            background: #1f2937;
            color: #10b981;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .quick-query-btn {
            display: inline-block;
            background: #ddd6fe;
            color: #5b21b6;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            margin: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .quick-query-btn:hover {
            background: #c4b5fd;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="agent-container">
        <div class="agent-header">
            <h1>ü§ñ Agent Dashboard</h1>
            <p>GraphRAG-Powered Agent Coordination & Intelligence</p>
        </div>

        <!-- Stats Overview -->
        <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); margin-bottom: 2rem;">
            <div class="stat-box">
                <div class="stat-number" id="total-resources">5,269</div>
                <div class="stat-label">Total Resources</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="agent-rules-count">5</div>
                <div class="stat-label">Agent Rules</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="dev-patterns-count">4</div>
                <div class="stat-label">Dev Patterns</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="issues-count">3</div>
                <div class="stat-label">Active Issues</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="learnings-count">4</div>
                <div class="stat-label">Session Learnings</div>
            </div>
        </div>

        <!-- Query Interface -->
        <div class="query-interface">
            <h2 style="margin-top: 0; color: #1f2937;">üîç Query Agent Knowledge</h2>
            <p style="color: #6b7280; margin-bottom: 1rem;">Use SQL or quick queries to explore agent coordination intelligence</p>
            
            <div style="margin-bottom: 1rem;">
                <strong style="color: #374151;">Quick Queries:</strong><br>
                <span class="quick-query-btn" onclick="loadQuickQuery('agent_rules')">üìã All Agent Rules</span>
                <span class="quick-query-btn" onclick="loadQuickQuery('dev_patterns')">üõ†Ô∏è Development Patterns</span>
                <span class="quick-query-btn" onclick="loadQuickQuery('issues')">üêõ Active Issues</span>
                <span class="quick-query-btn" onclick="loadQuickQuery('learnings')">üí° Session Learnings</span>
                <span class="quick-query-btn" onclick="loadQuickQuery('all_agent')">üåê All Agent Data</span>
            </div>

            <textarea class="query-input" id="sql-query" rows="4" placeholder="SELECT * FROM graphrag_resources WHERE file_path LIKE '_agent_rules/%';">SELECT * FROM graphrag_resources WHERE file_path LIKE '_agent_rules/%';</textarea>
            <button class="query-btn" onclick="executeQuery()">Execute Query</button>

            <div class="query-results" id="query-results">
                <h3 style="margin-top: 0; color: #1f2937;">Results:</h3>
                <div id="results-content"></div>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard-grid">
            <!-- Agent Rules Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üìã</span>
                    <h2 class="card-title">Agent Rules</h2>
                    <span class="card-count">5 Rules</span>
                </div>
                <ul class="rules-list" id="agent-rules-list">
                    <li class="rule-item" onclick="showRuleDetails('repo_mission')">
                        <div class="rule-title">Repository Mission: Build, Don't Document</div>
                        <div class="rule-path">_agent_rules/repo_mission</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('md_prohibition')">
                        <div class="rule-title">Stop Writing Coordination MDs</div>
                        <div class="rule-path">_agent_rules/md_prohibition</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('graphrag_first')">
                        <div class="rule-title">GraphRAG is Source of Truth</div>
                        <div class="rule-path">_agent_rules/graphrag_first</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('commit_progress')">
                        <div class="rule-title">Log Progress in Git Commits</div>
                        <div class="rule-path">_agent_rules/commit_progress</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('active_questions_only')">
                        <div class="rule-title">Use ACTIVE_QUESTIONS.md for Questions Only</div>
                        <div class="rule-path">_agent_rules/active_questions_only</div>
                    </li>
                </ul>
            </div>

            <!-- Development Patterns Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üõ†Ô∏è</span>
                    <h2 class="card-title">Dev Patterns</h2>
                    <span class="card-count">4 Patterns</span>
                </div>
                <ul class="rules-list" id="dev-patterns-list">
                    <li class="rule-item" onclick="showRuleDetails('css_consolidation')">
                        <div class="rule-title">Single Canonical CSS System</div>
                        <div class="rule-path">_dev_patterns/css_consolidation</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('ai_activation')">
                        <div class="rule-title">Global AI System Loading</div>
                        <div class="rule-path">_dev_patterns/ai_activation</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('graphrag_driven_development')">
                        <div class="rule-title">Use GraphRAG Intelligence to Guide Development</div>
                        <div class="rule-path">_dev_patterns/graphrag_driven_development</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('auth_unification')">
                        <div class="rule-title">Single Auth Implementation</div>
                        <div class="rule-path">_dev_patterns/auth_unification</div>
                    </li>
                </ul>
            </div>

            <!-- Active Issues Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üêõ</span>
                    <h2 class="card-title">Active Issues</h2>
                    <span class="card-count">3 Issues</span>
                </div>
                <ul class="rules-list" id="issues-list">
                    <li class="rule-item" onclick="showRuleDetails('auth_fragmentation')">
                        <div class="rule-title">Auth System Fragmentation</div>
                        <div class="rule-path">_issues/auth_fragmentation</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('deprecated_css_references')">
                        <div class="rule-title">580 Pages Reference Deprecated CSS</div>
                        <div class="rule-path">_issues/deprecated_css_references</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('games_quality_10')">
                        <div class="rule-title">Y9 Ecology Games Quality 10 Bug</div>
                        <div class="rule-path">_issues/games_quality_10</div>
                    </li>
                </ul>
            </div>

            <!-- Session Learnings Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üí°</span>
                    <h2 class="card-title">Session Learnings</h2>
                    <span class="card-count">4 Insights</span>
                </div>
                <ul class="rules-list" id="learnings-list">
                    <li class="rule-item" onclick="showRuleDetails('oct18_graphrag_build')">
                        <div class="rule-title">October 18 GraphRAG Completion Session</div>
                        <div class="rule-path">_session_learnings/oct18_graphrag_build</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('teaching_variants_goldmine')">
                        <div class="rule-title">Teaching Variants Discovery (13,042 Options)</div>
                        <div class="rule-path">_session_learnings/teaching_variants_goldmine</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('wordle_dialectical')">
                        <div class="rule-title">Legacy Wordle Superior to Current</div>
                        <div class="rule-path">_session_learnings/wordle_dialectical</div>
                    </li>
                    <li class="rule-item" onclick="showRuleDetails('homepage_bloat_pattern')">
                        <div class="rule-title">Homepage Bloat Anti-Pattern</div>
                        <div class="rule-path">_session_learnings/homepage_bloat_pattern</div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- SQL Examples -->
        <div class="query-interface">
            <h2 style="margin-top: 0; color: #1f2937;">üìö SQL Query Examples</h2>
            
            <h3 style="color: #374151; margin-top: 1.5rem;">Query All Agent Rules:</h3>
            <div class="sql-example">SELECT title, metadata FROM graphrag_resources<br>WHERE file_path LIKE '_agent_rules/%'<br>ORDER BY quality_score DESC;</div>

            <h3 style="color: #374151; margin-top: 1.5rem;">Find Active Issues by Priority:</h3>
            <div class="sql-example">SELECT title, metadata->>'priority' as priority,<br>       metadata->>'status' as status<br>FROM graphrag_resources<br>WHERE file_path LIKE '_issues/%'<br>  AND metadata->>'status' = 'open'<br>ORDER BY metadata->>'priority';</div>

            <h3 style="color: #374151; margin-top: 1.5rem;">Query Development Patterns:</h3>
            <div class="sql-example">SELECT title, metadata->>'pattern' as pattern,<br>       metadata->>'lesson_learned' as lesson<br>FROM graphrag_resources<br>WHERE file_path LIKE '_dev_patterns/%';</div>

            <h3 style="color: #374151; margin-top: 1.5rem;">Get Session Learnings:</h3>
            <div class="sql-example">SELECT title, metadata->>'key_learnings' as learnings,<br>       metadata->>'date' as session_date<br>FROM graphrag_resources<br>WHERE file_path LIKE '_session_learnings/%'<br>ORDER BY created_at DESC;</div>
        </div>
    </div>

    <script>
        // Supabase Configuration (from AGENT-README.md)
        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';

        function loadQuickQuery(type) {
            const queries = {
                'agent_rules': "SELECT * FROM graphrag_resources WHERE file_path LIKE '_agent_rules/%';",
                'dev_patterns': "SELECT * FROM graphrag_resources WHERE file_path LIKE '_dev_patterns/%';",
                'issues': "SELECT * FROM graphrag_resources WHERE file_path LIKE '_issues/%';",
                'learnings': "SELECT * FROM graphrag_resources WHERE file_path LIKE '_session_learnings/%';",
                'all_agent': "SELECT * FROM graphrag_resources WHERE file_path ~ '^_(agent|dev|issues|session)';"
            };
            document.getElementById('sql-query').value = queries[type];
        }

        async function executeQuery() {
            const query = document.getElementById('sql-query').value;
            const resultsDiv = document.getElementById('query-results');
            const contentDiv = document.getElementById('results-content');
            
            resultsDiv.classList.add('active');
            contentDiv.innerHTML = '<div class="loading">‚è≥ Executing query...</div>';

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/execute_sql`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) {
                    throw new Error(`Query failed: ${response.statusText}`);
                }

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                contentDiv.innerHTML = `<div style="color: #dc2626; padding: 1rem; background: #fee2e2; border-radius: 8px;">
                    <strong>Error:</strong> ${error.message}
                    <br><br>
                    <em>Note: Direct SQL execution may require special permissions. Try using the Python scripts instead:</em>
                    <div class="sql-example" style="margin-top: 1rem;">python3 query-graphrag.py "${query}"</div>
                </div>`;
            }
        }

        function displayResults(data) {
            const contentDiv = document.getElementById('results-content');
            
            if (!data || data.length === 0) {
                contentDiv.innerHTML = '<p style="color: #6b7280;">No results found.</p>';
                return;
            }

            let html = `<p style="color: #059669; font-weight: 600; margin-bottom: 1rem;">‚úÖ Found ${data.length} result(s)</p>`;
            html += '<div style="overflow-x: auto;">';
            html += '<table style="width: 100%; border-collapse: collapse;">';
            
            // Header
            html += '<thead><tr style="background: #f3f4f6;">';
            const keys = Object.keys(data[0]);
            keys.forEach(key => {
                html += `<th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #e5e7eb; font-weight: 600; color: #374151;">${key}</th>`;
            });
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            data.forEach((row, idx) => {
                html += `<tr style="background: ${idx % 2 === 0 ? 'white' : '#f9fafb'};">`;
                keys.forEach(key => {
                    let value = row[key];
                    if (typeof value === 'object') value = JSON.stringify(value);
                    html += `<td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb; color: #4b5563;">${value || '-'}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table></div>';
            
            contentDiv.innerHTML = html;
        }

        function showRuleDetails(ruleId) {
            alert(`Feature coming soon: Detailed view for ${ruleId}\n\nFor now, use the SQL query interface to explore this rule's metadata and relationships.`);
        }

        // Load real-time stats on page load
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // This would ideally fetch from Supabase, but for now we use the values from AGENT-README
                console.log('Agent Dashboard loaded successfully');
                console.log('GraphRAG Stats: 12,063 total resources, 16 agent coordination nodes');
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        });
    </script>
</body>
</html>

