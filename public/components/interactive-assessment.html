<!-- üéØ INTERACTIVE ASSESSMENT COMPONENT --><!-- Embeddable quiz/assessment system for any resource --><!-- Usage: Add this component at the end of any lesson --><div class="assessment-container" style="    margin: 3rem 0;    border: 3px solid #0284c7;">    <div class="assessment-header" >        <h2 style="color: #0c4a6e; font-size: 2rem; ">            ‚úçÔ∏è Check Your Understanding        </h2>        <p style="color: #475569; font-size: 1.125rem;">            Test what you've learned - instant feedback provided!        </p>    </div>    <!-- Questions will be loaded here -->    <div id="assessment-questions"></div>    <!-- Submit button -->    <div id="assessment-submit-container" style="display: none; margin-top: 2rem;">        <button id="submit-assessment" class="p-4" style="            color: white;            border: none;            padding: 1rem 3rem;            font-size: 1.125rem;            cursor: pointer;            transition: all 0.2s;        "            ‚úÖ Submit Answers        </button>    </div>    <!-- Results (hidden initially) -->    <div id="assessment-results" style="display: none;"></div></div><script>class InteractiveAssessment {    constructor() {        this.questions = [];        this.studentAnswers = {};        this.supabase = null;        this.user = null;        this.resourcePath = window.location.pathname;        this.init();    }    async init() {        // Get Supabase client        this.supabase = window.supabaseClient || window.getSupabaseClient();        // Get current user        if (this.supabase) {            const { data: { user } } = await this.supabase.auth.getUser();            this.user = user;        }        // Load questions        await this.loadQuestions();        // Render assessment        this.render();        // Set up submit handler        document.getElementById('submit-assessment')?.addEventListener('click', () => this.submit());    }    async loadQuestions() {        // Try to load from database first        if (this.supabase) {            try {                const { data, error } = await this.supabase                    .from('assessment_questions')                    .select('*')                    .eq('resource_path', this.resourcePath)                    .order('question_order');                if (!error && data && data.length > 0) {                    this.questions = data;                    return;                }            } catch (e) {                console.log('No database questions, using inline');            }        }        // Fallback: Use inline questions if specified        const inlineQuestions = window.ASSESSMENT_QUESTIONS || [];        this.questions = inlineQuestions;    }    render() {        if (this.questions.length === 0) {            document.querySelector('.assessment-container').style.display = 'none';            return;        }        const container = document.getElementById('assessment-questions');        let html = '';        this.questions.forEach((q, index) => {            html += this.renderQuestion(q, index);        });        container.innerHTML = html;        // Show submit button        document.getElementById('assessment-submit-container').style.display = 'block';    }    renderQuestion(question, index) {        const qNum = index + 1;        let html = `            <div class="question" style="                margin-bottom: 1.5rem;                ">                <div style="align-items: start; gap: 1rem; ">                    <span style="                        background: #0284c7;                        color: white;                        width: 32px;                        border-radius: 50%;                        align-items: center;                        justify-content: center;                        flex-shrink: 0;                    ">${qNum}</span>                    <p style="color: #0f172a; font-size: 1.125rem; font-weight: 500; ">                        ${question.question_text}                    </p>                </div>        `;        // Render based on question type        if (question.question_type === 'multiple_choice') {            const options = question.question_options || [];            html += '<div style="margin-left: 3rem;">';            options.forEach((option, optIdx) => {                html += `                    <label style="                        align-items: center;                        cursor: pointer;                        transition: all 0.2s;                    " class="option-label" onmouseover="this.style.borderColor='#0284c7'" onmouseout="this.style.borderColor='#e5e7eb'">                        <input type="radio" name="q${question.id}" value="${option}" style="                            margin-right: 0.75rem;                            width: 20px;                            cursor: pointer;                        ">                        <span style="color: #374151; ">${option}</span>                    </label>                `;            });            html += '</div>';        } else if (question.question_type === 'short_answer') {            html += `                <input type="text"                    id="answer-${question.id}"                    placeholder="Type your answer here..."                    style="                        margin-left: 3rem;                        ">            `;        } else if (question.question_type === 'essay') {            html += `                <textarea                    id="answer-${question.id}"                    rows="5"                    placeholder="Write your answer here (minimum 3 sentences)..."                    style="                        resize: vertical;                        margin-left: 3rem;                        "></textarea>            `;        } else if (question.question_type === 'true_false') {            html += `                <div style="margin-left: 3rem; gap: 1rem;">                    <label style="                        flex: 1;                        cursor: pointer;                        transition: all 0.2s;                    " class="option-label" onmouseover="this.style.borderColor='#059669'" onmouseout="this.style.borderColor='#e5e7eb'">                        <input type="radio" name="q${question.id}" value="True" style="display: none;">                        <span style="font-size: 1.125rem; color: #059669;">‚úì TRUE</span>                    </label>                    <label style="                        flex: 1;                        cursor: pointer;                        transition: all 0.2s;                    " class="option-label" onmouseover="this.style.borderColor='#dc2626'" onmouseout="this.style.borderColor='#e5e7eb'">                        <input type="radio" name="q${question.id}" value="False" style="display: none;">                        <span style="font-size: 1.125rem; color: #dc2626;">‚úó FALSE</span>                    </label>                </div>            `;        }        // Cultural context (if provided)        if (question.cultural_context) {            html += `                <div style="                    background: #fef3c7;                    margin-top: 1rem;                    ">                    <strong style="color: #92400e;">üåø Cultural Note:</strong>                    <span style="color: #78350f;"> ${question.cultural_context}</span>                </div>            `;        }        html += '</div>';        return html;    }    async submit() {        const submitBtn = document.getElementById('submit-assessment');        submitBtn.disabled = true;        submitBtn.innerHTML = '‚è≥ Checking answers...';        // Collect answers        this.questions.forEach(q => {            if (q.question_type === 'multiple_choice' || q.question_type === 'true_false') {                const selected = document.querySelector(`input[name="q${q.id}"]:checked`);                this.studentAnswers[q.id] = selected ? selected.value : null;            } else {                const input = document.getElementById(`answer-${q.id}`);                this.studentAnswers[q.id] = input ? input.value : null;            }        });        // Calculate score        let correct = 0;        let total = this.questions.length;        this.questions.forEach(q => {            const studentAnswer = this.studentAnswers[q.id];            if (q.question_type === 'multiple_choice' || q.question_type === 'true_false') {                if (studentAnswer === q.correct_answer) {                    correct++;                }            }            // Essay and short answer need manual grading        });        const score = Math.round((correct / total) * 100);        // Save to database if logged in        if (this.user && this.supabase) {            await this.saveToDatabase(score);        }        // Show results        this.showResults(correct, total, score);    }    async saveToDatabase(score) {        try {            // Save each response            for (const [questionId, answer] of Object.entries(this.studentAnswers)) {                const question = this.questions.find(q => q.id === questionId);                const isCorrect = answer === question?.correct_answer;                await this.supabase                    .from('student_responses')                    .upsert({                        student_id: this.user.id,                        question_id: questionId,                        response_text: answer,                        is_correct: isCorrect,                        points_earned: isCorrect ? (question.points || 1) : 0                    });            }            // User feedback provided via UI        } catch (e) {            // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        }    }    showResults(correct, total, score) {        const resultsDiv = document.getElementById('assessment-results');        let message, emoji, bgColor, textColor;        if (score >= 90) {            message = 'Outstanding! Excellent understanding!';            emoji = 'üåü';            bgColor = '#f0fdf4';            textColor = '#059669';        } else if (score >= 75) {            message = 'Great work! Strong understanding!';            emoji = 'üéâ';            bgColor = '#f0f9ff';            textColor = '#0284c7';        } else if (score >= 50) {            message = 'Good effort! Review the material and try again.';            emoji = 'üëç';            bgColor = '#fef3c7';            textColor = '#f59e0b';        } else {            message = 'Keep learning! Review the lesson and try again.';            emoji = 'üí™';            bgColor = '#fee2e2';            textColor = '#dc2626';        }        resultsDiv.innerHTML = `            <div style="                background: ${bgColor};                border: 3px solid ${textColor};                margin-top: 2rem;            ">                <div style="font-size: 4rem; ">${emoji}</div>                <h3 style="color: ${textColor}; font-size: 2rem; ">                    ${correct} out of ${total} correct!                </h3>                <p style="color: ${textColor}; font-size: 1.25rem; ">                    Score: ${score}%                </p>                <p style="color: #374151; font-size: 1.125rem;">                    ${message}                </p>                ${this.user ? `                    <div style="                        background: rgba(255,255,255,0.8);                        margin-top: 1rem;                    ">                        <p style="color: #059669; ">                            ‚úÖ Your answers have been saved and your teacher has been notified!                        </p>                    </div>                ` : `                    <div style="                        background: rgba(255,255,255,0.8);                        margin-top: 1rem;                    ">                        <p style="color: #6b7280; ">                            üí° Login to save your progress and let your teacher see your results!                        </p>                    </div>                `}                <button onclick="location.reload()" class="p-3" style="                    color: ${textColor};                    padding: 0.75rem 2rem;                    cursor: pointer;                    margin-top: 1rem;                "                    üîÑ Try Again                </button>            </div>        `;        resultsDiv.style.display = 'block';        // Hide questions and submit button        document.getElementById('assessment-questions').style.opacity = '0.5';        document.getElementById('assessment-submit-container').style.display = 'none';        // Scroll to results        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });    }}// Initialize when page loadsif (document.readyState === 'loading') {    document.addEventListener('DOMContentLoaded', () => new InteractiveAssessment());} else {    new InteractiveAssessment();}// Make globally accessiblewindow.InteractiveAssessment = InteractiveAssessment;</script><!--USAGE EXAMPLE:Add this to your lesson HTML, then define questions in a script tag:<script>window.ASSESSMENT_QUESTIONS = [    {        id: 'q1',        question_order: 1,        question_type: 'multiple_choice',        question_text: 'What does "whenua" mean in digital context?',        question_options: ['Digital land/space', 'Computer', 'Internet', 'Website'],        correct_answer: 'Digital land/space',        points: 1,        cultural_context: 'Whenua connects physical land to digital spaces as places needing care'    },    {        id: 'q2',        question_order: 2,        question_type: 'true_false',        question_text: 'Digital Kaitiakitanga means protecting our digital spaces like we protect the land.',        correct_answer: 'True',        points: 1    },    {        id: 'q3',        question_order: 3,        question_type: 'short_answer',        question_text: 'Name one way you can be a digital kaitiaki (guardian) in your own online life.',        correct_answer: null, // Teacher will grade manually        points: 2    }];</script>-->