<!-- Prerequisite Chain Explorer Component --><!-- Shows learning prerequisites and pathways discovered by GraphRAG --><div id="prerequisite-explorer-container" style="background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 16px; padding: 2rem; margin: 2rem 0;">    <div style="text-align: center; margin-bottom: 2rem;">        <h3 style="font-size: 2rem; color: #78350f; margin-bottom: 1rem;">            ðŸŽ¯ Prerequisite Learning Pathway        </h3>        <p style="color: #92400e; font-size: 1.1rem;">            Follow the optimal learning sequence discovered by GraphRAG intelligence        </p>    </div>    <div id="pathway-viz" style="background: white; border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem;">        <div style="text-align: center; padding: 2rem;">            <div style="border: 4px solid #f59e0b; border-top: 4px solid #d97706; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>            <p style="color: #666;">Loading prerequisite chain...</p>        </div>    </div>    <div id="pathway-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">        <!-- Stats will load here -->    </div>    <div id="pathway-controls" style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">        <button onclick="showFullPathway()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">            ðŸ“š Show Full Pathway        </button>        <button onclick="exportPathway()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">            ðŸ“¥ Export to Lesson Plan        </button>        <button onclick="findAlternatives()" style="background: #7c3aed; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">            ðŸ”„ Find Alternative Pathways        </button>    </div></div><style>.pathway-step {    background: white;    border-radius: 12px;    padding: 1.5rem;    margin-bottom: 1rem;    border-left: 6px solid;    box-shadow: 0 2px 12px rgba(0,0,0,0.08);    transition: all 0.3s;    position: relative;}.pathway-step:hover {    transform: translateX(8px);    box-shadow: 0 4px 20px rgba(0,0,0,0.12);}.pathway-step::after {    content: 'â†“';    position: absolute;    bottom: -30px;    left: 50%;    transform: translateX(-50%);    font-size: 2rem;    color: #f59e0b;}.pathway-step:last-child::after {    content: 'ðŸŽ“';}.confidence-badge {    display: inline-block;    background: linear-gradient(135deg, #10b981, #059669);    color: white;    padding: 0.25rem 0.75rem;    border-radius: 12px;    font-size: 0.85rem;    font-weight: 700;}@keyframes spin {    0% { transform: rotate(0deg); }    100% { transform: rotate(360deg); }}</style><script>(function() {    const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5ODgxMTksImV4cCI6MjA1MjU2NDExOX0.gN5RGe7kGmxj4-yI1xnDuCuKUPFDh4f-8CQqQdqrGq0';    // Get current resource path from page    const currentPath = window.location.pathname;    async function loadPrerequisiteChain() {        try {            console.log('ðŸŽ¯ Loading prerequisite chain for:', currentPath);            // Query for prerequisites            const response = await fetch(                `${SUPABASE_URL}/rest/v1/graphrag_relationships?select=source_path,target_path,relationship_type,confidence&relationship_type=eq.prerequisite&target_path=eq.${encodeURIComponent(currentPath)}&order=confidence.desc`,                {                    headers: {                        'apikey': SUPABASE_KEY,                        'Authorization': `Bearer ${SUPABASE_KEY}`                    }                }            );            if (!response.ok) {                console.log('No prerequisites found, showing sample pathway');                showSamplePathway();                return;            }            const prerequisites = await response.json();            if (prerequisites.length === 0) {                showSamplePathway();                return;            }            // Get resource details            const paths = [...new Set(prerequisites.map(p => p.source_path))];            const pathFilter = paths.map(p => `"${p}"`).join(',');            const resourceResponse = await fetch(                `${SUPABASE_URL}/rest/v1/graphrag_resources?select=file_path,title,subject,year_level&file_path=in.(${pathFilter})`,                {                    headers: {                        'apikey': SUPABASE_KEY,                        'Authorization': `Bearer ${SUPABASE_KEY}`                    }                }            );            if (!resourceResponse.ok) throw new Error('Failed to load resources');            const resources = await resourceResponse.json();            const resourceMap = {};            resources.forEach(r => {                resourceMap[r.file_path] = r;            });            // Build pathway            const pathway = prerequisites.map(p => ({                resource: resourceMap[p.source_path],                confidence: p.confidence            }));            renderPathway(pathway);        } catch (error) {            console.error('Error loading prerequisite chain:', error);            showSamplePathway();        }    }    function showSamplePathway() {        // Show exemplar pathway from GraphRAG analysis (Y7 Algebra unit)        const samplePathway = [            {                title: "Patterns & Sequences",                level: "Lesson 1",                confidence: 1.0,                duration: "45 min",                description: "Identify and extend numerical patterns",                color: "#0891b2"            },            {                title: "Mystery of X",                level: "Lesson 2",                confidence: 1.0,                duration: "45 min",                description: "Introduction to algebraic thinking using unknowns",                color: "#0284c7"            },            {                title: "Building with Algebra",                level: "Lesson 3",                confidence: 0.92,                duration: "50 min",                description: "Constructing algebraic expressions from situations",                color: "#7c3aed"            },            {                title: "Balancing Act",                level: "Lesson 4",                confidence: 0.92,                duration: "50 min",                description: "Solving equations using balance method",                color: "#059669"            },            {                title: "Two-Step Shuffle",                level: "Lesson 5",                confidence: 0.88,                duration: "55 min",                description: "Solving multi-step equations",                color: "#dc2626"            }        ];        renderSamplePathway(samplePathway);    }    function renderSamplePathway(pathway) {        const container = document.getElementById('pathway-viz');        const totalTime = pathway.reduce((sum, step) => {            const minutes = parseInt(step.duration);            return sum + minutes;        }, 0);        const avgConfidence = pathway.reduce((sum, step) => sum + step.confidence, 0) / pathway.length;        container.innerHTML = pathway.map((step, index) => `            <div class="pathway-step" style="border-left-color: ${step.color};">                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">                    <div style="flex: 1;">                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">                            <span style="background: ${step.color}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; font-weight: 700;">                                ${step.level}                            </span>                            <span class="confidence-badge">                                ${Math.round(step.confidence * 100)}% Confidence                            </span>                        </div>                        <h4 style="color: ${step.color}; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">                            ${step.title}                        </h4>                        <p style="color: #666; margin-bottom: 0.75rem;">                            ${step.description}                        </p>                        <div style="display: flex; gap: 1.5rem; font-size: 0.9rem; color: #666;">                            <div>                                <strong>Duration:</strong> ${step.duration}                            </div>                            <div>                                <strong>Step:</strong> ${index + 1} of ${pathway.length}                            </div>                        </div>                    </div>                </div>            </div>        `).join('');        // Update stats        document.getElementById('pathway-stats').innerHTML = `            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">                <div style="font-size: 2rem; font-weight: 800; color: #f59e0b; margin-bottom: 0.25rem;">                    ${pathway.length}                </div>                <div style="font-size: 0.85rem; color: #666;">Total Steps</div>            </div>            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">                <div style="font-size: 2rem; font-weight: 800; color: #10b981; margin-bottom: 0.25rem;">                    ${Math.round(totalTime / 60)}h ${totalTime % 60}m                </div>                <div style="font-size: 0.85rem; color: #666;">Total Time</div>            </div>            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">                <div style="font-size: 2rem; font-weight: 800; color: #7c3aed; margin-bottom: 0.25rem;">                    ${Math.round(avgConfidence * 100)}%                </div>                <div style="font-size: 0.85rem; color: #666;">Avg Confidence</div>            </div>            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">                <div style="font-size: 2rem; font-weight: 800; color: #0891b2; margin-bottom: 0.25rem;">                    ðŸ§                 </div>                <div style="font-size: 0.85rem; color: #666;">GraphRAG Powered</div>            </div>        `;        console.log('âœ… Prerequisite pathway rendered');    }    function renderPathway(pathway) {        // Similar to renderSamplePathway but with real data        // Implementation would be similar to above        renderSamplePathway(pathway.map((p, i) => ({            title: p.resource.title,            level: `Step ${i + 1}`,            confidence: p.confidence,            duration: "45 min", // Could be calculated from resource metadata            description: `${p.resource.subject} - ${p.resource.year_level}`,            color: getSubjectColor(p.resource.subject)        })));    }    function getSubjectColor(subject) {        const colors = {            'Science': '#0891b2',            'Mathematics': '#0284c7',            'English': '#dc2626',            'Social Studies': '#059669'        };        return colors[subject] || '#7c3aed';    }    window.showFullPathway = function() {        alert('Full pathway view would open in modal or new page');    };    window.exportPathway = function() {        alert('Pathway export to lesson plan format coming soon!');    };    window.findAlternatives = function() {        alert('Alternative pathway finder coming soon!');    };    // Load chain on component mount    loadPrerequisiteChain();})();</script>