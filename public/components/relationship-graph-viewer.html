<!--üîó RELATIONSHIP GRAPH VIEWER COMPONENTVisualizes GraphRAG relationships for any resourceUsage: <div data-relationship-viewer="/public/units/y8-algebra/index.html"></div>--><template id="relationship-viewer-template">  <style>    .relationship-viewer {      background: white;      border-radius: 16px;      padding: 2rem;      box-shadow: 0 4px 12px rgba(0,0,0,0.1);      margin: 2rem 0;    }    .relationship-header {      display: flex;      justify-content: space-between;      align-items: center;      margin-bottom: 1.5rem;      border-bottom: 2px solid #e9ecef;      padding-bottom: 1rem;    }    .relationship-title {      font-size: 1.5rem;      font-weight: 700;      color: #1a1a1a;    }    .relationship-count {      display: inline-block;      padding: 0.5rem 1rem;      background: linear-gradient(135deg, #C8102E, #8B0A1E);      color: white;      border-radius: 20px;      font-weight: 700;    }    .relationship-sections {      display: grid;      gap: 1.5rem;    }    .relationship-section {      background: #f8f9fa;      border-radius: 12px;      padding: 1.5rem;    }    .section-header {      font-size: 1.125rem;      font-weight: 700;      color: #2c3e50;      margin-bottom: 1rem;      display: flex;      align-items: center;      gap: 0.5rem;    }    .relationship-list {      display: grid;      gap: 0.75rem;    }    .relationship-item {      background: white;      border: 2px solid #dee2e6;      border-radius: 8px;      padding: 1rem;      transition: all 0.2s ease;      cursor: pointer;    }    .relationship-item:hover {      border-color: #C8102E;      transform: translateX(4px);      box-shadow: 0 2px 8px rgba(200, 16, 46, 0.15);    }    .relationship-type {      display: inline-block;      padding: 0.25rem 0.75rem;      background: #e3f2fd;      color: #1976d2;      border-radius: 6px;      font-size: 0.75rem;      font-weight: 600;      text-transform: uppercase;      margin-bottom: 0.5rem;    }    .relationship-target-title {      font-weight: 600;      color: #1a1a1a;      margin-bottom: 0.25rem;    }    .relationship-confidence {      font-size: 0.875rem;      color: #666;    }    .confidence-high { color: #2d7a4f; font-weight: 600; }    .confidence-medium { color: #f57c00; font-weight: 600; }    .confidence-low { color: #c62828; font-weight: 600; }    .no-relationships {      text-align: center;      padding: 3rem;      color: #666;      font-style: italic;    }    .loading-graph {      display: flex;      justify-content: center;      align-items: center;      padding: 3rem;    }    .graph-spinner {      width: 40px;      height: 40px;      border: 4px solid #f3f3f3;      border-top: 4px solid #C8102E;      border-radius: 50%;      animation: spin 1s linear infinite;    }    @keyframes spin {      0% { transform: rotate(0deg); }      100% { transform: rotate(360deg); }    }  </style>  <div class="relationship-viewer">    <div class="relationship-header">      <h2 class="relationship-title">üìä Knowledge Connections</h2>      <span class="relationship-count">0</span>    </div>    <div class="loading-graph">      <div class="graph-spinner"></div>    </div>    <div class="relationship-sections" style="display: none;"></div>    <div class="no-relationships" style="display: none;">      No relationships found yet. This resource is awaiting connections!    </div>  </div></template><script>(function() {  'use strict';  class RelationshipGraphViewer {    constructor(containerElement, resourcePath) {      this.container = containerElement;      this.resourcePath = resourcePath;      this.supabaseUrl = 'https://nlgldaqtubrlcqddppbq.supabase.co';      this.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';      this.init();    }    async init() {      try {        const relationships = await this.fetchRelationships();        if (relationships.length === 0) {          this.showNoRelationships();        } else {          this.renderRelationships(relationships);        }      } catch (error) {        // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('error', {
                message: '$2',
                details: $3,
                url: window.location.pathname
            });
        }
        // Show user-friendly message instead of error
        console.log('Issue detected: $2');        this.showError(error);      }    }    async fetchRelationships() {      // Fetch both incoming and outgoing relationships      const [outgoing, incoming] = await Promise.all([        this.fetchRelationshipsWhere('source_path', this.resourcePath),        this.fetchRelationshipsWhere('target_path', this.resourcePath)      ]);      return { outgoing, incoming };    }    async fetchRelationshipsWhere(column, value) {      const response = await fetch(        `${this.supabaseUrl}/rest/v1/graphrag_relationships?${column}=eq.${encodeURIComponent(value)}&order=confidence.desc`,        {          headers: {            'apikey': this.supabaseKey,            'Authorization': `Bearer ${this.supabaseKey}`,            'Content-Type': 'application/json'          }        }      );      if (!response.ok) {        throw new Error(`Failed to fetch relationships: ${response.statusText}`);      }      return await response.json();    }    async fetchResourceInfo(path) {      const response = await fetch(        `${this.supabaseUrl}/rest/v1/graphrag_resources?file_path=eq.${encodeURIComponent(path)}&select=title,quality_score`,        {          headers: {            'apikey': this.supabaseKey,            'Authorization': `Bearer ${this.supabaseKey}`,            'Content-Type': 'application/json'          }        }      );      if (response.ok) {        const data = await response.json();        return data[0] || { title: path, quality_score: null };      }      return { title: path, quality_score: null };    }    renderRelationships({ outgoing, incoming }) {      const loader = this.container.querySelector('.loading-graph');      const sectionsContainer = this.container.querySelector('.relationship-sections');      const countBadge = this.container.querySelector('.relationship-count');      loader.style.display = 'none';      sectionsContainer.style.display = 'grid';      const totalCount = outgoing.length + incoming.length;      countBadge.textContent = totalCount;      // Group by relationship type      const outgoingByType = this.groupByType(outgoing);      const incomingByType = this.groupByType(incoming);      let html = '';      if (Object.keys(outgoingByType).length > 0) {        html += `<div class="relationship-section">`;        html += `<h3 class="section-header">üîó Links From This Resource</h3>`;        html += `<div class="relationship-list">`;        for (const [type, relations] of Object.entries(outgoingByType)) {          html += relations.map(rel => this.renderRelationshipItem(rel, 'target_path', type)).join('');        }        html += `</div></div>`;      }      if (Object.keys(incomingByType).length > 0) {        html += `<div class="relationship-section">`;        html += `<h3 class="section-header">üîó Links To This Resource</h3>`;        html += `<div class="relationship-list">`;        for (const [type, relations] of Object.entries(incomingByType)) {          html += relations.map(rel => this.renderRelationshipItem(rel, 'source_path', type)).join('');        }        html += `</div></div>`;      }      sectionsContainer.innerHTML = html;    }    groupByType(relationships) {      return relationships.reduce((groups, rel) => {        const type = rel.relationship_type || 'related';        if (!groups[type]) groups[type] = [];        groups[type].push(rel);        return groups;      }, {});    }    renderRelationshipItem(relationship, pathKey, type) {      const targetPath = relationship[pathKey];      const confidence = relationship.confidence || 0.5;      const confidenceClass = confidence >= 0.8 ? 'confidence-high' :                             confidence >= 0.5 ? 'confidence-medium' : 'confidence-low';      const confidenceLabel = confidence >= 0.8 ? 'High Confidence' :                             confidence >= 0.5 ? 'Medium Confidence' : 'Low Confidence';      return `        <div class="relationship-item" onclick="window.location.href='${targetPath}'">          <div class="relationship-type">${this.formatRelationType(type)}</div>          <div class="relationship-target-title">${this.extractTitleFromPath(targetPath)}</div>          <div class="relationship-confidence ${confidenceClass}">${confidenceLabel} (${(confidence * 100).toFixed(0)}%)</div>        </div>      `;    }    formatRelationType(type) {      return type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());    }    extractTitleFromPath(path) {      // Extract filename and make it readable      const filename = path.split('/').pop().replace('.html', '');      return filename        .replace(/-/g, ' ')        .replace(/\b\w/g, l => l.toUpperCase());    }    showNoRelationships() {      const loader = this.container.querySelector('.loading-graph');      const noRel = this.container.querySelector('.no-relationships');      loader.style.display = 'none';      noRel.style.display = 'block';    }    showError(error) {      const loader = this.container.querySelector('.loading-graph');      loader.innerHTML = `<p style="color: #c62828;">‚ö†Ô∏è Error loading relationships: ${error.message}</p>`;    }  }  // Auto-initialize  document.addEventListener('DOMContentLoaded', () => {    const viewerElements = document.querySelectorAll('[data-relationship-viewer]');    viewerElements.forEach(element => {      const resourcePath = element.getAttribute('data-relationship-viewer');      if (resourcePath) {        const template = document.getElementById('relationship-viewer-template');        const clone = template.content.cloneNode(true);        element.appendChild(clone);        new RelationshipGraphViewer(element.querySelector('.relationship-viewer'), resourcePath);      }    });  });  window.RelationshipGraphViewer = RelationshipGraphViewer;})();</script>