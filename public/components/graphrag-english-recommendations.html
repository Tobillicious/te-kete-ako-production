<!-- GraphRAG English Recommendations Component --><section id="graphrag-english-recommendations" style="background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%); color: white; padding: 4rem 2rem; margin: 3rem 0; border-radius: 20px; box-shadow: 0 12px 32px rgba(127, 29, 29, 0.3); position: relative; overflow: hidden;">    <!-- Animated Background Pattern -->    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05; background-image: url(\"data:image/svg+xml,%3Csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='20' y='50' font-size='48' fill='white' font-family='serif' font-style='italic'%3E\"%3C/text%3E%3C/svg%3E\"); background-repeat: repeat; animation: drift 30s linear infinite;"></div>    <div style="max-width: 1200px; margin: 0 auto; position: relative; z-index: 2;">        <div style="text-align: center; margin-bottom: 3rem;">            <div style="display: inline-block; background: linear-gradient(135deg, #dc2626, #ef4444); padding: 0.5rem 1.5rem; border-radius: 24px; margin-bottom: 1rem; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);">                <span style="color: white; font-weight: 700; font-size: 0.9rem;">üß† GRAPHRAG INTELLIGENCE</span>            </div>            <h2 style="font-size: 2.75rem; color: white; margin-bottom: 1rem; font-weight: 800;">                Discover English Resources            </h2>            <p style="font-size: 1.2rem; color: rgba(255,255,255,0.9); max-width: 700px; margin: 0 auto 0.5rem; line-height: 1.6;">                Powered by <strong>231,469 knowledge graph relationships</strong>            </p>            <p style="font-size: 1rem; color: rgba(255,255,255,0.7); margin: 0 auto;">                AI-curated from 19,737 resources across the platform            </p>        </div>        <div id="graphrag-english-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">            <!-- Loading State -->            <div style="text-align: center; padding: 3rem; grid-column: 1 / -1;">                <div style="border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 0 auto 1.5rem;"></div>                <p style="opacity: 0.9; font-size: 1.1rem;">Loading intelligent English recommendations...</p>            </div>        </div>        <div style="text-align: center; margin-top: 2.5rem; padding-top: 2rem; border-top: 2px solid rgba(255,255,255,0.2);">            <a href="/advanced-search-graphrag.html" style="display: inline-block; background: white; color: #dc2626; padding: 1rem 2.5rem; border-radius: 12px; text-decoration: none; font-weight: 700; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: all 0.3s; border: 2px solid white;">                üîç Explore Full GraphRAG Search ‚Üí            </a>        </div>    </div></section><style>@keyframes spin {    0% { transform: rotate(0deg); }    100% { transform: rotate(360deg); }}@keyframes drift {    0% { transform: translateX(0); }    100% { transform: translateX(-80px); }}@keyframes fadeInUp {    from { opacity: 0; transform: translateY(30px); }    to { opacity: 1; transform: translateY(0); }}.english-resource-card {    animation: fadeInUp 0.6s ease-out forwards;    opacity: 0;}</style><script>(async function() {    const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';    try {        const url = `${SUPABASE_URL}/rest/v1/graphrag_resources`;        const headers = {            'apikey': SUPABASE_ANON_KEY,            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`        };        // Query for high-quality English resources        const queryParams = new URLSearchParams({            select: 'file_path,title,resource_type,subject,quality_score,cultural_context,year_level,has_te_reo,has_whakataukƒ´',            or: '(subject.ilike.%english%,title.ilike.%english%,title.ilike.%writing%,title.ilike.%literacy%,title.ilike.%poetry%,title.ilike.%narrative%,title.ilike.%argumentative%,file_path.ilike.%english%,file_path.ilike.%writing%)',            quality_score: 'gte.88',            order: 'quality_score.desc,cultural_context.desc',            limit: 30        });        const response = await fetch(`${url}?${queryParams}`, { headers });        if (!response.ok) {            throw new Error(`HTTP ${response.status}`);        }        const resources = await response.json();        console.log(`‚úçÔ∏è GraphRAG English: Loaded ${resources.length} premium resources (quality ‚â•88)`);        if (!resources || resources.length === 0) {            document.getElementById('graphrag-english-container').innerHTML = `                <div style="text-align: center; padding: 3rem; grid-column: 1 / -1;">                    <p style="opacity: 0.9; font-size: 1.1rem;">üîÆ Discovering new English resources...</p>                    <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">The knowledge graph is still being indexed!</p>                </div>            `;            return;        }        // Categorize resources        const units = resources.filter(r =>            (r.file_path?.includes('/units/') && r.subject?.toLowerCase().includes('english')) ||            r.resource_type?.toLowerCase().includes('unit')        );        const lessons = resources.filter(r =>            (r.resource_type?.toLowerCase().includes('lesson') || r.file_path?.includes('/lessons/')) &&            !units.includes(r)        );        const handouts = resources.filter(r =>            r.resource_type?.toLowerCase().includes('handout') &&            !units.includes(r) && !lessons.includes(r)        );        const writersToolkit = resources.filter(r =>            r.title?.toLowerCase().includes("writer's toolkit") ||            r.title?.toLowerCase().includes("writers toolkit")        );        // Render categories        const container = document.getElementById('graphrag-english-container');        let html = '';        // Show Writer's Toolkit first (featured collection)        if (writersToolkit.length > 0) {            html += `                <div style="grid-column: 1 / -1; margin-bottom: 1rem;">                    <h3 style="color: white; font-size: 1.5rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">                        <span>‚úçÔ∏è</span> The Writer's Toolkit (${writersToolkit.length})                    </h3>                    <p style="color: rgba(255,255,255,0.8); font-size: 0.95rem; margin-bottom: 1rem;">Essential skills handouts for developing strong writers</p>                </div>            `;            writersToolkit.forEach((resource, index) => {                html += createResourceCard(resource, '#f59e0b', index * 0.08);            });        }        // Show units        if (units.length > 0) {            html += `                <div style="grid-column: 1 / -1; margin-top: 2rem; margin-bottom: 1rem;">                    <h3 style="color: white; font-size: 1.5rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">                        <span>üìö</span> Complete English Units (${units.length})                    </h3>                </div>            `;            units.slice(0, 6).forEach((resource, index) => {                html += createResourceCard(resource, '#10b981', (writersToolkit.length + index) * 0.08);            });        }        // Show lessons        if (lessons.length > 0) {            html += `                <div style="grid-column: 1 / -1; margin-top: 2rem; margin-bottom: 1rem;">                    <h3 style="color: white; font-size: 1.5rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">                        <span>üéì</span> Full Lesson Plans (${lessons.length})                    </h3>                </div>            `;            lessons.slice(0, 8).forEach((resource, index) => {                html += createResourceCard(resource, '#3b82f6', (writersToolkit.length + units.length + index) * 0.08);            });        }        // Show handouts (excluding Writer's Toolkit)        const otherHandouts = handouts.filter(h => !writersToolkit.includes(h));        if (otherHandouts.length > 0) {            html += `                <div style="grid-column: 1 / -1; margin-top: 2rem; margin-bottom: 1rem;">                    <h3 style="color: white; font-size: 1.5rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">                        <span>üìÑ</span> Print-Ready Handouts (${otherHandouts.length})                    </h3>                </div>            `;            otherHandouts.slice(0, 6).forEach((resource, index) => {                html += createResourceCard(resource, '#8b5cf6', (writersToolkit.length + units.length + lessons.length + index) * 0.08);            });        }        container.innerHTML = html;    } catch (error) {        // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('error', {
                message: '$2',
                details: $3,
                url: window.location.pathname
            });
        }
        // Show user-friendly message instead of error
        document.getElementById('graphrag-english-container').innerHTML = `            <div style="text-align: center; padding: 3rem; grid-column: 1 / -1;">                <p style="opacity: 0.9; font-size: 1.1rem;">üí° GraphRAG temporarily unavailable</p>                <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">Browse our curated collections above</p>            </div>        `;    }    function createResourceCard(resource, accentColor, delay) {        const culturalBadge = resource.cultural_context ?            '<span style="background: #14b8a6; color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.25rem;"><span>üåø</span> Cultural</span>' : '';        const teReoBadge = resource.has_te_reo ?            '<span style="background: #dc2626; color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">Te Reo</span>' : '';        const whakataukiBadge = resource.has_whakataukƒ´ ?            '<span style="background: #7c2d12; color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">Whakataukƒ´</span>' : '';        const yearBadge = resource.year_level ?            `<span style="background: rgba(255,255,255,0.2); color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">${resource.year_level}</span>` : '';        // Emoji mapping for resource types        const typeEmoji = {            'unit': 'üìö',            'lesson': 'üéì',            'handout': 'üìÑ',            'interactive': 'üéÆ',            'page': 'üìñ'        };        const emoji = typeEmoji[resource.resource_type?.toLowerCase()] || '‚úçÔ∏è';        return `            <a href="${resource.file_path}"               class="english-resource-card"               style="background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));                      backdrop-filter: blur(10px);                      padding: 1.5rem;                      border-radius: 16px;                      text-decoration: none;                      box-shadow: 0 4px 16px rgba(0,0,0,0.3);                      transition: all 0.3s;                      display: block;                      border: 2px solid rgba(255,255,255,0.1);                      border-left: 4px solid ${accentColor};                      animation-delay: ${delay}s;"               onmouseover="this.style.transform='translateY(-6px) scale(1.02)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.4)'; this.style.borderColor='${accentColor}';"               onmouseout="this.style.transform=''; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.3)'; this.style.borderColor='rgba(255,255,255,0.1)';">                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; flex: 1;">                        ${culturalBadge}                        ${teReoBadge}                        ${whakataukiBadge}                        ${yearBadge}                    </div>                    <span style="background: linear-gradient(135deg, #fbbf24, #f59e0b);                                 color: white;                                 padding: 0.3rem 0.7rem;                                 border-radius: 8px;                                 font-size: 0.75rem;                                 font-weight: 700;                                 box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);                                 display: inline-flex;                                 align-items: center;                                 gap: 0.25rem;">                        <span>‚≠ê</span> ${resource.quality_score || 95}                    </span>                </div>                <div style="display: flex; align-items: start; gap: 0.75rem; margin-bottom: 0.75rem;">                    <div style="font-size: 2rem; line-height: 1;">${emoji}</div>                    <h4 style="color: white;                               font-weight: 700;                               margin: 0;                               font-size: 1.15rem;                               line-height: 1.4;                               flex: 1;">                        ${resource.title}                    </h4>                </div>                <p style="color: rgba(255,255,255,0.8);                          font-size: 0.9rem;                          margin: 0;                          display: flex;                          align-items: center;                          gap: 0.5rem;">                    <span style="background: rgba(255,255,255,0.2); padding: 0.25rem 0.6rem; border-radius: 6px; font-weight: 600;">                        ${resource.resource_type || 'Resource'}                    </span>                    ${resource.subject ? `<span style="opacity: 0.7;">‚Ä¢</span> <span>${resource.subject}</span>` : ''}                </p>            </a>        `;    }})();</script>