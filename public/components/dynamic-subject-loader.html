<!--üé® DYNAMIC SUBJECT LOADER COMPONENTLoads real-time subject resources from GraphRAGUsage: <div id="subject-loader" data-subject="Mathematics"></div>--><template id="dynamic-subject-loader-template">  <style>    .subject-resources-grid {      display: grid;      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));      gap: 1.5rem;      margin: 2rem 0;    }    .resource-card-dynamic {      background: white;      border: 2px solid #ddd;      border-radius: 12px;      padding: 1.5rem;      transition: all 0.3s ease;      cursor: pointer;    }    .resource-card-dynamic:hover {      transform: translateY(-4px);      box-shadow: 0 8px 20px rgba(0,0,0,0.12);      border-color: var(--color-primary, #C8102E);    }    .resource-quality-badge {      display: inline-block;      padding: 0.25rem 0.75rem;      background: linear-gradient(135deg, #FFD700, #FFA500);      color: #333;      font-weight: 700;      font-size: 0.875rem;      border-radius: 20px;      margin-bottom: 0.75rem;    }    .resource-quality-badge.gold {      background: linear-gradient(135deg, #FFD700, #FFA500);    }    .resource-quality-badge.silver {      background: linear-gradient(135deg, #C0C0C0, #A8A8A8);    }    .resource-title {      font-size: 1.25rem;      font-weight: 700;      color: #1a1a1a;      margin-bottom: 0.5rem;    }    .resource-year {      display: inline-block;      padding: 0.25rem 0.75rem;      background: #e8f4f8;      color: #0066cc;      border-radius: 6px;      font-size: 0.875rem;      font-weight: 600;      margin-bottom: 0.75rem;    }    .resource-cultural {      display: flex;      align-items: center;      gap: 0.5rem;      color: #2d7a4f;      font-size: 0.875rem;      font-weight: 600;      margin-top: 0.75rem;    }    .loader-spinner {      display: flex;      justify-content: center;      align-items: center;      padding: 3rem;    }    .spinner {      width: 50px;      height: 50px;      border: 4px solid #f3f3f3;      border-top: 4px solid #C8102E;      border-radius: 50%;      animation: spin 1s linear infinite;    }    @keyframes spin {      0% { transform: rotate(0deg); }      100% { transform: rotate(360deg); }    }    .error-message {      background: #fff3cd;      border: 2px solid #ffc107;      border-radius: 8px;      padding: 1.5rem;      margin: 2rem 0;      color: #856404;    }    .stats-bar {      display: flex;      gap: 2rem;      margin-bottom: 2rem;      padding: 1.5rem;      background: linear-gradient(135deg, #f8f9fa, #e9ecef);      border-radius: 12px;    }    .stat-item {      text-align: center;    }    .stat-number {      font-size: 2rem;      font-weight: 700;      color: #C8102E;    }    .stat-label {      font-size: 0.875rem;      color: #666;      font-weight: 600;      text-transform: uppercase;    }  </style>  <div class="subject-resources-container">    <div class="loader-spinner">      <div class="spinner"></div>    </div>    <div class="stats-bar" style="display: none;"></div>    <div class="subject-resources-grid"></div>    <div class="error-message" style="display: none;"></div>  </div></template><script>(function() {  'use strict';  class DynamicSubjectLoader {    constructor(containerElement, subject) {      this.container = containerElement;      this.subject = subject;      this.supabaseUrl = 'https://nlgldaqtubrlcqddppbq.supabase.co';      this.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';      this.init();    }    async init() {      try {        const resources = await this.fetchSubjectResources();        this.renderResources(resources);        this.renderStats(resources);      } catch (error) {        this.showError(error);      }    }    async fetchSubjectResources() {      const spinner = this.container.querySelector('.loader-spinner');      spinner.style.display = 'flex';      const response = await fetch(        `${this.supabaseUrl}/rest/v1/graphrag_resources?subject=eq.${encodeURIComponent(this.subject)}&order=quality_score.desc.nullslast&limit=50`,        {          headers: {            'apikey': this.supabaseKey,            'Authorization': `Bearer ${this.supabaseKey}`,            'Content-Type': 'application/json'          }        }      );      if (!response.ok) {        throw new Error(`Failed to fetch resources: ${response.statusText}`);      }      const data = await response.json();      spinner.style.display = 'none';      return data;    }    renderStats(resources) {      const statsBar = this.container.querySelector('.stats-bar');      const totalResources = resources.length;      const goldResources = resources.filter(r => r.quality_score >= 90).length;      const culturalResources = resources.filter(r => r.cultural_integration_score >= 80).length;      const avgQuality = resources.reduce((sum, r) => sum + (r.quality_score || 0), 0) / totalResources;      statsBar.innerHTML = `        <div class="stat-item">          <div class="stat-number">${totalResources}</div>          <div class="stat-label">Total Resources</div>        </div>        <div class="stat-item">          <div class="stat-number">${goldResources}</div>          <div class="stat-label">Gold Standard</div>        </div>        <div class="stat-item">          <div class="stat-number">${culturalResources}</div>          <div class="stat-label">Culturally Integrated</div>        </div>        <div class="stat-item">          <div class="stat-number">${avgQuality.toFixed(0)}</div>          <div class="stat-label">Avg Quality</div>        </div>      `;      statsBar.style.display = 'flex';    }    renderResources(resources) {      const grid = this.container.querySelector('.subject-resources-grid');      if (resources.length === 0) {        grid.innerHTML = '<p class="text-center" >No resources found for this subject yet. Check back soon!</p>';        return;      }      grid.innerHTML = resources.map(resource => {        const qualityClass = resource.quality_score >= 90 ? 'gold' : 'silver';        const culturalIndicator = resource.cultural_integration_score >= 80          ? 'üåø Culturally Integrated'          : '';        return `          <div class="resource-card-dynamic" onclick="window.location.href='${resource.file_path}'">            <div class="resource-quality-badge ${qualityClass}">              ‚≠ê ${resource.quality_score || 'N/A'}            </div>            ${resource.year_level ? `<div class="resource-year">Year ${resource.year_level}</div>` : ''}            <h3 class="resource-title">${resource.title || 'Untitled Resource'}</h3>            ${culturalIndicator ? `<div class="resource-cultural">üåø ${culturalIndicator}</div>` : ''}          </div>        `;      }).join('');    }    showError(error) {      // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        const spinner = this.container.querySelector('.loader-spinner');      const errorDiv = this.container.querySelector('.error-message');      spinner.style.display = 'none';      errorDiv.textContent = `‚ö†Ô∏è Could not load resources: ${error.message}. Please try again later.`;      errorDiv.style.display = 'block';    }  }  // Auto-initialize on page load  document.addEventListener('DOMContentLoaded', () => {    const loaderElements = document.querySelectorAll('[data-dynamic-subject]');    loaderElements.forEach(element => {      const subject = element.getAttribute('data-dynamic-subject');      if (subject) {        const template = document.getElementById('dynamic-subject-loader-template');        const clone = template.content.cloneNode(true);        element.appendChild(clone);        new DynamicSubjectLoader(element.querySelector('.subject-resources-container'), subject);      }    });  });  // Export for manual initialization  window.DynamicSubjectLoader = DynamicSubjectLoader;})();</script>