<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TOP CULTURAL RESOURCES WIDGET
     Premium tier resources with Whakataukƒ´ + Te Reo + Q100
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<style>
.cultural-widget-section {
    margin: 3rem 0;
    padding: 2.5rem;
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border-radius: 16px;
    border-left: 4px solid var(--color-kowhai);
}

.cultural-header {
    text-align: center;
    margin-bottom: 2rem;
}

.cultural-title {
    font-size: 2.25rem;
    color: var(--color-primary);
    margin-bottom: 0.5rem;
    font-weight: 700;
}

.cultural-subtitle {
    font-size: 1.125rem;
    color: var(--color-gray-700);
}

.cultural-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.cultural-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
    display: block;
    border-top: 3px solid var(--color-kowhai);
}

.cultural-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
}

.cultural-excellence-badge {
    display: inline-block;
    padding: 0.3rem 0.9rem;
    background: linear-gradient(135deg, var(--color-kowhai), var(--color-kumara));
    color: white;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
}

.cultural-resource-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.cultural-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.875rem;
    color: var(--color-gray-600);
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
}

.cultural-features {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.cultural-feature {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.75rem;
    background: rgba(241, 143, 1, 0.1);
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-kowhai);
}

.cultural-quality {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--color-gray-200);
}

.quality-score {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-success);
}

.quality-label {
    font-size: 0.75rem;
    color: var(--color-gray-600);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}
</style>

<section class="cultural-widget-section">
    <div class="cultural-header">
        <h2 class="cultural-title">üåø Premium Cultural Resources</h2>
        <p class="cultural-subtitle">
            Excellence in mƒÅtauranga MƒÅori integration
        </p>
    </div>

    <div id="cultural-container" class="cultural-grid">
        <div style="text-align: center; padding: 2rem; grid-column: 1 / -1;">
            <div class="spinner"></div>
            <p style="color: var(--color-gray-600); margin-top: 1rem;">Loading premium cultural resources...</p>
        </div>
    </div>
</section>

<script>
(async function() {
    const supabase = window.supabaseSingleton 
        ? await window.supabaseSingleton.getClient()
        : null;

    if (!supabase) {
        console.warn('[Cultural Widget] Supabase not available');
        return;
    }

    async function loadTopCultural() {
        try {
            // Get premium cultural resources (Te Reo + Whakataukƒ´ + Q90+)
            const { data, error } = await supabase
                .from('graphrag_resources')
                .select('file_path, title, quality_score, subject, year_level, resource_type, has_te_reo, has_whakataukƒ´')
                .eq('archive_status', 'active')
                .eq('has_te_reo', true)
                .eq('has_whakataukƒ´', true)
                .gte('quality_score', 90)
                .order('quality_score', { ascending: false })
                .limit(6);

            if (error) throw error;

            renderCultural(data || []);
        } catch (err) {
            console.error('[Cultural Widget] Error:', err);
            document.getElementById('cultural-container').innerHTML = 
                '<p style="text-align: center; color: var(--color-gray-600);">Unable to load cultural resources. Please refresh.</p>';
        }
    }

    function renderCultural(resources) {
        const container = document.getElementById('cultural-container');
        
        if (!resources || resources.length === 0) {
            container.innerHTML = '<p style="text-align: center;">No cultural resources available.</p>';
            return;
        }

        container.innerHTML = '';

        resources.forEach(resource => {
            const card = createCulturalCard(resource);
            container.appendChild(card);
        });
    }

    function createCulturalCard(resource) {
        const card = document.createElement('a');
        card.className = 'cultural-card';
        card.href = resource.file_path;

        const badge = document.createElement('span');
        badge.className = 'cultural-excellence-badge';
        badge.textContent = `Q${resource.quality_score} Premium`;

        const title = document.createElement('h3');
        title.className = 'cultural-resource-title';
        title.textContent = resource.title || 'Cultural Resource';

        const meta = document.createElement('div');
        meta.className = 'cultural-meta';
        const metaParts = [];
        if (resource.subject) metaParts.push(`üìö ${resource.subject}`);
        if (resource.year_level) metaParts.push(`üéØ ${resource.year_level}`);
        if (resource.resource_type) metaParts.push(resource.resource_type);
        meta.innerHTML = metaParts.join('<span style="color: var(--color-gray-300);">‚Ä¢</span>');

        const features = document.createElement('div');
        features.className = 'cultural-features';
        
        const teReoFeature = document.createElement('span');
        teReoFeature.className = 'cultural-feature';
        teReoFeature.innerHTML = 'üó£Ô∏è Te Reo MƒÅori';
        features.appendChild(teReoFeature);

        const whakaukiFeature = document.createElement('span');
        whakaukiFeature.className = 'cultural-feature';
        whakaukiFeature.innerHTML = 'üåø Whakataukƒ´';
        features.appendChild(whakaukiFeature);

        const quality = document.createElement('div');
        quality.className = 'cultural-quality';
        quality.innerHTML = `
            <div>
                <div class="quality-score">${resource.quality_score}</div>
                <div class="quality-label">Quality</div>
            </div>
        `;

        card.appendChild(badge);
        card.appendChild(title);
        card.appendChild(meta);
        card.appendChild(features);
        card.appendChild(quality);

        return card;
    }

    // Load on ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadTopCultural);
    } else {
        loadTopCultural();
    }
})();
</script>

