<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Structure Explorer | Te Kete Ako</title>
    <meta name="description" content="Explore 500 unit structures and their lessons">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/css/te-kete-unified-design-system.css">
    <link rel="stylesheet" href="/css/component-library.css">
    <link rel="stylesheet" href="/css/enhanced-cards.css">
    
    <style>
        .unit-explorer-hero {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
        }
        
        .unit-container {
            background: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            border-top: 6px solid #16a34a;
        }
        
        .lesson-list {
            display: grid;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .lesson-item {
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 8px;
            border-left: 4px solid #16a34a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div id="nav-container"></div>
    <script>
        fetch('/components/navigation-standard.html')
            .then(r => r.text())
            .then(html => document.getElementById('nav-container').innerHTML = html);
    </script>
    
    <!-- Hero -->
    <section class="unit-explorer-hero">
        <h1 style="font-size: 4rem; margin-bottom: 1rem; font-weight: 800;">ðŸ“š Unit Structure Explorer</h1>
        <p style="font-size: 1.5rem; opacity: 0.95;">
            500 unit structures mapped from knowledge graph
        </p>
    </section>
    
    <main style="max-width: 1200px; margin: 3rem auto; padding: 0 2rem;">
        
        <div id="units-container">
            <div style="text-align: center; padding: 4rem; color: #888;">
                <p>Loading unit structures...</p>
            </div>
        </div>
        
    </main>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    <script>
        fetch('/components/footer.html').then(r=>r.text()).then(html=>{
            document.getElementById('footer-container').innerHTML=html;
        });
    </script>
    
    <script>
        // Load unit structures from GraphRAG
        async function loadUnitStructures() {
            try {
                const url = 'https://nlgldaqtubrlcqddppbq.supabase.co/rest/v1/graphrag_relationships';
                const headers = {
                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM',
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM'
                };
                
                // Query for unit_contains_lesson relationships
                const response = await fetch(`${url}?relationship_type=eq.unit_contains_lesson&order=confidence.desc&limit=50`, { headers });
                const relationships = await response.json();
                
                // Group by unit (source_path)
                const unitMap = {};
                relationships.forEach(rel => {
                    const unitPath = rel.source_path;
                    if (!unitMap[unitPath]) {
                        unitMap[unitPath] = {
                            path: unitPath,
                            lessons: []
                        };
                    }
                    unitMap[unitPath].lessons.push({
                        path: rel.target_path,
                        confidence: rel.confidence
                    });
                });
                
                displayUnits(unitMap);
                
            } catch (error) {
                console.error('Error loading unit structures:', error);
            }
        }
        
        function displayUnits(unitMap) {
            const container = document.getElementById('units-container');
            
            const html = Object.values(unitMap).map(unit => `
                <div class="unit-container">
                    <h2 style="color: #1a4d2e; margin-bottom: 0.5rem;">
                        ${unit.path.split('/').pop().replace('.html', '').replace(/-/g, ' ').toUpperCase()}
                    </h2>
                    <p style="color: #888; margin-bottom: 1rem;">${unit.lessons.length} lessons in this unit</p>
                    <a href="${unit.path}" style="color: #16a34a; text-decoration: none; font-weight: 600;">View unit overview â†’</a>
                    
                    <div class="lesson-list">
                        ${unit.lessons.map((lesson, idx) => `
                            <div class="lesson-item">
                                <div>
                                    <span style="color: #16a34a; font-weight: 700; margin-right: 0.75rem;">Lesson ${idx + 1}</span>
                                    <span style="color: #1a4d2e;">${lesson.path.split('/').pop().replace('.html', '').replace(/-/g, ' ')}</span>
                                </div>
                                <a href="${lesson.path}" style="color: #16a34a; text-decoration: none; font-size: 0.875rem;">View â†’</a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        document.addEventListener('DOMContentLoaded', loadUnitStructures);
    </script>
</body>
</html>

