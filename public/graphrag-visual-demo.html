<!DOCTYPE html><html lang="en"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>GraphRAG Knowledge Graph Visualization | Te Kete Ako</title>

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ⭐ PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ⭐ THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ⭐ COMPONENT STYLES -->
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/navigation-standard.css">
<link rel="stylesheet" href="/css/mobile-revolution.css">
<link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ⭐ PRINT STYLES (media="print" = only for printing) -->
<link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ⭐ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ⭐ CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Wait for Supabase CDN to load before initializing singleton
    window.addEventListener('DOMContentLoaded', () => {
        if (!window.supabase) {
            // Log to monitoring instead of console
            if (window.posthog) {
                posthog.capture('supabase_cdn_error', {
                    message: 'Supabase CDN failed to load',
                    url: window.location.pathname
                });
            }
        }
    });
</script>
<script src="/js/supabase-singleton.js"></script>
<!-- My Kete Database Integration - loads after singleton -->
<script src="/js/my-kete-database.js"></script>
<!-- Navigation Loader Singleton - loads after supabase setup -->
<script src="/js/navigation-loader.js"></script>
<!-- Component Loader - centralized async component management -->
<script src="/js/component-loader.js"></script>
<meta name="mobile-web-app-capable" content="yes"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="Te Kete Ako" name="apple-mobile-web-app-title"/>
<link href="/icons/icon-192x192.png" rel="apple-touch-icon"/>
<!-- ENHANCED SEARCH -->
<script src="/js/enhanced-search.js" defer></script>
<!-- MOBILE PERFORMANCE OPTIMIZER -->
<script src="/js/mobile-performance-optimizer.js" defer></script>
<!-- TOUCH TARGET AUDITOR -->
<script src="/js/touch-target-auditor.js" defer></script>
<!-- 🎨 ULTIMATE CULTURAL GESTURES - Framer Motion System -->
<script src="/js/framer-cultural-gestures-ultimate.js" defer></script>
<!-- Service Worker Registration -->
<script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('✅ PWA: Service Worker registered!', registration);
                    })
                    .catch(error => {
                        // Log to monitoring instead of console
                        if (window.posthog) {
                            posthog.capture('pwa_service_worker_error', {
                                message: 'Service Worker registration failed',
                                error: error.message,
                                url: window.location.pathname
                            });
                        }
                    });
            });
        }
</script>

<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>



<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive visualization of 19,737 resources connected by 231,469 AI-discovered relationships">

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ⭐ PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ⭐ THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ⭐ COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ⭐ PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ⭐ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ⭐ CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css"><body class="pattern-koru-subtle">    <!-- Navigation -->    <div id="nav-container"></div>    <script>        fetch('/components/navigation-standard.html')            .then(r => r.text())            .then(html => document.getElementById('nav-container').innerHTML = html);    </script>    <!-- Hero -->    <section class="viz-hero">        <div class="m-0 mx-auto" <div >🧠🔗</div>            <h1 style="font-size: 3.5rem; ">GraphRAG Knowledge Graph</h1>            <p style="opacity: 0.95;">                Watch AI-discovered connections come alive            </p>        </div>    </section>    <main style="margin: 3rem auto; padding: 0 2rem;">        <!-- Real-time Stats -->        <div class="stats-grid">            <div class="stat-card">                <div class="stat-number" id="stat-resources">19,737</div>                <div style="color: #666; margin-top: 0.5rem;">Total Resources</div>            </div>            <div class="stat-card">                <div class="stat-number" id="stat-relationships">231,469</div>                <div style="color: #666; margin-top: 0.5rem;">Knowledge Relationships</div>            </div>            <div class="stat-card">                <div class="stat-number" id="stat-subjects">12+</div>                <div style="color: #666; margin-top: 0.5rem;">Subject Areas</div>            </div>            <div class="stat-card">                <div class="stat-number" id="stat-cultural">8,421</div>                <div style="color: #666; margin-top: 0.5rem;">Cultural Resources</div>            </div>        </div>        <!-- Graph Visualization -->        <section style="margin: 3rem 0;">            <h2 style="font-size: 2.5rem; ">                🌐 Live Knowledge Graph            </h2>            <p style="color: #666; ">                Real connections from the GraphRAG database • Click nodes to explore            </p>            <div class="controls">                <button class="btn btn-primary" onclick="loadSubjectGraph('Science')">🔬 Science</button>                <button class="btn btn-primary" onclick="loadSubjectGraph('Mathematics')">📊 Mathematics</button>                <button class="btn btn-primary" onclick="loadSubjectGraph('English')">📝 English</button>                <button class="btn btn-primary" onclick="loadCulturalGraph()">🌿 Cultural Connections</button>                <button class="btn btn-primary" onclick="loadCrossSubject()">🔗 Cross-Curricular</button>            </div>            <div id="graph-container">                <div style="top: 50%; left: 50%; transform: translate(-50%, -50%); ">                    <div style="font-size: 3rem; ">🧠</div>                    <p style="color: #666; ">Select a view above to visualize the knowledge graph</p>                </div>            </div>        </section>        <!-- Info Panel -->        <div class="info-panel">            <h3 style="font-size: 1.8rem; color: #7c3aed; ">                How GraphRAG Works            </h3>            <div style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem;">                <div>                    <div style="font-size: 2rem; ">🔍</div>                    <h4 >1. Analysis</h4>                    <p style="color: #666;">AI analyzes every resource, extracting topics, concepts, and cultural elements</p>                </div>                <div>                    <div style="font-size: 2rem; ">🔗</div>                    <h4 >2. Connection</h4>                    <p style="color: #666;">Discovers 231,469 relationships including prerequisites, cultural links, and cross-curricular connections</p>                </div>                <div>                    <div style="font-size: 2rem; ">🎯</div>                    <h4 >3. Recommendation</h4>                    <p style="color: #666;">Powers personalized learning pathways and smart resource suggestions</p>                </div>            </div>            <div style="margin-top: 2rem;">                <h4 style="color: #166534; ">🌟 Real Data, Real Impact</h4>                <p style="color: #047857;">                    Every connection you see is discovered by AI analyzing actual content. This isn't a concept—it's working right now across Te Kete Ako, helping students and teachers discover connections they never knew existed.                </p>            </div>        </div>        <!-- Relationship Types -->        <section style="margin: 4rem 0;">            <h2 style="font-size: 2.5rem; margin-bottom: 3rem;">                📊 Relationship Types in GraphRAG            </h2>            <div style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">                <div style="background: #e0f2fe; ">                    <h4 style="color: #075985; ">📚 Same Subject</h4>                    <div class="m-0" style="font-size: 1.5rem; color: #0891b2; margin: 0.5rem 0;"52,765</div>                    <p style="color: #0c4a6e; ">Resources in the same subject area</p>                </div>                <div style="background: #f0fdf4; ">                    <h4 style="color: #166534; ">🌿 Cultural Elements</h4>                    <div class="m-0" style="font-size: 1.5rem; color: #10b981; margin: 0.5rem 0;"5,062</div>                    <p style="color: #065f46; ">Shared Māori cultural concepts</p>                </div>                <div style="background: #fef3c7; ">                    <h4 style="color: #92400e; ">🔗 Cross-Curricular</h4>                    <div class="m-0" style="font-size: 1.5rem; color: #f59e0b; margin: 0.5rem 0;"1,200</div>                    <p style="color: #78350f; ">Connections across subjects</p>                </div>                <div style="background: #f3e8ff; ">                    <h4 style="color: #5b21b6; ">📋 Prerequisites</h4>                    <div class="m-0" style="font-size: 1.5rem; color: #7c3aed; margin: 0.5rem 0;"849</div>                    <p style="color: #6b21a8; ">Learning progression chains</p>                </div>            </div>        </section>    </main>    <!-- Footer -->    <div id="footer-container"></div>    <script>        fetch('/components/footer.html').then(r=>r.text()).then(html=>{            document.getElementById('footer-container').innerHTML=html;        });    </script>    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>    <script>        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);        const subjectColors = {            'Science': '#0891b2',            'Mathematics': '#0284c7',            'English': '#dc2626',            'Social Studies': '#059669',            'History': '#7c3aed',            'Health & PE': '#f97316',            'Arts': '#ec4899',            'default': '#6b7280'        };        async function loadSubjectGraph(subject) {            const container = document.getElementById('graph-container');            container.innerHTML = '<div style="top: 50%; left: 50%; transform: translate(-50%, -50%); "><div style="font-size: 3rem;">⏳</div><p style="color: #666;">Loading ' + subject + ' knowledge graph...</p></div>';            try {                // Get top resources in this subject                const { data: resources, error } = await supabase                    .from('graphrag_resources')                    .select('*')                    .eq('subject', subject)                    .gte('quality_score', 70)                    .order('quality_score', { ascending: false })                    .limit(15);                if (error) throw error;                // Get relationships between these resources                const paths = resources.map(r => r.file_path);                const { data: relationships, error: relError } = await supabase                    .from('graphrag_relationships')                    .select('*')                    .in('source_path', paths)                    .in('target_path', paths)                    .gte('confidence', 0.75)                    .limit(30);                if (relError) throw relError;                visualizeGraph(resources, relationships, subject);            } catch (error) {                // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        container.innerHTML = '<div style="top: 50%; left: 50%; transform: translate(-50%, -50%); "><div style="font-size: 3rem;">❌</div><p style="color: #dc2626;">Error loading graph</p></div>';            }        }        async function loadCulturalGraph() {            const container = document.getElementById('graph-container');            container.innerHTML = '<div style="top: 50%; left: 50%; transform: translate(-50%, -50%); "><div style="font-size: 3rem;">⏳</div><p style="color: #666;">Loading cultural connections...</p></div>';            try {                // Get resources with cultural elements                const { data: resources, error } = await supabase                    .from('graphrag_resources')                    .select('*')                    .eq('cultural_context', true)                    .gte('quality_score', 80)                    .order('quality_score', { ascending: false })                    .limit(15);                if (error) throw error;                const paths = resources.map(r => r.file_path);                const { data: relationships, error: relError } = await supabase                    .from('graphrag_relationships')                    .select('*')                    .eq('relationship_type', 'shared_cultural_element')                    .in('source_path', paths)                    .in('target_path', paths)                    .limit(30);                if (relError) throw relError;                visualizeGraph(resources, relationships, 'Cultural');            } catch (error) {                // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        }        }        async function loadCrossSubject() {            const container = document.getElementById('graph-container');            container.innerHTML = '<div style="top: 50%; left: 50%; transform: translate(-50%, -50%); "><div style="font-size: 3rem;">⏳</div><p style="color: #666;">Loading cross-curricular connections...</p></div>';            try {                // Get cross-curricular relationships                const { data: relationships, error } = await supabase                    .from('graphrag_relationships')                    .select(`                        *,                        source:source_path(title, subject),                        target:target_path(title, subject)                    `)                    .eq('relationship_type', 'cross_curricular_link')                    .gte('confidence', 0.85)                    .limit(20);                if (error) {                    // Fallback: manual query                    const { data: rels } = await supabase                        .from('graphrag_relationships')                        .select('*')                        .eq('relationship_type', 'cross_curricular_link')                        .gte('confidence', 0.85)                        .limit(20);                    if (rels) {                        container.innerHTML = `                            <div style="overflow-y: auto; ">                                <h3 style="color: #7c3aed; ">Cross-Curricular Connections (${rels.length} found)</h3>                                ${rels.map(rel => `                                    <div >                                        <div >${rel.source_path.split('/').pop()}</div>                                        <div style="color: #666; ">↔️ ${rel.target_path.split('/').pop()}</div>                                        <div style="color: #7c3aed; font-size: 0.85rem; margin-top: 0.5rem;">Confidence: ${Math.round(rel.confidence * 100)}%</div>                                    </div>                                `).join('')}                            </div>                        `;                    }                    return;                }                // Extract unique resources                const resourcesMap = new Map();                relationships.forEach(rel => {                    if (rel.source) resourcesMap.set(rel.source_path, rel.source);                    if (rel.target) resourcesMap.set(rel.target_path, rel.target);                });                const resources = Array.from(resourcesMap.values());                visualizeGraph(resources, relationships, 'Cross-Curricular');            } catch (error) {                // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        }        }        function visualizeGraph(resources, relationships, label) {            const container = document.getElementById('graph-container');            container.innerHTML = '';            const width = container.clientWidth;            const height = container.clientHeight;            const centerX = width / 2;            const centerY = height / 2;            const radius = Math.min(width, height) * 0.35;            // Position nodes in a circle            const nodes = resources.map((resource, i) => {                const angle = (i / resources.length) * 2 * Math.PI;                return {                    x: centerX + radius * Math.cos(angle),                    y: centerY + radius * Math.sin(angle),                    resource: resource,                    color: subjectColors[resource.subject] || subjectColors.default                };            });            // Draw edges            relationships.forEach(rel => {                const sourceNode = nodes.find(n => n.resource.file_path === rel.source_path);                const targetNode = nodes.find(n => n.resource.file_path === rel.target_path);                if (sourceNode && targetNode) {                    const edge = document.createElement('div');                    edge.className = 'edge';                    const dx = targetNode.x - sourceNode.x;                    const dy = targetNode.y - sourceNode.y;                    const length = Math.sqrt(dx * dx + dy * dy);                    const angle = Math.atan2(dy, dx) * 180 / Math.PI;                    edge.style.width = length + 'px';                    edge.style.left = sourceNode.x + 'px';                    edge.style.top = sourceNode.y + 'px';                    edge.style.transform = `rotate(${angle}deg)`;                    edge.style.opacity = rel.confidence || 0.5;                    container.appendChild(edge);                }            });            // Draw nodes            nodes.forEach(node => {                const nodeEl = document.createElement('div');                nodeEl.className = 'node';                nodeEl.style.width = '80px';                nodeEl.style.height = '80px';                nodeEl.style.left = (node.x - 40) + 'px';                nodeEl.style.top = (node.y - 40) + 'px';                nodeEl.style.background = node.color;                nodeEl.style.color = 'white';                nodeEl.textContent = node.resource.subject || '?';                nodeEl.title = node.resource.title;                nodeEl.addEventListener('click', () => {                    if (node.resource.file_path) {                        window.location.href = node.resource.file_path;                    }                });                container.appendChild(nodeEl);            });            // Add info overlay            const info = document.createElement('div');            info.style.cssText = 'top: 20px; left: 20px; background: rgba(255,255,255,0.95); ';            info.innerHTML = `                <div style="color: #7c3aed; ">${label} Knowledge Graph</div>                <div style="color: #666;">${resources.length} resources • ${relationships.length} connections</div>            `;            container.appendChild(info);        }        // User feedback provided via UI    </script><!-- 📊 ULTIMATE BEAUTY: PostHog Analytics (Privacy-First) --><script src="/js/posthog-analytics.js" defer></script></body></html>