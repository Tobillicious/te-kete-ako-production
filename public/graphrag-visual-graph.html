<!DOCTYPE html><html lang="en"><head>
    <title>Visual Knowledge Graph | GraphRAG Intelligence | Te Kete Ako</title>

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ‚≠ê PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ‚≠ê THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ‚≠ê COMPONENT STYLES -->
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/navigation-standard.css">
<link rel="stylesheet" href="/css/mobile-revolution.css">
<link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ‚≠ê PRINT STYLES (media="print" = only for printing) -->
<link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ‚≠ê TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ‚≠ê CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Wait for Supabase CDN to load before initializing singleton
    window.addEventListener('DOMContentLoaded', () => {
        if (!window.supabase) {
            // Log to monitoring instead of console
            if (window.posthog) {
                posthog.capture('supabase_cdn_error', {
                    message: 'Supabase CDN failed to load',
                    url: window.location.pathname
                });
            }
        }
    });
</script>
<script src="/js/supabase-singleton.js"></script>
<!-- My Kete Database Integration - loads after singleton -->
<script src="/js/my-kete-database.js"></script>
<!-- Navigation Loader Singleton - loads after supabase setup -->
<script src="/js/navigation-loader.js"></script>
<!-- Component Loader - centralized async component management -->
<script src="/js/component-loader.js"></script>
<meta name="mobile-web-app-capable" content="yes"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="Te Kete Ako" name="apple-mobile-web-app-title"/>
<link href="/icons/icon-192x192.png" rel="apple-touch-icon"/>
<!-- ENHANCED SEARCH -->
<script src="/js/enhanced-search.js" defer></script>
<!-- MOBILE PERFORMANCE OPTIMIZER -->
<script src="/js/mobile-performance-optimizer.js" defer></script>
<!-- TOUCH TARGET AUDITOR -->
<script src="/js/touch-target-auditor.js" defer></script>
<!-- üé® ULTIMATE CULTURAL GESTURES - Framer Motion System -->
<script src="/js/framer-cultural-gestures-ultimate.js" defer></script>
<!-- Service Worker Registration -->
<script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ PWA: Service Worker registered!', registration);
                    })
                    .catch(error => {
                        // Log to monitoring instead of console
                        if (window.posthog) {
                            posthog.capture('pwa_service_worker_error', {
                                message: 'Service Worker registration failed',
                                error: error.message,
                                url: window.location.pathname
                            });
                        }
                    });
            });
        }
</script>

<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>



<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ‚≠ê PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ‚≠ê THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ‚≠ê COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ‚≠ê PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ‚≠ê TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ‚≠ê CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css"><body class="pattern-koru-subtle"> <!-- üé® ULTIMATE BEAUTY: Navigation --> <div id="nav-container"></div> <script>   fetch('/components/navigation-standard.html')     .then(r => r.text())     .then(html => document.getElementById('nav-container').innerHTML = html); </script>    <!-- Whakataukƒ´ Banner -->    <div style="top: 0; left: 0; right: 0; z-index: 99; border-bottom: 3px solid #1a4d2e;">        <p style="font-size: 0.95rem;">            "Ehara taku toa i te toa takitahi, engari he toa takitini" ‚Äî Success is not the work of one, but the work of many        </p>    </div>    <div class="controls" style="top: 70px;">        <h2>üß† Knowledge Graph</h2>        <div >            <label >View Mode:</label>            <button class="filter-btn active" onclick="loadGraph('science')">üî¨ Science</button>            <button class="filter-btn" onclick="loadGraph('mathematics')">üìä Mathematics</button>            <button class="filter-btn" onclick="loadGraph('english')">üìù English</button>            <button class="filter-btn" onclick="loadGraph('cultural')">üåø Cultural</button>            <button class="filter-btn" onclick="loadGraph('cross-subject')">üîó Cross-Subject</button>        </div>        <div class="legend">            <div >Relationship Types:</div>            <div class="legend-item">                <div class="legend-color" style="background: #a855f7;"></div>                Cultural Connection            </div>            <div class="legend-item">                <div class="legend-color" style="background: #10b981; opacity: 0.7;"></div>                Prerequisite Chain            </div>            <div class="legend-item">                <div class="legend-color" style="background: #f59e0b;"></div>                Cross-Curricular            </div>            <div class="legend-item">                <div class="legend-color" style="background: #475569; opacity: 0.6;"></div>                Related Content            </div>        </div>        <div class="stats" id="stats">            <div>Nodes: <strong id="node-count">0</strong></div>            <div>Connections: <strong id="link-count">0</strong></div>            <div>Avg Confidence: <strong id="avg-confidence">0%</strong></div>        </div>        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #334155;">            <button class="filter-btn" style="background: #1e293b;" onclick="window.location.href='/cross-subject-discovery.html'">                ‚Üê Back to Discovery            </button>        </div>    </div>    <div id="loading" class="loading">        <div class="spinner"></div>        <p>Loading GraphRAG data...</p>    </div>    <svg class="graph-container" id="graph"></svg>    <script>    const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';    let simulation;    let currentMode = 'science';    const subjectColors = {        'Science': '#0891b2',        'Mathematics': '#6366f1',        'English': '#dc2626',        'Social Studies': '#059669',        'Digital Tech': '#10b981',        'Health & PE': '#f97316',        'Te Ao MƒÅori': '#a855f7',        'General': '#64748b'    };    async function loadGraph(mode) {        currentMode = mode;        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));        event.target.classList.add('active');        document.getElementById('loading').style.display = 'block';        try {            let query;            if (mode === 'science') {                query = `relationship_type=in.(related_content,prerequisite)&limit=50`;            } else if (mode === 'mathematics') {                query = `relationship_type=eq.prerequisite&limit=40`;            } else if (mode === 'english') {                query = `relationship_type=in.(related_content,shared_cultural_element)&limit=40`;            } else if (mode === 'cultural') {                query = `relationship_type=eq.shared_cultural_element&confidence=gte.0.9&limit=30`;            } else if (mode === 'cross-subject') {                query = `relationship_type=in.(cross_curricular_link,shared_cultural_element)&confidence=gte.0.85&limit=35`;            }            const response = await fetch(                `${SUPABASE_URL}/rest/v1/graphrag_relationships?select=source_path,target_path,relationship_type,confidence&${query}&order=confidence.desc`,                { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }            );            const relationships = await response.json();            console.log(`Loaded ${relationships.length} relationships for ${mode}`);            // Get unique paths            const paths = [...new Set([                ...relationships.map(r => r.source_path),                ...relationships.map(r => r.target_path)            ])].slice(0, 50);            // Fetch resource details            const pathFilter = paths.slice(0, 50).map(p => `"${p}"`).join(',');            const resourceResponse = await fetch(                `${SUPABASE_URL}/rest/v1/graphrag_resources?select=file_path,title,subject&file_path=in.(${pathFilter})`,                { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }            );            const resources = await resourceResponse.json();            const resourceMap = {};            resources.forEach(r => {                resourceMap[r.file_path] = r;            });            // Build graph data            const nodes = resources.map(r => ({                id: r.file_path,                label: r.title?.substring(0, 30) || 'Resource',                subject: r.subject?.split(',')[0] || 'General',                fullTitle: r.title            }));            const links = relationships                .filter(r => resourceMap[r.source_path] && resourceMap[r.target_path])                .map(r => ({                    source: r.source_path,                    target: r.target_path,                    type: r.relationship_type,                    confidence: r.confidence                }));            renderGraph({ nodes, links });        } catch (error) {            // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        document.getElementById('loading').innerHTML = `                <div style="color: #ef4444;">                    <div style="font-size: 3rem;">‚ö†Ô∏è</div>                    <p>Error loading graph</p>                </div>            `;        }    }    function renderGraph(data) {        document.getElementById('loading').style.display = 'none';        const width = window.innerWidth;        const height = window.innerHeight;        const svg = d3.select('#graph');        svg.selectAll('*').remove();        const g = svg.append('g');        // Add zoom        const zoom = d3.zoom()            .scaleExtent([0.3, 3])            .on('zoom', (event) => g.attr('transform', event.transform));        svg.call(zoom);        // Create simulation        simulation = d3.forceSimulation(data.nodes)            .force('link', d3.forceLink(data.links).id(d => d.id).distance(100))            .force('charge', d3.forceManyBody().strength(-300))            .force('center', d3.forceCenter(width / 2, height / 2))            .force('collision', d3.forceCollide().radius(40));        // Draw links        const link = g.append('g')            .selectAll('line')            .data(data.links)            .join('line')            .attr('class', d => {                if (d.type === 'shared_cultural_element') return 'link link-cultural';                if (d.type === 'prerequisite') return 'link link-prerequisite';                if (d.type === 'cross_curricular_link') return 'link link-cross-subject';                return 'link';            })            .attr('stroke-width', d => Math.max(1, d.confidence * 3));        // Draw nodes        const node = g.append('g')            .selectAll('circle')            .data(data.nodes)            .join('circle')            .attr('class', 'node')            .attr('r', 12)            .attr('fill', d => subjectColors[d.subject] || subjectColors.General)            .call(drag(simulation));        // Add labels        const label = g.append('g')            .selectAll('text')            .data(data.nodes)            .join('text')            .attr('class', 'node-label')            .text(d => d.label)            .attr('dx', 15)            .attr('dy', 4);        // Tooltips        node.append('title').text(d => `${d.fullTitle}\n${d.subject}`);        // Update positions        simulation.on('tick', () => {            link                .attr('x1', d => d.source.x)                .attr('y1', d => d.source.y)                .attr('x2', d => d.target.x)                .attr('y2', d => d.target.y);            node                .attr('cx', d => d.x)                .attr('cy', d => d.y);            label                .attr('x', d => d.x)                .attr('y', d => d.y);        });        // Update stats        document.getElementById('node-count').textContent = data.nodes.length;        document.getElementById('link-count').textContent = data.links.length;        const avgConf = data.links.reduce((sum, l) => sum + l.confidence, 0) / data.links.length;        document.getElementById('avg-confidence').textContent = Math.round(avgConf * 100) + '%';    }    function drag(simulation) {        function dragstarted(event) {            if (!event.active) simulation.alphaTarget(0.3).restart();            event.subject.fx = event.subject.x;            event.subject.fy = event.subject.y;        }        function dragged(event) {            event.subject.fx = event.x;            event.subject.fy = event.y;        }        function dragended(event) {            if (!event.active) simulation.alphaTarget(0);            event.subject.fx = null;            event.subject.fy = null;        }        return d3.drag()            .on('start', dragstarted)            .on('drag', dragged)            .on('end', dragended);    }    // Load default view    loadGraph('science');    </script><!-- üé® ULTIMATE BEAUTY SYSTEM: Complete UX --><!-- Footer --><div id="footer-container"></div><script>  fetch('/components/footer.html').then(r=>r.text()).then(html=>{    document.getElementById('footer-container').innerHTML=html;  });</script><!-- Mobile Navigation --><div id="mobile-nav-bottom"></div><script>  fetch('/components/mobile-bottom-nav.html').then(r=>r.text()).then(html=>{    document.getElementById('mobile-nav-bottom').innerHTML=html;  });</script><!-- Floating Action Button (Help) --><div id="fab-quick-actions"></div><script>  fetch('/components/quick-actions-fab.html').then(r=>r.text()).then(html=>{    document.getElementById('fab-quick-actions').innerHTML=html;  });</script><!-- üé® ULTIMATE BEAUTY: Framer Cultural Gestures --><script src="/js/framer-cultural-gestures-ultimate.js" defer></script><!-- üìä ULTIMATE BEAUTY: PostHog Analytics (Privacy-First) --><script src="/js/posthog-analytics.js" defer></script></body></html>