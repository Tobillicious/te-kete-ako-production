<!DOCTYPE html><html lang="en"><head>
    <title>Network Visualization - Te Kete Ako GraphRAG</title>

<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>



<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ‚≠ê PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ‚≠ê THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ‚≠ê COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ‚≠ê PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ‚≠ê TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ‚≠ê CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css"><body class="pattern-koru-subtle"> <!-- üé® ULTIMATE BEAUTY: Navigation --> <div id="nav-container"></div> <script>   fetch('/components/navigation-standard.html')     .then(r => r.text())     .then(html => document.getElementById('nav-container').innerHTML = html); </script>    <div id="network-container">        <svg id="network-svg"></svg>        <!-- Controls -->        <div class="controls">            <h2 class="text-2xl font-bold mb-4 bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">                üï∏Ô∏è Network Controls            </h2>            <div class="mb-4">                <label class="block text-sm font-semibold mb-2">View Mode</label>                <select id="viewMode" onchange="changeViewMode()" class="w-full p-2 border rounded">                    <option value="all">All Relationships (Sample)</option>                    <option value="excellence">Excellence Network (Q95+)</option>                    <option value="cultural">Cultural Threads</option>                    <option value="subject">By Subject</option>                    <option value="hubs">Super Hubs Only</option>                </select>            </div>            <div class="mb-4">                <label class="block text-sm font-semibold mb-2">Min Confidence</label>                <input type="range" id="confidenceSlider" min="0.5" max="0.95" step="0.05" value="0.75"                       oninput="updateConfidenceFilter(this.value)" class="w-full"/>                <span id="confidenceValue" class="text-sm text-gray-600">0.75</span>            </div>            <button onclick="loadNetwork()" class="control-btn">                üîÑ Reload Network            </button>            <button onclick="resetZoom()" class="control-btn">                üéØ Reset View            </button>        </div>        <!-- Info Panel -->        <div class="info-panel">            <h3 class="text-xl font-bold mb-3">üìä Network Stats</h3>            <div class="stat-row">                <span class="font-semibold">Nodes:</span>                <span id="nodeCount">-</span>            </div>            <div class="stat-row">                <span class="font-semibold">Links:</span>                <span id="linkCount">-</span>            </div>            <div class="stat-row">                <span class="font-semibold">Avg Connections:</span>                <span id="avgConnections">-</span>            </div>            <h4 class="font-bold mt-4 mb-2">Legend</h4>            <div class="legend-item">                <div class="legend-color" style="background: #059669;"></div>                <span class="text-sm">Excellent (Q95+)</span>            </div>            <div class="legend-item">                <div class="legend-color" style="background: #0284c7;"></div>                <span class="text-sm">High Quality (Q90+)</span>            </div>            <div class="legend-item">                <div class="legend-color" style="background: #8b5cf6;"></div>                <span class="text-sm">Cultural</span>            </div>            <div class="legend-item">                <div class="legend-color" style="background: #94a3b8;"></div>                <span class="text-sm">Standard</span>            </div>            <div class="mt-4 p-3 bg-green-50 rounded text-sm">                <strong>üí° Tip:</strong> Drag nodes to explore. Zoom with scroll. Click nodes for details.            </div>        </div>    </div>    <!-- Load Dependencies -->    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>    <script>        window.ENV = {            SUPABASE_URL: 'https://nlgldaqtubrlcqddppbq.supabase.co',            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjc5OTY5OTQsImV4cCI6MjA0MzU3Mjk5NH0.wScWM7v-VltrUqKDFm0BSRFH9ZjPy4oEKU5Y_gVDcRA'        };        const supabase = supabase.createClient(window.ENV.SUPABASE_URL, window.ENV.SUPABASE_ANON_KEY);        let simulation;        let svg;        let g;        async function loadNetwork() {            const viewMode = document.getElementById('viewMode').value;            const minConfidence = parseFloat(document.getElementById('confidenceSlider').value);            // Load data based on view mode            let nodes = [];            let links = [];            try {                if (viewMode === 'excellence') {                    await loadExcellenceNetwork(minConfidence);                } else if (viewMode === 'cultural') {                    await loadCulturalNetwork(minConfidence);                } else if (viewMode === 'hubs') {                    await loadHubNetwork(minConfidence);                } else {                    await loadSampleNetwork(minConfidence);                }            } catch (error) {                // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('error', {
        message: '$2',
        details: $3,
        url: window.location.pathname
    });
        }
        // Show user-friendly message instead of error
        alert('Error loading network. Check console for details.');            }        }        async function loadExcellenceNetwork(minConfidence) {            // Load Q95+ resources and their connections            const { data: resources } = await supabase                .from('graphrag_resources')                .select('file_path, title, quality_score, metadata')                .gte('quality_score', 95)                .limit(100);            const { data: relationships } = await supabase                .from('graphrag_relationships')                .select('source_path, target_path, confidence, relationship_type')                .gte('confidence', minConfidence)                .limit(500);            renderNetwork(resources || [], relationships || []);        }        async function loadCulturalNetwork(minConfidence) {            // Load cultural resources and threads            const { data: resources } = await supabase                .from('graphrag_resources')                .select('file_path, title, quality_score, metadata')                .or('metadata->>cultural.eq.true,metadata->>te_ao_maori.eq.true')                .limit(100);            const resourcePaths = (resources || []).map(r => r.file_path);            const { data: relationships } = await supabase                .from('graphrag_relationships')                .select('source_path, target_path, confidence, relationship_type')                .in('source_path', resourcePaths)                .gte('confidence', minConfidence)                .limit(500);            renderNetwork(resources || [], relationships || []);        }        async function loadHubNetwork(minConfidence) {            // Show only super-connected nodes            alert('Loading super hub network with high-confidence connections...');            // For demo: load sample            await loadSampleNetwork(0.90);        }        async function loadSampleNetwork(minConfidence) {            // Load sample for performance            const { data: relationships } = await supabase                .from('graphrag_relationships')                .select('source_path, target_path, confidence, relationship_type')                .gte('confidence', minConfidence)                .limit(200);            if (!relationships) return;            // Get unique paths            const paths = [...new Set([                ...relationships.map(r => r.source_path),                ...relationships.map(r => r.target_path)            ])];            const { data: resources } = await supabase                .from('graphrag_resources')                .select('file_path, title, quality_score, metadata')                .in('file_path', paths.slice(0, 100));            renderNetwork(resources || [], relationships);        }        function renderNetwork(resources, relationships) {            // Clear existing            d3.select('#network-svg').selectAll('*').remove();            // Prepare data            const nodes = resources.map(r => ({                id: r.file_path,                title: r.title,                quality: r.quality_score,                cultural: r.metadata?.cultural === 'true',                subject: r.metadata?.subject            }));            const links = relationships                .filter(r =>                    nodes.find(n => n.id === r.source_path) &&                    nodes.find(n => n.id === r.target_path)                )                .map(r => ({                    source: r.source_path,                    target: r.target_path,                    confidence: r.confidence                }));            // Update stats            document.getElementById('nodeCount').textContent = nodes.length;            document.getElementById('linkCount').textContent = links.length;            document.getElementById('avgConnections').textContent =                (links.length / nodes.length).toFixed(1);            // Create D3 force simulation            const width = window.innerWidth;            const height = window.innerHeight;            svg = d3.select('#network-svg')                .attr('viewBox', [0, 0, width, height]);            const simulation = d3.forceSimulation(nodes)                .force('link', d3.forceLink(links).id(d => d.id).distance(100))                .force('charge', d3.forceManyBody().strength(-300))                .force('center', d3.forceCenter(width / 2, height / 2));            // Draw links            const link = svg.append('g')                .selectAll('line')                .data(links)                .join('line')                .attr('class', d => d.confidence >= 0.90 ? 'link-strong' : 'link')                .attr('stroke-width', d => d.confidence * 3);            // Draw nodes            const node = svg.append('g')                .selectAll('circle')                .data(nodes)                .join('circle')                .attr('class', 'node')                .attr('r', d => d.quality >= 95 ? 12 : d.quality >= 90 ? 8 : 5)                .attr('fill', d =>                    d.cultural ? '#8b5cf6' :                    d.quality >= 95 ? '#059669' :                    d.quality >= 90 ? '#0284c7' : '#94a3b8'                )                .call(drag(simulation));            // Add labels for high-quality nodes            const label = svg.append('g')                .selectAll('text')                .data(nodes.filter(n => n.quality >= 95))                .join('text')                .attr('class', 'node-text')                .text(d => d.title.substring(0, 20) + '...')                .attr('dx', 15)                .attr('dy', 4);            // Update positions on tick            simulation.on('tick', () => {                link                    .attr('x1', d => d.source.x)                    .attr('y1', d => d.source.y)                    .attr('x2', d => d.target.x)                    .attr('y2', d => d.target.y);                node                    .attr('cx', d => d.x)                    .attr('cy', d => d.y);                label                    .attr('x', d => d.x)                    .attr('y', d => d.y);            });            // Click handler            node.on('click', (event, d) => {                alert(`Resource: ${d.title}\nQuality: ${d.quality}\nSubject: ${d.subject || 'N/A'}`);            });        }        function drag(simulation) {            function dragstarted(event) {                if (!event.active) simulation.alphaTarget(0.3).restart();                event.subject.fx = event.subject.x;                event.subject.fy = event.subject.y;            }            function dragged(event) {                event.subject.fx = event.x;                event.subject.fy = event.y;            }            function dragended(event) {                if (!event.active) simulation.alphaTarget(0);                event.subject.fx = null;                event.subject.fy = null;            }            return d3.drag()                .on('start', dragstarted)                .on('drag', dragged)                .on('end', dragended);        }        function changeViewMode() {            loadNetwork();        }        function updateConfidenceFilter(value) {            document.getElementById('confidenceValue').textContent = value;        }        function resetZoom() {            const svg = d3.select('#network-svg');            svg.transition().duration(750).call(                d3.zoom().transform,                d3.zoomIdentity            );        }        // Enable zoom        d3.select('#network-svg').call(            d3.zoom()                .scaleExtent([0.1, 10])                .on('zoom', (event) => {                    d3.select('#network-svg g').attr('transform', event.transform);                })        );        // Auto-load on page load        window.addEventListener('load', () => {            console.log('üï∏Ô∏è Network Visualization Ready');            loadNetwork();        });    </script><!-- üé® ULTIMATE BEAUTY SYSTEM: Complete UX --><!-- Footer --><div id="footer-container"></div><script>  fetch('/components/footer.html').then(r=>r.text()).then(html=>{    document.getElementById('footer-container').innerHTML=html;  });</script><!-- Mobile Navigation --><div id="mobile-nav-bottom"></div><script>  fetch('/components/mobile-bottom-nav.html').then(r=>r.text()).then(html=>{    document.getElementById('mobile-nav-bottom').innerHTML=html;  });</script><!-- Floating Action Button (Help) --><div id="fab-quick-actions"></div><script>  fetch('/components/quick-actions-fab.html').then(r=>r.text()).then(html=>{    document.getElementById('fab-quick-actions').innerHTML=html;  });</script><!-- üé® ULTIMATE BEAUTY: Framer Cultural Gestures --><script src="/js/framer-cultural-gestures-ultimate.js" defer></script><!-- üìä ULTIMATE BEAUTY: PostHog Analytics (Privacy-First) --><script src="/js/posthog-analytics.js" defer></script></body></html>