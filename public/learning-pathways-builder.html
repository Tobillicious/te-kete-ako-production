<!DOCTYPE html>
<html lang="en">
<head>
    <title>Learning Pathways Builder | Te Kete Ako</title>

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ‚≠ê PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ‚≠ê THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ‚≠ê COMPONENT STYLES -->
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/navigation-standard.css">
<link rel="stylesheet" href="/css/mobile-revolution.css">
<link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ‚≠ê PRINT STYLES (media="print" = only for printing) -->
<link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ‚≠ê TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ‚≠ê CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Wait for Supabase CDN to load before initializing singleton
    window.addEventListener('DOMContentLoaded', () => {
        if (!window.supabase) {
            // Log to monitoring instead of console
            if (window.posthog) {
                posthog.capture('supabase_cdn_error', {
                    message: 'Supabase CDN failed to load',
                    url: window.location.pathname
                });
            }
        }
    });
</script>
<script src="/js/supabase-singleton.js"></script>
<!-- My Kete Database Integration - loads after singleton -->
<script src="/js/my-kete-database.js"></script>
<!-- Navigation Loader Singleton - loads after supabase setup -->
<script src="/js/navigation-loader.js"></script>
<!-- Component Loader - centralized async component management -->
<script src="/js/component-loader.js"></script>
<meta name="mobile-web-app-capable" content="yes"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="Te Kete Ako" name="apple-mobile-web-app-title"/>
<link href="/icons/icon-192x192.png" rel="apple-touch-icon"/>
<!-- ENHANCED SEARCH -->
<script src="/js/enhanced-search.js" defer></script>
<!-- MOBILE PERFORMANCE OPTIMIZER -->
<script src="/js/mobile-performance-optimizer.js" defer></script>
<!-- TOUCH TARGET AUDITOR -->
<script src="/js/touch-target-auditor.js" defer></script>
<!-- üé® ULTIMATE CULTURAL GESTURES - Framer Motion System -->
<script src="/js/framer-cultural-gestures-ultimate.js" defer></script>
<!-- Service Worker Registration -->
<script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ PWA: Service Worker registered!', registration);
                    })
                    .catch(error => {
                        // Log to monitoring instead of console
                        if (window.posthog) {
                            posthog.capture('pwa_service_worker_error', {
                                message: 'Service Worker registration failed',
                                error: error.message,
                                url: window.location.pathname
                            });
                        }
                    });
            });
        }
</script>

<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>



<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create personalized learning pathways using GraphRAG-powered intelligent recommendations">

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ‚≠ê PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ‚≠ê THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ‚≠ê COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ‚≠ê PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ‚≠ê TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ‚≠ê CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">
<body class="pattern-koru-subtle">
    
    <!-- Navigation -->
    <div id="nav-container"></div>
    <script>
        fetch('/components/navigation-standard.html')
            .then(r => r.text())
            .then(html => document.getElementById('nav-container').innerHTML = html);
    </script>
    
    <!-- Hero Section -->
    <section style="color: white; padding: 3rem; ">
        <h1 style="font-size: 3rem; ">üó∫Ô∏è Learning Pathways Builder</h1>
        <p class="m-0 mx-auto" Create intelligent, culturally-integrated learning journeys powered by GraphRAG
        </p>
        <div style="margin-top: 1.5rem;">
            <span class="p-3 m-0" style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.5rem; border-radius: 25px; margin: 0.5rem;"
                üß† 17,507 Resources Connected
            </span>
            <span class="p-3 m-0" style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.5rem; border-radius: 25px; margin: 0.5rem;"
                üîó 239,866 Relationships Mapped
            </span>
        </div>
    </section>
    
    <div class="pathway-builder">
        
        <!-- Pathway Controls -->
        <div class="pathway-controls">
            <h3 class="m-0" style="margin: 0 0 1rem 0; "Build Your Pathway</h3>
            
            <div >
                <label >Subject Focus:</label>
                <button class="filter-btn active" data-subject="all">All Subjects</button>
                <button class="filter-btn" data-subject="Mathematics">Mathematics</button>
                <button class="filter-btn" data-subject="Science">Science</button>
                <button class="filter-btn" data-subject="English">English</button>
                <button class="filter-btn" data-subject="Social Studies">Social Studies</button>
                <button class="filter-btn" data-subject="Digital Technologies">Digital Technologies</button>
            </div>
            
            <div >
                <label >Year Level:</label>
                <button class="filter-btn" data-year="all">All Years</button>
                <button class="filter-btn" data-year="Year 7">Year 7</button>
                <button class="filter-btn" data-year="Year 8">Year 8</button>
                <button class="filter-btn" data-year="Year 9">Year 9</button>
                <button class="filter-btn" data-year="Year 10">Year 10</button>
                <button class="filter-btn" data-year="Years 11-13">NCEA</button>
            </div>
            
            <div >
                <label >Cultural Integration:</label>
                <label style="margin-right: 1.5rem;">
                    <input type="checkbox" id="filter-cultural" checked> Prioritize Cultural Content
                </label>
                <label>
                    <input type="checkbox" id="filter-maori"> Te Reo MƒÅori Required
                </label>
            </div>
            
            <button onclick="generatePathway()" class="p-3" style="background: #1a4d2e; color: white; padding: 0.75rem 2rem; border: none; cursor: pointer; margin-top: 1rem;"
                üöÄ Generate Intelligent Pathway
            </button>
            
            <button onclick="clearPathway()" class="p-3" style="background: #dc2626; color: white; padding: 0.75rem 2rem; border: none; cursor: pointer; margin-top: 1rem; margin-left: 1rem;"
                üóëÔ∏è Clear Pathway
            </button>
        </div>
        
        <!-- GraphRAG Suggestions -->
        <div class="pathway-suggestions" id="suggestions" style="display: none;">
            <h4 class="m-0" style="margin: 0 0 1rem 0; color: #166534;"üß† GraphRAG Recommendations</h4>
            <div id="suggestions-content"></div>
        </div>
        
        <!-- Available Resources -->
        <div style="grid-template-columns: 350px 1fr; gap: 2rem; margin-top: 2rem;">
            
            <!-- Resource Library -->
            <div>
                <h3 class="m-0" style="margin: 0 0 1rem 0; "üìö Resource Library</h3>
                <div style="max-overflow-y: auto;">
                    <input type="text" id="search-resources" placeholder="Search resources..." >
                    <div id="resource-list">
                        <div style="color: #666;">
                            Loading resources...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pathway Canvas -->
            <div>
                <h3 class="m-0" style="margin: 0 0 1rem 0; "üó∫Ô∏è Your Learning Pathway</h3>
                <div class="pathway-canvas" id="pathway-canvas">
                    <div style="padding: 4rem; color: #999;">
                        <p >‚ú® Your pathway will appear here</p>
                        <p>Select resources from the library or generate an intelligent pathway</p>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; ">
                    <button onclick="savePathway()" class="p-3" style="background: #DAA520; color: white; padding: 0.75rem 2rem; border: none; cursor: pointer; "
                        üíæ Save Pathway
                    </button>
                    <button onclick="exportPathway()" class="p-3" style="background: #40E0D0; color: white; padding: 0.75rem 2rem; border: none; cursor: pointer; margin-left: 0.5rem;"
                        üì§ Export as PDF
                    </button>
                </div>
            </div>
            
        </div>
        
    </div>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    <script>
        fetch('/components/footer.html').then(r=>r.text()).then(html=>{
            document.getElementById('footer-container').innerHTML=html;
        });
    </script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let allResources = [];
        let selectedResources = [];
        let currentFilters = {
            subject: 'all',
            year: 'all',
            cultural: true,
            maori: false
        };
        
        // Load resources from GraphRAG
        async function loadResources() {
            try {
                const { data, error } = await supabase
                    .from('graphrag_resources')
                    .select('*')
                    .gte('quality_score', 70)
                    .order('quality_score', { ascending: false })
                    .limit(100);
                    
                if (error) throw error;
                
                allResources = data;
                displayResources(allResources);
                
            } catch (error) {
                // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        document.getElementById('resource-list').innerHTML = 
                    '<div style="color: #dc2626;">Error loading resources. Please refresh.</div>';
            }
        }
        
        // Display resources in the library
        function displayResources(resources) {
            const container = document.getElementById('resource-list');
            
            if (resources.length === 0) {
                container.innerHTML = '<div style="color: #666;">No resources found</div>';
                return;
            }
            
            container.innerHTML = resources.map(resource => `
                <div class="resource-card" onclick="addToPathway('${resource.id}')">
                    <h4 class="m-0" style="margin: 0 0 0.5rem; "
                        ${resource.title || 'Untitled Resource'}
                    </h4>
                    <div class="m-0" style="margin: 0.5rem 0;"
                        <span class="cultural-indicator ${resource.cultural_context ? 'cultural-high' : 'cultural-medium'}">
                            ${resource.cultural_context ? 'üåø Cultural' : 'üìö Standard'}
                        </span>
                        ${resource.has_te_reo ? '<span class="cultural-indicator cultural-high">üó£Ô∏è Te Reo</span>' : ''}
                    </div>
                    <p class="m-0" style="font-size: 0.85rem; color: #666; margin: 0.5rem 0 0;"
                        ${resource.subject || 'General'} ‚Ä¢ ${resource.year_level || 'All Years'}
                    </p>
                    <div style="margin-top: 0.5rem;">
                        <span style="background: #f0f0f0; padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                            Quality: ${resource.quality_score || 'N/A'}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // Filter button handlers
        document.addEventListener('DOMContentLoaded', () => {
            // Subject filters
            document.querySelectorAll('[data-subject]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-subject]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilters.subject = this.dataset.subject;
                    applyFilters();
                });
            });
            
            // Year filters
            document.querySelectorAll('[data-year]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-year]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilters.year = this.dataset.year;
                    applyFilters();
                });
            });
            
            // Cultural filters
            document.getElementById('filter-cultural').addEventListener('change', function() {
                currentFilters.cultural = this.checked;
                applyFilters();
            });
            
            document.getElementById('filter-maori').addEventListener('change', function() {
                currentFilters.maori = this.checked;
                applyFilters();
            });
            
            // Search
            document.getElementById('search-resources').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = allResources.filter(r => 
                    (r.title || '').toLowerCase().includes(searchTerm) ||
                    (r.subject || '').toLowerCase().includes(searchTerm)
                );
                displayResources(filtered);
            });
            
            loadResources();
        });
        
        // Apply filters
        function applyFilters() {
            let filtered = allResources;
            
            if (currentFilters.subject !== 'all') {
                filtered = filtered.filter(r => r.subject === currentFilters.subject);
            }
            
            if (currentFilters.year !== 'all') {
                filtered = filtered.filter(r => r.year_level === currentFilters.year);
            }
            
            if (currentFilters.cultural) {
                filtered = filtered.filter(r => r.cultural_context);
            }
            
            if (currentFilters.maori) {
                filtered = filtered.filter(r => r.has_te_reo);
            }
            
            displayResources(filtered);
        }
        
        // Add resource to pathway
        function addToPathway(resourceId) {
            const resource = allResources.find(r => r.id == resourceId);
            if (!resource || selectedResources.find(r => r.id == resourceId)) return;
            
            selectedResources.push(resource);
            renderPathway();
            showSuggestions(resource);
        }
        
        // Generate intelligent pathway using GraphRAG
        async function generatePathway() {
            try {
                // Get high-quality, connected resources
                const { data, error } = await supabase
                    .from('graphrag_resources')
                    .select('*')
                    .gte('quality_score', 80)
                    .eq('cultural_context', true)
                    .limit(8);
                    
                if (error) throw error;
                
                selectedResources = data || [];
                renderPathway();
                
                document.getElementById('suggestions').style.display = 'block';
                document.getElementById('suggestions-content').innerHTML = `
                    <p>‚ú® Generated pathway with ${selectedResources.length} culturally-integrated resources</p>
                    <p style="margin-top: 0.5rem; ">This pathway prioritizes quality and cultural integration.</p>
                `;
                
            } catch (error) {
                // Log to monitoring instead of console
        if (window.posthog) {
            posthog.capture('javascript_error', {
                error: err.message,
                url: window.location.pathname
            }));
        }
        // Show user-friendly message instead of error
        alert('Error generating pathway. Please try again.');
            }
        }
        
        // Render pathway on canvas
        function renderPathway() {
            const canvas = document.getElementById('pathway-canvas');
            
            if (selectedResources.length === 0) {
                canvas.innerHTML = `
                    <div style="padding: 4rem; color: #999;">
                        <p >‚ú® Your pathway will appear here</p>
                        <p>Select resources from the library or generate an intelligent pathway</p>
                    </div>
                `;
                return;
            }
            
            canvas.innerHTML = selectedResources.map((resource, index) => `
                <div class="pathway-node ${getDifficultyLevel(resource)}" 
                     style="top: ${100 + index * 120}px; left: ${200 + (index % 3) * 250}px;">
                    <div style="justify-content: space-between; align-items: start; ">
                        <h4 style="flex: 1;">${resource.title || 'Untitled'}</h4>
                        <button onclick="removeFromPathway(${index})" 
                                style="background: #dc2626; color: white; border: none; padding: 0.25rem 0.5rem; cursor: pointer; margin-left: 0.5rem;">
                            √ó
                        </button>
                    </div>
                    <div style="font-size: 0.75rem; color: #666;">
                        ${resource.subject || 'General'}
                    </div>
                    <div style="margin-top: 0.5rem;">
                        ${resource.cultural_context ? '<span class="cultural-indicator cultural-high" style="font-size: 0.7rem;">üåø Cultural</span>' : ''}
                        <span class="difficulty-badge difficulty-${getDifficultyLevel(resource)}" style="font-size: 0.7rem;">
                            ${getDifficultyLevel(resource)}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // Helper functions
        function getDifficultyLevel(resource) {
            const score = resource.quality_score || 0;
            if (score >= 85) return 'extension';
            if (score >= 70) return 'core';
            return 'foundation';
        }
        
        function removeFromPathway(index) {
            selectedResources.splice(index, 1);
            renderPathway();
        }
        
        function clearPathway() {
            selectedResources = [];
            renderPathway();
            document.getElementById('suggestions').style.display = 'none';
        }
        
        function showSuggestions(resource) {
            document.getElementById('suggestions').style.display = 'block';
            document.getElementById('suggestions-content').innerHTML = `
                <p><strong>Based on "${resource.title}"</strong></p>
                <p style="margin-top: 0.5rem; ">
                    GraphRAG suggests adding related ${resource.subject} resources at similar level.
                </p>
            `;
        }
        
        function savePathway() {
            const pathwayData = {
                resources: selectedResources,
                created: new Date().toISOString(),
                filters: currentFilters
            };
            
            localStorage.setItem('saved-pathway', JSON.stringify(pathwayData));
            alert('Pathway saved! ‚úÖ');
        }
        
        function exportPathway() {
            alert('PDF export feature coming soon! üìÑ');
        }
    </script>
    
    <!-- Analytics -->
    <script src="/js/posthog-analytics.js" defer></script>
    
</body>
</html>
