<!DOCTYPE html>
<html lang="en">
<head>
    <title>Orchestration Test Suite | Te Kete Ako</title>

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- â­ PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- â­ THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- â­ COMPONENT STYLES -->
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/navigation-standard.css">
<link rel="stylesheet" href="/css/mobile-revolution.css">
<link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- â­ PRINT STYLES (media="print" = only for printing) -->
<link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- â­ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- â­ CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Wait for Supabase CDN to load before initializing singleton
    window.addEventListener('DOMContentLoaded', () => {
        if (!window.supabase) {
            // Log to monitoring instead of console
            if (window.posthog) {
                posthog.capture('supabase_cdn_error', {
                    message: 'Supabase CDN failed to load',
                    url: window.location.pathname
                });
            }
        }
    });
</script>
<script src="/js/supabase-singleton.js"></script>
<!-- My Kete Database Integration - loads after singleton -->
<script src="/js/my-kete-database.js"></script>
<!-- Navigation Loader Singleton - loads after supabase setup -->
<script src="/js/navigation-loader.js"></script>
<!-- Component Loader - centralized async component management -->
<script src="/js/component-loader.js"></script>
<meta name="mobile-web-app-capable" content="yes"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="Te Kete Ako" name="apple-mobile-web-app-title"/>
<link href="/icons/icon-192x192.png" rel="apple-touch-icon"/>
<!-- ENHANCED SEARCH -->
<script src="/js/enhanced-search.js" defer></script>
<!-- MOBILE PERFORMANCE OPTIMIZER -->
<script src="/js/mobile-performance-optimizer.js" defer></script>
<!-- TOUCH TARGET AUDITOR -->
<script src="/js/touch-target-auditor.js" defer></script>
<!-- ğŸ¨ ULTIMATE CULTURAL GESTURES - Framer Motion System -->
<script src="/js/framer-cultural-gestures-ultimate.js" defer></script>
<!-- Service Worker Registration -->
<script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('âœ… PWA: Service Worker registered!', registration);
                    })
                    .catch(error => {
                        // Log to monitoring instead of console
                        if (window.posthog) {
                            posthog.capture('pwa_service_worker_error', {
                                message: 'Service Worker registration failed',
                                error: error.message,
                                url: window.location.pathname
                            });
                        }
                    });
            });
        }
</script>

<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>



<meta name="robots" content="index, follow"/>
<meta name="googlebot" content="index, follow"/>
<meta name="theme-color" content="#1a4d2e"/>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- â­ PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- â­ THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- â­ COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- â­ PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- â­ TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- â­ CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css">
<body style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); min-height: 100vh;">
    
    <!-- Header -->
    <header class="p-8 shadow-lg" >
        <div class="mx-auto" >
            <h1 class="font-extrabold m-0" >ğŸ§ª Orchestration Test Suite</h1>
            <p style="opacity: 0.9; margin: 0.5rem 0 0 0;">Deep testing & validation of multi-agent coordination system</p>
        </div>
    </header>

    <main style="max-width: 1400px; margin: 2rem auto; padding: 0 2rem;">
        
        <!-- Test Controls -->
        <section class="bg-white p-6 rounded-xl mb-8" >
            <div class="flex" >
                <button onclick="runAllTests()" class="rounded-lg font-semibold" >
                    â–¶ï¸ Run All Tests
                </button>
                <button onclick="runQuickTests()" class="rounded-lg font-semibold" >
                    âš¡ Quick Tests
                </button>
                <button onclick="runStressTests()" class="rounded-lg font-semibold" >
                    ğŸ’ª Stress Tests
                </button>
                <button onclick="clearResults()" class="rounded-lg font-semibold" >
                    ğŸ—‘ï¸ Clear Results
                </button>
                <button onclick="exportResults()" class="rounded-lg font-semibold" >
                    ğŸ“¥ Export Results
                </button>
            </div>
            
            <!-- Test Progress -->
            <div id="test-progress" style="margin-top: 1.5rem; display: none;">
                <div class="rounded-xl" >
                    <div id="progress-bar" class="flex font-bold" >
                        0%
                    </div>
                </div>
                <div id="progress-text" class="text-xs text-center" >
                    Initializing tests...
                </div>
            </div>
        </section>

        <!-- Test Summary -->
        <section id="test-summary" class="bg-white p-8 rounded-xl mb-8" >
            <h2 class="font-bold" >Test Summary</h2>
            <div class="grid" >
                <div class="p-4 rounded-lg" >
                    <div class="font-extrabold" id="pass-count">0</div>
                    <div class="font-semibold" >Passed</div>
                </div>
                <div class="p-4 rounded-lg" >
                    <div class="font-extrabold" id="fail-count">0</div>
                    <div class="font-semibold" >Failed</div>
                </div>
                <div class="p-4 rounded-lg" >
                    <div class="font-extrabold" id="skip-count">0</div>
                    <div class="font-semibold" >Skipped</div>
                </div>
                <div class="p-4 rounded-lg" >
                    <div class="font-extrabold" id="total-time">0s</div>
                    <div class="font-semibold" >Total Time</div>
                </div>
            </div>
        </section>

        <!-- Test Results -->
        <section>
            <h2 class="font-bold mb-4" >
                Test Results
            </h2>
            <div id="test-results">
                <div class="bg-white rounded-xl text-center" >
                    <div class="mb-4" >ğŸ§ª</div>
                    <h3 class="mb-2" >Ready to Test</h3>
                    <p style="color: #94a3b8;">Click "Run All Tests" to start comprehensive testing</p>
                </div>
            </div>
        </section>

        <!-- Live Test Log -->
        <section style="margin-top: 2rem;">
            <h2 class="font-bold mb-4" >
                Live Test Log
            </h2>
            <div id="test-log" class="p-6 rounded-xl" >
                <div style="color: #64748b;">Waiting for tests to start...</div>
            </div>
        </section>

    </main>

    <script>
        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let testResults = [];
        let startTime;
        
        // Logging utilities
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#3b82f6',
                success: '#10b981',
                error: '#dc2626',
                warn: '#f59e0b'
            };
            
            const entry = document.createElement('div');
            entry.innerHTML = `<span style="color: #64748b;">[${timestamp}]</span> <span style="color: ${colors[type]};">â–¸</span> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateProgress(current, total, message) {
            const percent = Math.round((current / total) * 100);
            document.getElementById('progress-bar').style.width = percent + '%';
            document.getElementById('progress-bar').textContent = percent + '%';
            document.getElementById('progress-text').textContent = message;
        }
        
        // Test framework
        class TestSuite {
            constructor(name) {
                this.name = name;
                this.tests = [];
                this.passed = 0;
                this.failed = 0;
                this.skipped = 0;
            }
            
            async test(name, testFn) {
                const startTime = Date.now();
                try {
                    log(`Running: ${name}`, 'info');
                    await testFn();
                    const duration = Date.now() - startTime;
                    this.passed++;
                    testResults.push({ name, status: 'pass', duration, suite: this.name });
                    log(`âœ“ PASS: ${name} (${duration}ms)`, 'success');
                    return true;
                } catch (error) {
                    const duration = Date.now() - startTime;
                    this.failed++;
                    testResults.push({ name, status: 'fail', duration, error: error.message, suite: this.name });
                    log(`âœ— FAIL: ${name} - ${error.message}`, 'error');
                    return false;
                }
            }
            
            skip(name, reason) {
                this.skipped++;
                testResults.push({ name, status: 'skip', reason, suite: this.name });
                log(`âŠ˜ SKIP: ${name} - ${reason}`, 'warn');
            }
        }
        
        // Assertion helpers
        function assert(condition, message) {
            if (!condition) {
                throw new Error(message || 'Assertion failed');
            }
        }
        
        function assertEqual(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(message || `Expected ${expected}, got ${actual}`);
            }
        }
        
        function assertExists(value, message) {
            if (value === null || value === undefined) {
                throw new Error(message || 'Expected value to exist');
            }
        }
        
        // TEST SUITE 1: Database Infrastructure
        async function testDatabaseInfrastructure() {
            const suite = new TestSuite('Database Infrastructure');
            
            await suite.test('task_queue table exists', async () => {
                const { data, error } = await supabase.from('task_queue').select('count').limit(0);
                assert(!error, `Table missing: ${error?.message}`);
            });
            
            await suite.test('validation_pipeline table exists', async () => {
                const { data, error } = await supabase.from('validation_pipeline').select('count').limit(0);
                assert(!error, `Table missing: ${error?.message}`);
            });
            
            await suite.test('agent_performance table exists', async () => {
                const { data, error } = await supabase.from('agent_performance').select('count').limit(0);
                assert(!error, `Table missing: ${error?.message}`);
            });
            
            await suite.test('agent_coordination table has agents', async () => {
                const { data, error } = await supabase.from('agent_coordination').select('agent_name');
                assert(!error, 'Query failed');
                assert(data.length >= 12, `Expected 12+ agents, got ${data.length}`);
            });
            
            await suite.test('agent_messages table functional', async () => {
                const { data, error } = await supabase.from('agent_messages').select('*').limit(5);
                assert(!error, 'Query failed');
            });
            
            return suite;
        }
        
        // TEST SUITE 2: Task Creation & Routing
        async function testTaskCreation() {
            const suite = new TestSuite('Task Creation & Routing');
            
            await suite.test('Create test task', async () => {
                const { data, error } = await supabase.rpc('assign_task', {
                    p_task_type: 'build_lesson',
                    p_description: '[TEST] Automated test task',
                    p_priority: 10,
                    p_assigned_by: 'test-suite',
                    p_resource_path: '/test/path.html'
                });
                assert(!error, `Task creation failed: ${error?.message}`);
                assertExists(data, 'No task ID returned');
            });
            
            await suite.test('Task auto-assigned to correct agent', async () => {
                const { data } = await supabase.from('task_queue')
                    .select('*')
                    .eq('assigned_by', 'test-suite')
                    .order('created_at', { ascending: false })
                    .limit(1)
                    .single();
                
                assertEqual(data.assigned_to, 'kaituhi-ako', 'build_lesson should route to kaituhi-ako');
                assertEqual(data.status, 'pending', 'New task should be pending');
            });
            
            await suite.test('Priority queue ordering', async () => {
                // Create tasks with different priorities
                await supabase.rpc('assign_task', {
                    p_task_type: 'build_lesson',
                    p_description: '[TEST] Priority 1',
                    p_priority: 1,
                    p_assigned_by: 'test-priority'
                });
                
                await supabase.rpc('assign_task', {
                    p_task_type: 'build_lesson',
                    p_description: '[TEST] Priority 10',
                    p_priority: 10,
                    p_assigned_by: 'test-priority'
                });
                
                const { data } = await supabase.from('task_queue')
                    .select('priority, task_description')
                    .eq('assigned_by', 'test-priority')
                    .order('priority', { ascending: true });
                
                assert(data[0].priority < data[1].priority, 'Priority ordering incorrect');
            });
            
            await suite.test('Task has all required fields', async () => {
                const { data } = await supabase.from('task_queue')
                    .select('*')
                    .eq('assigned_by', 'test-suite')
                    .limit(1)
                    .single();
                
                assertExists(data.id, 'Missing ID');
                assertExists(data.task_type, 'Missing task_type');
                assertExists(data.assigned_to, 'Missing assigned_to');
                assertExists(data.created_at, 'Missing created_at');
                assertEqual(data.status, 'pending', 'Status should be pending');
            });
            
            return suite;
        }
        
        // TEST SUITE 3: Agent Task Claiming
        async function testAgentClaiming() {
            const suite = new TestSuite('Agent Task Claiming');
            
            await suite.test('Agent can claim task', async () => {
                // Create a task
                const { data: taskId } = await supabase.rpc('assign_task', {
                    p_task_type: 'build_handout',
                    p_description: '[TEST] Claim test',
                    p_priority: 5,
                    p_assigned_by: 'test-claim'
                });
                
                // Agent claims it
                const { data, error } = await supabase.rpc('get_next_task', {
                    p_agent_id: 'kaituhi-ako'
                });
                
                assert(!error, `Claim failed: ${error?.message}`);
            });
            
            await suite.test('Claimed task status changes to in_progress', async () => {
                const { data } = await supabase.from('task_queue')
                    .select('*')
                    .eq('assigned_by', 'test-claim')
                    .eq('status', 'in_progress')
                    .limit(1);
                
                assert(data.length > 0, 'Task not marked in_progress');
                assertExists(data[0].started_at, 'started_at not set');
            });
            
            await suite.test('Only assigned agent can claim', async () => {
                // Try to claim task assigned to different agent
                const { data } = await supabase.rpc('get_next_task', {
                    p_agent_id: 'kaitiaki-ahurea'  // Wrong agent
                });
                
                // Should return nothing since tasks are for kaituhi-ako
                assert(!data || data.length === 0, 'Wrong agent claimed task');
            });
            
            return suite;
        }
        
        // TEST SUITE 4: Task Completion
        async function testTaskCompletion() {
            const suite = new TestSuite('Task Completion');
            
            await suite.test('Agent can complete task', async () => {
                // First create and claim a task
                await supabase.rpc('assign_task', {
                    p_task_type: 'create_relationships',
                    p_description: '[TEST] Completion test',
                    p_priority: 5,
                    p_assigned_by: 'test-complete'
                });
                
                const { data: claimed } = await supabase.rpc('get_next_task', {
                    p_agent_id: 'kaihapai-hononga'
                });
                
                // Complete it
                const { error } = await supabase.rpc('complete_task', {
                    p_task_id: claimed[0].task_id,
                    p_agent_id: 'kaihapai-hononga',
                    p_output_data: { result: 'test_success', score: 95 }
                });
                
                assert(!error, `Completion failed: ${error?.message}`);
            });
            
            await suite.test('Completed task has correct status', async () => {
                const { data } = await supabase.from('task_queue')
                    .select('*')
                    .eq('assigned_by', 'test-complete')
                    .single();
                
                assertEqual(data.status, 'completed', 'Status should be completed');
                assertExists(data.completed_at, 'completed_at not set');
                assertExists(data.output_data, 'output_data not saved');
            });
            
            await suite.test('Completion notification sent', async () => {
                const { data } = await supabase.from('agent_messages')
                    .select('*')
                    .eq('from_agent', 'kaihapai-hononga')
                    .eq('to_agent', 'kaitiaki-aronui')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                assert(data.length > 0, 'No notification sent');
                assert(data[0].message.includes('completed'), 'Wrong message content');
            });
            
            return suite;
        }
        
        // TEST SUITE 5: Performance Metrics
        async function testPerformanceMetrics() {
            const suite = new TestSuite('Performance Metrics');
            
            await suite.test('Duration calculated correctly', async () => {
                const { data } = await supabase.from('task_queue')
                    .select('started_at, completed_at')
                    .eq('status', 'completed')
                    .not('started_at', 'is', null)
                    .not('completed_at', 'is', null)
                    .limit(1)
                    .single();
                
                if (data) {
                    const duration = new Date(data.completed_at) - new Date(data.started_at);
                    assert(duration >= 0, 'Duration should be positive');
                    assert(duration < 24 * 60 * 60 * 1000, 'Duration unreasonably long');
                }
            });
            
            await suite.test('Average completion time query works', async () => {
                const { data, error } = await supabase.rpc('get_agent_workload');
                assert(!error, `Workload query failed: ${error?.message}`);
            });
            
            await suite.test('Output data preserved', async () => {
                const { data } = await supabase.from('task_queue')
                    .select('output_data')
                    .eq('status', 'completed')
                    .not('output_data', 'is', null)
                    .limit(1);
                
                if (data && data.length > 0) {
                    assert(typeof data[0].output_data === 'object', 'output_data should be JSON');
                }
            });
            
            return suite;
        }
        
        // TEST SUITE 6: Edge Cases & Error Handling
        async function testEdgeCases() {
            const suite = new TestSuite('Edge Cases & Error Handling');
            
            await suite.test('Cannot complete task twice', async () => {
                // Get a completed task
                const { data: completed } = await supabase.from('task_queue')
                    .select('*')
                    .eq('status', 'completed')
                    .limit(1)
                    .single();
                
                if (completed) {
                    // Try to complete again
                    const { data } = await supabase.rpc('complete_task', {
                        p_task_id: completed.id,
                        p_agent_id: completed.assigned_to,
                        p_output_data: {}
                    });
                    
                    // Should not update (no rows affected)
                    assert(true, 'System handled double completion');
                }
            });
            
            await suite.test('Invalid agent ID handled', async () => {
                const { data, error } = await supabase.rpc('get_next_task', {
                    p_agent_id: 'non-existent-agent-xyz'
                });
                
                // Should return empty, not error
                assert(!error, 'Should handle invalid agent gracefully');
                assert(!data || data.length === 0, 'Should return no tasks');
            });
            
            await suite.test('Null task description handled', async () => {
                const { error } = await supabase.rpc('assign_task', {
                    p_task_type: 'build_lesson',
                    p_description: null,
                    p_priority: 5,
                    p_assigned_by: 'test-null'
                });
                
                assert(!error, 'Should handle null description');
            });
            
            return suite;
        }
        
        // Main test runners
        async function runAllTests() {
            document.getElementById('test-progress').style.display = 'block';
            document.getElementById('test-summary').style.display = 'block';
            document.getElementById('test-log').innerHTML = '';
            testResults = [];
            startTime = Date.now();
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('ORCHESTRATION TEST SUITE - COMPREHENSIVE RUN', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            
            const suites = [
                testDatabaseInfrastructure,
                testTaskCreation,
                testAgentClaiming,
                testTaskCompletion,
                testPerformanceMetrics,
                testEdgeCases
            ];
            
            let totalPassed = 0, totalFailed = 0, totalSkipped = 0;
            
            for (let i = 0; i < suites.length; i++) {
                updateProgress(i, suites.length, `Running suite ${i + 1} of ${suites.length}...`);
                const suite = await suites[i]();
                totalPassed += suite.passed;
                totalFailed += suite.failed;
                totalSkipped += suite.skipped;
            }
            
            updateProgress(suites.length, suites.length, 'All tests complete!');
            
            const totalTime = ((Date.now() - startTime) / 1000).toFixed(2);
            
            document.getElementById('pass-count').textContent = totalPassed;
            document.getElementById('fail-count').textContent = totalFailed;
            document.getElementById('skip-count').textContent = totalSkipped;
            document.getElementById('total-time').textContent = totalTime + 's';
            
            displayResults();
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
            log(`COMPLETE: ${totalPassed} passed, ${totalFailed} failed, ${totalSkipped} skipped`, 'success');
            log(`Total time: ${totalTime}s`, 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
        }
        
        async function runQuickTests() {
            // Run only critical path tests
            log('Running quick smoke tests...', 'info');
            await testDatabaseInfrastructure();
            await testTaskCreation();
            displayResults();
        }
        
        async function runStressTests() {
            log('Running stress tests...', 'warn');
            
            // Create 50 tasks rapidly
            const promises = [];
            for (let i = 0; i < 50; i++) {
                promises.push(
                    supabase.rpc('assign_task', {
                        p_task_type: 'build_lesson',
                        p_description: `[STRESS TEST] Task ${i}`,
                        p_priority: Math.floor(Math.random() * 10) + 1,
                        p_assigned_by: 'stress-test'
                    })
                );
            }
            
            const results = await Promise.all(promises);
            const successful = results.filter(r => !r.error).length;
            
            log(`Created ${successful}/50 tasks successfully`, successful === 50 ? 'success' : 'warn');
        }
        
        function displayResults() {
            const container = document.getElementById('test-results');
            const grouped = {};
            
            testResults.forEach(result => {
                if (!grouped[result.suite]) grouped[result.suite] = [];
                grouped[result.suite].push(result);
            });
            
            let html = '';
            for (const [suite, tests] of Object.entries(grouped)) {
                html += `
                    <div class="bg-white p-6 rounded-xl mb-4" >
                        <h3 class="text-base font-bold" >${suite}</h3>
                        ${tests.map(test => `
                            <div class="test-result test-${test.status}">
                                <div class="flex" >
                                    <div>
                                        <strong>${test.status === 'pass' ? 'âœ“' : test.status === 'fail' ? 'âœ—' : 'âŠ˜'} ${test.name}</strong>
                                        ${test.error ? `<div style="margin-top: 0.5rem; font-size: 0.85rem;">Error: ${test.error}</div>` : ''}
                                        ${test.reason ? `<div style="margin-top: 0.5rem; font-size: 0.85rem;">Reason: ${test.reason}</div>` : ''}
                                    </div>
                                    ${test.duration ? `<span style="color: #64748b; font-size: 0.85rem;">${test.duration}ms</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = `
                <div class="bg-white rounded-xl text-center" >
                    <div class="mb-4" >ğŸ§ª</div>
                    <h3 style="color: #64748b; font-size: 1.5rem;">Results Cleared</h3>
                </div>
            `;
            document.getElementById('test-log').innerHTML = '<div style="color: #64748b;">Waiting for tests to start...</div>';
            document.getElementById('test-progress').style.display = 'none';
            document.getElementById('test-summary').style.display = 'none';
            testResults = [];
        }
        
        function exportResults() {
            const report = {
                timestamp: new Date().toISOString(),
                results: testResults,
                summary: {
                    passed: testResults.filter(r => r.status === 'pass').length,
                    failed: testResults.filter(r => r.status === 'fail').length,
                    skipped: testResults.filter(r => r.status === 'skip').length,
                    duration: (Date.now() - startTime) / 1000
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-results-${Date.now()}.json`;
            a.click();
            
            log('Test results exported', 'success');
        }
    </script>

</body>
</html>

