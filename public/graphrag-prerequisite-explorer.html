<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Prerequisite Chain Explorer | GraphRAG Intelligence | Te Kete Ako (Updated Oct 19 2025)</title>    <!-- üé® ULTIMATE BEAUTY SYSTEM - Te Kete Ako Design Excellence --> <link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"> <script src="https://cdn.tailwindcss.com"></script> <script src="/tailwind.config.ultimate.js"></script><!-- Professional Design System --> <!-- END ULTIMATE BEAUTY SYSTEM --></head><body class="pattern-koru-subtle">    <!-- Navigation -->    <div id="nav-container"></div>    <script>        fetch('/components/navigation-standard.html')            .then(r => r.text())            .then(html => document.getElementById('nav-container').innerHTML = html);    </script>    <!-- Whakataukƒ´ -->    <div style="background: linear-gradient(135deg, #f5e6d3 0%, #d4a574 100%); padding: 2rem; text-align: center; border-bottom: 4px solid #1a4d2e;">        <p style="font-size: 1.4rem; color: #0f2818; font-style: italic; margin-bottom: 0.5rem; font-weight: 600;">            "He ara whakauru ki te mƒÅtauranga, he ara whakaputa ki te ao mƒÅrama"        </p>        <p style="font-size: 1rem; color: #4a6e2a;">            The pathway into knowledge is the pathway to enlightenment        </p>    </div>    <!-- Hero -->    <section class="hero">        <div style="max-width: 800px; margin: 0 auto;">            <h1 style="font-size: 3.5rem; margin-bottom: 1rem; font-weight: 800;">üéØ Prerequisite Chain Explorer</h1>            <p style="font-size: 1.3rem; opacity: 0.95;">                Discover perfect learning sequences with 100% confidence pathways            </p>            <p style="font-size: 1.1rem; opacity: 0.85; margin-top: 0.5rem;">                üèÜ Featuring Y8 Digital Kaitiakitanga: 18-lesson perfect chain at 1.0 confidence!            </p>        </div>    </section>    <main class="chain-container">        <!-- Search -->        <div class="search-box">            <input                type="text"                class="search-input"                placeholder="üîç Search for a topic or lesson..."                id="search-input"                onkeyup="filterChains()"            >        </div>        <!-- Chains Display -->        <div id="chains-display" class="loading">            <div class="spinner"></div>            <p style="color: #64748b;">Loading prerequisite chains from GraphRAG...</p>        </div>    </main>    <!-- Footer -->    <div id="footer-container"></div>    <script>        fetch('/components/footer.html').then(r=>r.text()).then(html=>{            document.getElementById('footer-container').innerHTML=html;        });    </script>    <script>    const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5ODgxMTksImV4cCI6MjA1MjU2NDExOX0.gN5RGe7kGmxj4-yI1xnDuCuKUPFDh4f-8CQqQdqrGq0';    let allChains = [];    (async function() {        try {            console.log('üîç Loading prerequisite chains...');            // Fetch prerequisite relationships            const response = await fetch(                `${SUPABASE_URL}/rest/v1/graphrag_relationships?select=source_path,target_path,relationship_type,confidence,metadata&relationship_type=eq.prerequisite&confidence=gte.0.85&order=confidence.desc&limit=100`,                { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }            );            const relationships = await response.json();            console.log(`‚úÖ Found ${relationships.length} prerequisite relationships`);            // Get unique paths            const paths = [...new Set([                ...relationships.map(r => r.source_path),                ...relationships.map(r => r.target_path)            ])];            // Fetch resource details in chunks            const resources = [];            const chunkSize = 20;            for (let i = 0; i < paths.length; i += chunkSize) {                const chunk = paths.slice(i, i + chunkSize);                const pathFilter = chunk.map(p => `"${p}"`).join(',');                const resourceResponse = await fetch(                    `${SUPABASE_URL}/rest/v1/graphrag_resources?select=file_path,title,subject&file_path=in.(${pathFilter})`,                    { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }                );                if (resourceResponse.ok) {                    const chunkResources = await resourceResponse.json();                    resources.push(...chunkResources);                }            }            const resourceMap = {};            resources.forEach(r => {                resourceMap[r.file_path] = r;            });            console.log(`‚úÖ Loaded ${resources.length} resource details`);            // Build chains by grouping by unit            const chainsByUnit = {};            relationships.forEach(rel => {                const unit = rel.metadata?.unit || 'general';                if (!chainsByUnit[unit]) {                    chainsByUnit[unit] = [];                }                chainsByUnit[unit].push({                    source: resourceMap[rel.source_path],                    target: resourceMap[rel.target_path],                    confidence: rel.confidence,                    sequence: rel.metadata?.sequence || 0                });            });            // Build ordered chains            allChains = Object.entries(chainsByUnit).map(([unit, links]) => {                const lessons = [];                const seen = new Set();                // Sort by sequence                links.sort((a, b) => a.sequence - b.sequence);                // Build chain                links.forEach(link => {                    if (link.source && !seen.has(link.source.file_path)) {                        lessons.push({                            ...link.source,                            confidence: link.confidence,                            sequence: link.sequence                        });                        seen.add(link.source.file_path);                    }                    if (link.target && !seen.has(link.target.file_path)) {                        lessons.push({                            ...link.target,                            confidence: link.confidence,                            sequence: link.sequence + 1                        });                        seen.add(link.target.file_path);                    }                });                const avgConfidence = links.reduce((sum, l) => sum + l.confidence, 0) / links.length;                return {                    unit: formatUnitName(unit),                    unitKey: unit,                    lessons: lessons,                    avgConfidence: avgConfidence,                    isPerfect: avgConfidence === 1.0,                    totalSteps: lessons.length                };            }).filter(chain => chain.lessons.length > 0);            // Sort: perfect chains first, then by length            allChains.sort((a, b) => {                if (a.isPerfect && !b.isPerfect) return -1;                if (!a.isPerfect && b.isPerfect) return 1;                return b.totalSteps - a.totalSteps;            });            displayChains(allChains);        } catch (error) {            console.error('‚ùå Error loading chains:', error);            document.getElementById('chains-display').innerHTML = `                <div style="text-align: center; padding: 3rem; color: #ef4444;">                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>                    <p style="font-weight: 600;">Error loading prerequisite chains</p>                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">${error.message}</p>                </div>            `;        }    })();    function formatUnitName(unit) {        return unit            .replace(/_/g, ' ')            .replace(/\b\w/g, c => c.toUpperCase())            .replace('Y8', 'Year 8')            .replace('Y7', 'Year 7');    }    function displayChains(chains) {        const container = document.getElementById('chains-display');        if (chains.length === 0) {            container.innerHTML = `                <div style="text-align: center; padding: 3rem; color: #64748b;">                    <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>                    <p>No chains match your search</p>                </div>            `;            return;        }        container.innerHTML = chains.map(chain => `            <div class="chain-card ${chain.isPerfect ? 'perfect-chain' : ''}">                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">                    <div>                        <h2 style="color: #0f172a; margin: 0 0 0.5rem 0;">${chain.unit}</h2>                        <div style="color: #64748b; font-size: 0.9rem;">                            ${chain.isPerfect ? '‚≠ê Perfect Chain' : 'High-Confidence Chain'} ¬∑ ${chain.totalSteps} lessons                        </div>                    </div>                    <span class="confidence-badge" style="background: ${chain.isPerfect ? '#10b981' : '#3b82f6'};">                        ${Math.round(chain.avgConfidence * 100)}% Confidence                    </span>                </div>                <div style="margin-bottom: 2rem;">                    ${chain.lessons.map((lesson, idx) => `                        <div class="lesson-node">                            <div class="lesson-title">                                ${idx + 1}. ${lesson.title || 'Lesson ' + (idx + 1)}                            </div>                            <div class="lesson-meta">                                ${lesson.subject || 'General'} ${lesson.confidence === 1 ? '¬∑ ‚úÖ Perfect prerequisite' : ''}                            </div>                        </div>                    `).join('')}                </div>                <div class="chain-stats">                    <div class="stat">                        <div class="stat-value">${chain.totalSteps}</div>                        <div class="stat-label">Total Lessons</div>                    </div>                    <div class="stat">                        <div class="stat-value">${Math.round(chain.avgConfidence * 100)}%</div>                        <div class="stat-label">Avg Confidence</div>                    </div>                    <div class="stat">                        <div class="stat-value">${chain.lessons.filter(l => l.confidence === 1).length}</div>                        <div class="stat-label">Perfect Links</div>                    </div>                </div>            </div>        `).join('');        console.log(`‚úÖ Displayed ${chains.length} prerequisite chains`);    }    function filterChains() {        const search = document.getElementById('search-input').value.toLowerCase();        if (!search) {            displayChains(allChains);            return;        }        const filtered = allChains.filter(chain => {            const unitMatch = chain.unit.toLowerCase().includes(search);            const lessonMatch = chain.lessons.some(l =>                l.title?.toLowerCase().includes(search) ||                l.subject?.toLowerCase().includes(search)            );            return unitMatch || lessonMatch;        });        displayChains(filtered);    }    </script><!-- üìä ULTIMATE BEAUTY: PostHog Analytics (Privacy-First) --><script src="/js/posthog-analytics.js" defer></script></body></html>