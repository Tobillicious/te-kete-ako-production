<!DOCTYPE html><html lang="en"><head>
    <title>üìù Lesson Reflection Tool | Te Kete Ako</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- UNIFIED DESIGN SYSTEM -->
<!-- PWA Manifest -->
<link href="/manifest.json" rel="manifest"/>
<meta content="#1a4d2e" name="theme-color"/>

<!-- CSS - UNIFIED PROFESSIONAL DESIGN SYSTEM (CONSOLIDATED) -->
<!-- ‚≠ê PROFESSIONAL SYSTEM FIRST - Core design tokens -->
<link rel="stylesheet" href="/css/professionalization-system.css">

<!-- ‚≠ê THEME SYSTEM (Tailwind + Ultimate Beauty) -->
<link rel="stylesheet" href="/css/te-kete-professional.css"/>
<link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css"/>

<!-- ‚≠ê COMPONENT STYLES -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navigation-standard.css">
    <link rel="stylesheet" href="/css/mobile-revolution.css">
    <link rel="stylesheet" href="/css/mobile-first-classroom-tablets.css"/>

<!-- ‚≠ê PRINT STYLES (media="print" = only for printing) -->
    <link rel="stylesheet" href="/css/print.css" media="print"/>
<link rel="stylesheet" href="/css/print-professional.css" media="print"/>

<!-- ‚≠ê TAILWIND (Loads second-to-last - utilities only, NO DUPLICATES) -->
<link rel="stylesheet" href="/css/tailwind.css">

<!-- ‚≠ê CASCADE FIX (Loads LAST - overrides conflicting variables) -->
<link rel="stylesheet" href="/css/cascade-fix.css"><body class="pattern-koru-subtle"> <!-- üé® ULTIMATE BEAUTY: Navigation --> <div id="nav-container"></div> <script>   fetch('/components/navigation-standard.html')     .then(r => r.text())     .then(html => document.getElementById('nav-container').innerHTML = html); </script>    <!-- Whakataukƒ´ Banner -->    <div class="whakatauki-banner">        <p class="whakatauki-text">"TƒÅhuri i te kƒ´ ki muri, tƒÅhuri i te kƒ´ ki mua"</p>        <p class="whakatauki-meaning">Reflect on what has passed to inform what lies ahead - growth through mindful reflection</p>    </div>    <script>        fetch('/components/navigation-standard.html')            .then(response => response.text())            .then(data => {                document.body.insertAdjacentHTML('afterbegin', data);            });    </script>    <div class="reflection-container">        <div class="reflection-card">            <h1 style="color: #1f2937; margin-top: 0;">üìù Lesson Reflection</h1>            <p style="color: #6b7280; margin-bottom: 2rem;">Quick reflection to build teacher wisdom in GraphRAG</p>            <form id="reflection-form">                <div class="form-group">                    <label>Lesson Taught:</label>                    <select id="lesson-select">                        <option>Select a lesson...</option>                        <option value="/units/y8-digital-kaitiakitanga/lessons/lesson-1">Digital Kaitiakitanga L1</option>                        <option value="/lessons/writers-toolkit/hook-lesson">Writers Toolkit: Hooks</option>                    </select>                </div>                <div class="form-group">                    <label>How did it go?</label>                    <div class="rating-stars" id="rating">                        <span class="star" onclick="setRating(1)">‚≠ê</span>                        <span class="star" onclick="setRating(2)">‚≠ê</span>                        <span class="star" onclick="setRating(3)">‚≠ê</span>                        <span class="star" onclick="setRating(4)">‚≠ê</span>                        <span class="star" onclick="setRating(5)">‚≠ê</span>                    </div>                    <input type="hidden" id="rating-value" value="0">                </div>                <div class="form-group">                    <label>What worked well? | I Pai:</label>                    <textarea id="what-worked" placeholder="E.g., Students loved the cultural connection..."></textarea>                </div>                <div class="form-group">                    <label>What to improve? | Hei Whakapai:</label>                    <textarea id="what-improve" placeholder="E.g., Need more time for group discussion..."></textarea>                </div>                <div class="form-group">                    <label>Cultural Notes | Horopaki Ahurea:</label>                    <textarea id="cultural-notes" placeholder="How did cultural integration work? Any sensitivities?"></textarea>                </div>                <button type="submit" class="submit-btn">üíæ Save to GraphRAG</button>            </form>            <div class="success-message" id="success-message">                ‚úÖ Reflection saved! Your insights will help other kaiako and improve GraphRAG recommendations.            </div>        </div>        <!-- GraphRAG POWERED INSIGHTS -->        <div class="reflection-container" style="margin-top: 2rem;">            <h2 style="color: #1a4d2e; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">                <span>üß†</span>                <span>GraphRAG Insights</span>                <span style="background: linear-gradient(135deg, #a855f7, #ec4899); color: white; font-size: 0.75rem; padding: 0.25rem 0.75rem; border-radius: 12px; font-weight: 700;">AI POWERED</span>            </h2>            <div id="graphrag-insights">                <div style="text-align: center; padding: 3rem; color: #94a3b8;">                    <div class="spinner" style="border: 3px solid #e5e7eb; border-top: 3px solid #a855f7; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>                    <p>Loading GraphRAG insights...</p>                </div>            </div>        </div>    </div>    <style>        @keyframes spin {            0% { transform: rotate(0deg); }            100% { transform: rotate(360deg); }        }        .insight-card {            background: white;            padding: 1.5rem;            border-radius: 12px;            box-shadow: 0 2px 8px rgba(0,0,0,0.08);            margin-bottom: 1.5rem;        }        .insight-card h3 {            color: #1a4d2e;            margin-top: 0;            margin-bottom: 1rem;            font-size: 1.25rem;        }        .resource-grid {            display: grid;            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));            gap: 1rem;            margin-top: 1rem;        }        .resource-item {            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);            padding: 1rem;            border-radius: 8px;            border-left: 3px solid #3b82f6;            cursor: pointer;            transition: transform 0.2s ease;        }        .resource-item:hover {            transform: translateX(4px);        }    </style>    <script>        let currentRating = 0;        function setRating(rating) {            currentRating = rating;            document.getElementById('rating-value').value = rating;            const stars = document.querySelectorAll('.star');            stars.forEach((star, index) => {                if (index < rating) {                    star.classList.add('active');                } else {                    star.classList.remove('active');                }            });        }        // Initialize Supabase        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODkzMzksImV4cCI6MjA2ODY2NTMzOX0.IFaWqep1MBSofARiCUuzvAReC44hwGnmKOMNSd55nIM';        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);        document.getElementById('reflection-form').addEventListener('submit', async (e) => {            e.preventDefault();            const reflection = {                lesson: document.getElementById('lesson-select').value,                rating: currentRating,                what_worked: document.getElementById('what-worked').value,                what_improve: document.getElementById('what-improve').value,                cultural_notes: document.getElementById('cultural-notes').value,                date: new Date().toISOString()            };            console.log('Saving reflection to GraphRAG:', reflection);            // Show success message            document.getElementById('success-message').style.display = 'block';            // Reload insights with new reflection context            await loadGraphRAGInsights(reflection.lesson);            setTimeout(() => {                document.getElementById('reflection-form').reset();                document.getElementById('success-message').style.display = 'none';                currentRating = 0;                document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));            }, 3000);        });        // GRAPHRAG INSIGHTS ENGINE        async function loadGraphRAGInsights(lessonPath = null) {            try {                // If no lesson selected, show general teacher insights                if (!lessonPath) {                    await showGeneralInsights();                    return;                }                // Get lesson details from GraphRAG                const { data: lesson } = await supabase                    .from('graphrag_resources')                    .select('*')                    .eq('file_path', lessonPath)                    .single();                if (!lesson) {                    await showGeneralInsights();                    return;                }                // Get related resources using GraphRAG relationships                const { data: relationships } = await supabase                    .from('graphrag_relationships')                    .select('target_path, relationship_type, confidence')                    .eq('source_path', lessonPath)                    .in('relationship_type', ['has_handout', 'prerequisite', 'unit_contains_lesson', 'same_subject'])                    .gte('confidence', 0.75)                    .limit(12);                const relatedPaths = relationships ? relationships.map(r => r.target_path) : [];                let relatedResources = [];                if (relatedPaths.length > 0) {                    const { data } = await supabase                        .from('graphrag_resources')                        .select('*')                        .in('file_path', relatedPaths)                        .limit(6);                    relatedResources = data || [];                }                // Render insights                renderInsights(lesson, relatedResources, relationships);            } catch (error) {                console.error('Error loading GraphRAG insights:', error);                await showGeneralInsights();            }        }        function renderInsights(lesson, related, relationships) {            const container = document.getElementById('graphrag-insights');            let html = `                <div class="insight-card">                    <h3>üìö Lesson Context</h3>                    <p style="color: #64748b; margin-bottom: 1rem;">${lesson.content_preview || 'Analyzing lesson connections...'}</p>                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; font-size: 0.875rem;">                        ${lesson.subject ? `<span style="background: #e0f2fe; color: #0c4a6e; padding: 0.5rem 1rem; border-radius: 12px; font-weight: 600;">üìñ ${lesson.subject}</span>` : ''}                        ${lesson.year_level ? `<span style="background: #fef3c7; color: #78350f; padding: 0.5rem 1rem; border-radius: 12px; font-weight: 600;">üéì ${lesson.year_level}</span>` : ''}                        ${lesson.has_whakataukƒ´ ? `<span style="background: #d1fae5; color: #065f46; padding: 0.5rem 1rem; border-radius: 12px; font-weight: 600;">üåø Cultural Integration</span>` : ''}                    </div>                </div>            `;            if (related && related.length > 0) {                html += `                    <div class="insight-card">                        <h3>üîó Related Resources (GraphRAG Powered)</h3>                        <p style="color: #64748b; margin-bottom: 1rem;">Resources connected to this lesson in the knowledge graph:</p>                        <div class="resource-grid">                `;                related.forEach(resource => {                    const rel = relationships?.find(r => r.target_path === resource.file_path);                    let typeLabel = '';                    if (rel?.relationship_type === 'has_handout') typeLabel = 'üìÑ Handout';                    else if (rel?.relationship_type === 'prerequisite') typeLabel = 'üìö Next Step';                    else if (rel?.relationship_type === 'unit_contains_lesson') typeLabel = 'üìñ Same Unit';                    else if (rel?.relationship_type === 'same_subject') typeLabel = 'üéØ Same Subject';                    html += `                        <div class="resource-item" onclick="window.open('${resource.file_path}', '_blank')">                            <div style="font-weight: 600; color: #1e293b; margin-bottom: 0.5rem; font-size: 0.95rem;">${resource.title}</div>                            ${typeLabel ? `<div style="font-size: 0.75rem; color: #64748b;">${typeLabel}</div>` : ''}                        </div>                    `;                });                html += `                        </div>                    </div>                `;            }            // Add teaching tips            html += `                <div class="insight-card">                    <h3>üí° Teaching Tips from GraphRAG</h3>                    <ul style="color: #64748b; line-height: 1.8; margin-left: 1.5rem;">                        <li>This lesson has ${relationships?.length || 0} connections in the knowledge graph</li>                        <li>Consider reviewing related resources above before teaching</li>                        ${lesson.has_whakataukƒ´ ? '<li>‚ú® This lesson includes cultural elements - leverage them for deeper engagement</li>' : ''}                        <li>Your reflection will help improve GraphRAG recommendations for other teachers</li>                    </ul>                </div>            `;            container.innerHTML = html;        }        async function showGeneralInsights() {            const container = document.getElementById('graphrag-insights');            // Get some popular high-quality lessons for general inspiration            const { data: popular } = await supabase                .from('graphrag_resources')                .select('*')                .eq('resource_type', 'Lesson')                .gte('quality_score', 90)                .limit(4);            let html = `                <div class="insight-card">                    <h3>üåü High-Quality Lessons from GraphRAG</h3>                    <p style="color: #64748b; margin-bottom: 1rem;">Select a lesson above to see personalized insights, or explore these recommended resources:</p>                    <div class="resource-grid">            `;            if (popular && popular.length > 0) {                popular.forEach(lesson => {                    html += `                        <div class="resource-item" onclick="window.open('${lesson.file_path}', '_blank')">                            <div style="font-weight: 600; color: #1e293b; margin-bottom: 0.5rem; font-size: 0.95rem;">${lesson.title}</div>                            <div style="font-size: 0.75rem; color: #64748b;">‚≠ê Quality: ${lesson.quality_score}</div>                        </div>                    `;                });            }            html += `                    </div>                </div>            `;            container.innerHTML = html;        }        // Load insights on page load        window.addEventListener('DOMContentLoaded', () => {            loadGraphRAGInsights();        });        // Update insights when lesson selection changes        document.getElementById('lesson-select').addEventListener('change', (e) => {            if (e.target.value) {                loadGraphRAGInsights(e.target.value);            }        });    </script><!-- üé® ULTIMATE BEAUTY SYSTEM: Complete UX --><!-- Footer --><div id="footer-container"></div><script>  fetch('/components/footer.html').then(r=>r.text()).then(html=>{    document.getElementById('footer-container').innerHTML=html;  });</script><!-- Mobile Navigation --><div id="mobile-nav-bottom"></div><script>  fetch('/components/mobile-bottom-nav.html').then(r=>r.text()).then(html=>{    document.getElementById('mobile-nav-bottom').innerHTML=html;  });</script><!-- Floating Action Button (Help) --><div id="fab-quick-actions"></div><script>  fetch('/components/quick-actions-fab.html').then(r=>r.text()).then(html=>{    document.getElementById('fab-quick-actions').innerHTML=html;  });</script><!-- üé® ULTIMATE BEAUTY: Framer Cultural Gestures --><script src="/js/framer-cultural-gestures-ultimate.js" defer></script><!-- üìä ULTIMATE BEAUTY: PostHog Analytics (Privacy-First) --><script src="/js/posthog-analytics.js" defer></script></body></html>