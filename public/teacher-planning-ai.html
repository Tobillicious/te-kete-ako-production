<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Teacher Planning Assistant | Te Kete Ako</title>
    <meta name="description" content="Intelligent unit and lesson planning powered by GraphRAG">
    
    <link rel="stylesheet" href="/css/te-kete-professional.css">
    <link rel="stylesheet" href="/css/te-kete-ultimate-beauty-system.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .planning-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .planning-wizard {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        .wizard-step {
            display: none;
        }
        
        .wizard-step.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin: 1.5rem 0;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #1a4d2e;
            margin-bottom: 0.5rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #1a4d2e;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn-primary {
            background: #1a4d2e;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: #0f2818;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
            margin-left: 0.5rem;
        }
        
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        
        .ai-suggestion {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #059669;
        }
        
        .resource-suggestion {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 3px solid #DAA520;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .resource-suggestion:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            padding: 1rem 0;
        }
        
        .progress-step::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            right: -50%;
            height: 2px;
            background: #e0e0e0;
            z-index: -1;
        }
        
        .progress-step:last-child::before {
            display: none;
        }
        
        .progress-step.completed::before {
            background: #1a4d2e;
        }
        
        .progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .progress-step.active .progress-circle {
            background: #1a4d2e;
            color: white;
        }
        
        .progress-step.completed .progress-circle {
            background: #059669;
            color: white;
        }
        
        .generated-plan {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        .lesson-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #1a4d2e;
        }
    </style>
</head>
<body class="pattern-koru-subtle">
    
    <!-- Navigation -->
    <div id="nav-container"></div>
    <script>
        fetch('/components/navigation-standard.html')
            .then(r => r.text())
            .then(html => document.getElementById('nav-container').innerHTML = html);
    </script>
    
    <!-- Hero Section -->
    <section style="background: linear-gradient(135deg, #1a4d2e, #2d5a3d); color: white; padding: 3rem; text-align: center;">
        <h1 style="font-size: 3rem; margin-bottom: 1rem;">ü§ñ AI Teacher Planning Assistant</h1>
        <p style="font-size: 1.3rem; opacity: 0.95; max-width: 800px; margin: 0 auto;">
            Create culturally-integrated unit and lesson plans in minutes with GraphRAG intelligence
        </p>
    </section>
    
    <div class="planning-container">
        
        <!-- Planning Wizard -->
        <div class="planning-wizard">
            
            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-step active" data-step="1">
                    <div class="progress-circle">1</div>
                    <div>Basic Info</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="progress-circle">2</div>
                    <div>Learning Goals</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="progress-circle">3</div>
                    <div>Cultural Integration</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="progress-circle">4</div>
                    <div>Resources</div>
                </div>
                <div class="progress-step" data-step="5">
                    <div class="progress-circle">5</div>
                    <div>Review & Generate</div>
                </div>
            </div>
            
            <!-- Step 1: Basic Information -->
            <div class="wizard-step active" data-step="1">
                <h2 style="color: #1a4d2e; margin-bottom: 1.5rem;">üìã Basic Information</h2>
                
                <div class="form-group">
                    <label class="form-label">Unit/Lesson Title *</label>
                    <input type="text" id="plan-title" class="form-input" placeholder="e.g., Y8 Ecosystems & Kaitiakitanga">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Subject *</label>
                        <select id="plan-subject" class="form-select">
                            <option value="">Select subject...</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Science">Science</option>
                            <option value="English">English</option>
                            <option value="Social Studies">Social Studies</option>
                            <option value="Digital Technologies">Digital Technologies</option>
                            <option value="Te Reo MƒÅori">Te Reo MƒÅori</option>
                            <option value="Health & PE">Health & PE</option>
                            <option value="Arts">Arts</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Year Level *</label>
                        <select id="plan-year" class="form-select">
                            <option value="">Select year...</option>
                            <option value="Year 7">Year 7</option>
                            <option value="Year 8">Year 8</option>
                            <option value="Year 9">Year 9</option>
                            <option value="Year 10">Year 10</option>
                            <option value="Year 11">Year 11 (NCEA L1)</option>
                            <option value="Year 12">Year 12 (NCEA L2)</option>
                            <option value="Year 13">Year 13 (NCEA L3)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Duration</label>
                    <select id="plan-duration" class="form-select">
                        <option value="single">Single Lesson (60-75 min)</option>
                        <option value="week">1 Week (5 lessons)</option>
                        <option value="fortnight">2 Weeks (10 lessons)</option>
                        <option value="unit">Full Unit (4-6 weeks)</option>
                    </select>
                </div>
                
                <div style="margin-top: 2rem;">
                    <button class="btn-primary" onclick="nextStep()">Next: Learning Goals ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 2: Learning Goals -->
            <div class="wizard-step" data-step="2">
                <h2 style="color: #1a4d2e; margin-bottom: 1.5rem;">üéØ Learning Goals</h2>
                
                <div class="form-group">
                    <label class="form-label">What will students learn? *</label>
                    <textarea id="plan-goals" class="form-textarea" placeholder="E.g., Students will understand ecosystems, food webs, and the interconnection of living things..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">NZ Curriculum Links</label>
                    <input type="text" id="plan-curriculum" class="form-input" placeholder="E.g., Science L4: Living World">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Key Vocabulary/Concepts</label>
                    <input type="text" id="plan-vocabulary" class="form-input" placeholder="E.g., ecosystem, producer, consumer, decomposer, biodiversity">
                </div>
                
                <div class="ai-suggestion">
                    <h4 style="margin: 0 0 0.5rem; color: #059669;">üí° AI Suggestion</h4>
                    <p style="margin: 0; font-size: 0.95rem;">Based on your subject and year level, GraphRAG recommends including cross-curricular connections and real-world applications.</p>
                </div>
                
                <div style="margin-top: 2rem;">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Back</button>
                    <button class="btn-primary" onclick="nextStep()">Next: Cultural Integration ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 3: Cultural Integration -->
            <div class="wizard-step" data-step="3">
                <h2 style="color: #1a4d2e; margin-bottom: 1.5rem;">üåø Cultural Integration</h2>
                
                <div class="form-group">
                    <label class="form-label">How will you integrate Te Ao MƒÅori perspectives?</label>
                    <textarea id="plan-cultural" class="form-textarea" placeholder="E.g., Connect ecosystems to kaitiakitanga (guardianship), use local iwi environmental practices..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Whakataukƒ´ (Proverb)</label>
                    <input type="text" id="plan-whakatauki" class="form-input" placeholder="Optional: Add a relevant whakataukƒ´">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Te Reo MƒÅori Vocabulary</label>
                    <input type="text" id="plan-te-reo" class="form-input" placeholder="E.g., taiao (environment), rauropi (organism), oranga (wellbeing)">
                </div>
                
                <div class="ai-suggestion">
                    <h4 style="margin: 0 0 1rem; color: #059669;">üåü GraphRAG Cultural Suggestions</h4>
                    <div id="cultural-suggestions">
                        <p>Loading culturally-integrated resources...</p>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Back</button>
                    <button class="btn-primary" onclick="nextStep()">Next: Resources ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 4: Resources -->
            <div class="wizard-step" data-step="4">
                <h2 style="color: #1a4d2e; margin-bottom: 1.5rem;">üìö Resources & Activities</h2>
                
                <div class="form-group">
                    <label class="form-label">Assessment Methods</label>
                    <textarea id="plan-assessment" class="form-textarea" placeholder="How will you assess learning? E.g., practical investigation, written report, presentation..."></textarea>
                </div>
                
                <div class="ai-suggestion">
                    <h4 style="margin: 0 0 1rem; color: #059669;">üì¶ GraphRAG Resource Recommendations</h4>
                    <div id="resource-suggestions">
                        <p>Loading recommended resources...</p>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Back</button>
                    <button class="btn-primary" onclick="nextStep()">Next: Review ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 5: Review & Generate -->
            <div class="wizard-step" data-step="5">
                <h2 style="color: #1a4d2e; margin-bottom: 1.5rem;">‚ú® Review & Generate Plan</h2>
                
                <div id="plan-review" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <!-- Review content will be inserted here -->
                </div>
                
                <div style="margin-top: 2rem;">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Back</button>
                    <button class="btn-primary" onclick="generatePlan()">üöÄ Generate Complete Plan</button>
                </div>
            </div>
            
        </div>
        
        <!-- Generated Plan (shown after generation) -->
        <div id="generated-plan-container" style="display: none;">
            <!-- Generated content will appear here -->
        </div>
        
    </div>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    <script>
        fetch('/components/footer.html').then(r=>r.text()).then(html=>{
            document.getElementById('footer-container').innerHTML=html;
        });
    </script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://nlgldaqtubrlcqddppbq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sZ2xkYXF0dWJybGNxZGRwcGJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5ODgxMTksImV4cCI6MjA1MjU2NDExOX0.gN5RGe7kGmxj4-yI1xnDuCuKUPFDh4f-8CQqQdqrGq0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentStep = 1;
        let planData = {};
        
        // Navigation functions
        function nextStep() {
            if (validateCurrentStep()) {
                savePlanData();
                currentStep++;
                updateWizard();
                if (currentStep === 3) loadCulturalSuggestions();
                if (currentStep === 4) loadResourceSuggestions();
                if (currentStep === 5) showReview();
            }
        }
        
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateWizard();
            }
        }
        
        function updateWizard() {
            // Update steps
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`.wizard-step[data-step="${currentStep}"]`).classList.add('active');
            
            // Update progress
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function validateCurrentStep() {
            const requiredFields = {
                1: ['plan-title', 'plan-subject', 'plan-year'],
                2: ['plan-goals'],
                3: [], // Cultural integration is optional but encouraged
                4: [], // Resources are suggestions
                5: [] // Review step
            };
            
            const fields = requiredFields[currentStep];
            for (let fieldId of fields) {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    alert(`Please fill in all required fields (marked with *)`);
                    field?.focus();
                    return false;
                }
            }
            return true;
        }
        
        function savePlanData() {
            planData = {
                title: document.getElementById('plan-title')?.value || '',
                subject: document.getElementById('plan-subject')?.value || '',
                year: document.getElementById('plan-year')?.value || '',
                duration: document.getElementById('plan-duration')?.value || '',
                goals: document.getElementById('plan-goals')?.value || '',
                curriculum: document.getElementById('plan-curriculum')?.value || '',
                vocabulary: document.getElementById('plan-vocabulary')?.value || '',
                cultural: document.getElementById('plan-cultural')?.value || '',
                whakatauki: document.getElementById('plan-whakatauki')?.value || '',
                teReo: document.getElementById('plan-te-reo')?.value || '',
                assessment: document.getElementById('plan-assessment')?.value || ''
            };
        }
        
        // Load cultural suggestions from GraphRAG
        async function loadCulturalSuggestions() {
            const subject = document.getElementById('plan-subject').value;
            const container = document.getElementById('cultural-suggestions');
            
            try {
                const { data, error } = await supabase
                    .from('graphrag_resources')
                    .select('*')
                    .eq('subject', subject)
                    .eq('cultural_context', true)
                    .gte('quality_score', 80)
                    .limit(3);
                    
                if (error) throw error;
                
                if (data && data.length > 0) {
                    container.innerHTML = data.map(resource => `
                        <div class="resource-suggestion">
                            <h5 style="margin: 0 0 0.25rem; color: #1a4d2e;">${resource.title}</h5>
                            <p style="margin: 0; font-size: 0.85rem; color: #666;">
                                Quality: ${resource.quality_score} ‚Ä¢ ${resource.has_te_reo ? 'üó£Ô∏è Te Reo' : ''} 
                                ${resource.has_whakataukƒ´ ? 'üåø Whakataukƒ´' : ''}
                            </p>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>No specific suggestions available. Consider local iwi practices and cultural perspectives relevant to your topic.</p>';
                }
            } catch (error) {
                console.error('Error loading suggestions:', error);
                container.innerHTML = '<p>Error loading suggestions. Please continue with your own cultural integration ideas.</p>';
            }
        }
        
        // Load resource suggestions from GraphRAG
        async function loadResourceSuggestions() {
            const subject = document.getElementById('plan-subject').value;
            const year = document.getElementById('plan-year').value;
            const container = document.getElementById('resource-suggestions');
            
            try {
                const { data, error } = await supabase
                    .from('graphrag_resources')
                    .select('*')
                    .eq('subject', subject)
                    .gte('quality_score', 70)
                    .limit(5);
                    
                if (error) throw error;
                
                if (data && data.length > 0) {
                    container.innerHTML = data.map(resource => `
                        <div class="resource-suggestion">
                            <h5 style="margin: 0 0 0.25rem; color: #1a4d2e;">${resource.title}</h5>
                            <p style="margin: 0; font-size: 0.85rem; color: #666;">
                                ${resource.resource_type || 'Resource'} ‚Ä¢ Quality: ${resource.quality_score}
                            </p>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>Browse our resource library for relevant materials.</p>';
                }
            } catch (error) {
                console.error('Error loading resources:', error);
                container.innerHTML = '<p>Error loading resources. Please browse the resource library manually.</p>';
            }
        }
        
        // Show review
        function showReview() {
            savePlanData();
            const container = document.getElementById('plan-review');
            
            container.innerHTML = `
                <h3 style="margin: 0 0 1rem; color: #1a4d2e;">Plan Summary</h3>
                <div style="margin: 1rem 0;">
                    <strong>Title:</strong> ${planData.title}<br>
                    <strong>Subject:</strong> ${planData.subject}<br>
                    <strong>Year Level:</strong> ${planData.year}<br>
                    <strong>Duration:</strong> ${planData.duration}
                </div>
                <div style="margin: 1rem 0;">
                    <strong>Learning Goals:</strong><br>
                    <p style="margin: 0.5rem 0;">${planData.goals}</p>
                </div>
                ${planData.cultural ? `
                    <div style="margin: 1rem 0;">
                        <strong>Cultural Integration:</strong><br>
                        <p style="margin: 0.5rem 0;">${planData.cultural}</p>
                    </div>
                ` : ''}
                <div style="margin-top: 1rem; padding: 1rem; background: #dcfce7; border-radius: 8px;">
                    <p style="margin: 0; color: #166534;">
                        ‚ú® Ready to generate your complete plan with GraphRAG-powered recommendations!
                    </p>
                </div>
            `;
        }
        
        // Generate complete plan
        function generatePlan() {
            const container = document.getElementById('generated-plan-container');
            document.querySelector('.planning-wizard').style.display = 'none';
            container.style.display = 'block';
            
            container.innerHTML = `
                <div class="generated-plan">
                    <h2 style="color: #1a4d2e; margin-bottom: 1rem;">‚ú® ${planData.title}</h2>
                    
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                        <h3 style="margin: 0 0 0.5rem;">üìã Overview</h3>
                        <p><strong>Subject:</strong> ${planData.subject}</p>
                        <p><strong>Year Level:</strong> ${planData.year}</p>
                        <p><strong>Duration:</strong> ${planData.duration}</p>
                    </div>
                    
                    <div style="margin: 2rem 0;">
                        <h3 style="color: #1a4d2e;">üéØ Learning Outcomes</h3>
                        <p>${planData.goals}</p>
                        ${planData.curriculum ? `<p><strong>Curriculum Links:</strong> ${planData.curriculum}</p>` : ''}
                    </div>
                    
                    ${planData.cultural ? `
                        <div style="margin: 2rem 0; padding: 1.5rem; background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-radius: 12px;">
                            <h3 style="margin: 0 0 1rem; color: #166534;">üåø Cultural Integration</h3>
                            <p>${planData.cultural}</p>
                            ${planData.whakatauki ? `
                                <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <p style="font-style: italic; margin: 0;">"${planData.whakatauki}"</p>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <div style="margin: 2rem 0;">
                        <h3 style="color: #1a4d2e;">üìö Suggested Lesson Sequence</h3>
                        ${generateLessonSequence()}
                    </div>
                    
                    ${planData.assessment ? `
                        <div style="margin: 2rem 0;">
                            <h3 style="color: #1a4d2e;">‚úÖ Assessment</h3>
                            <p>${planData.assessment}</p>
                        </div>
                    ` : ''}
                    
                    <div style="margin: 2rem 0; text-align: center;">
                        <button class="btn-primary" onclick="downloadPlan()">üì• Download Plan (PDF)</button>
                        <button class="btn-primary" onclick="saveToDashboard()" style="margin-left: 1rem;">üíæ Save to My Kete</button>
                        <button class="btn-secondary" onclick="startNewPlan()" style="margin-left: 1rem;">üîÑ Create New Plan</button>
                    </div>
                </div>
            `;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Generate lesson sequence based on duration
        function generateLessonSequence() {
            const lessonCount = {
                'single': 1,
                'week': 5,
                'fortnight': 10,
                'unit': 20
            }[planData.duration] || 5;
            
            let sequence = '';
            for (let i = 1; i <= Math.min(lessonCount, 5); i++) {
                sequence += `
                    <div class="lesson-card">
                        <h4 style="margin: 0 0 0.5rem; color: #1a4d2e;">Lesson ${i}</h4>
                        <p style="margin: 0; font-size: 0.95rem;">GraphRAG suggests starting with foundational concepts and building to more complex applications.</p>
                    </div>
                `;
            }
            
            if (lessonCount > 5) {
                sequence += `
                    <p style="margin-top: 1rem; font-style: italic; color: #666;">
                        ... plus ${lessonCount - 5} additional lessons following the same progression
                    </p>
                `;
            }
            
            return sequence;
        }
        
        function downloadPlan() {
            alert('PDF download feature coming soon! üìÑ');
        }
        
        function saveToDashboard() {
            localStorage.setItem('teacher-plan', JSON.stringify(planData));
            alert('Plan saved to your dashboard! ‚úÖ');
        }
        
        function startNewPlan() {
            location.reload();
        }
    </script>
    
    <!-- Analytics -->
    <script src="/js/posthog-analytics.js" defer></script>
    
</body>
</html>
